<header>
  <h1><%= t('inspections.titles.edit') %></h1>
  <nav>
    <%= link_to t('inspections.buttons.qr_and_pdf'), inspection_path(@inspection) %>
  </nav>
</header>

<article>
  <div class="inspection-edit-container">
    <!-- Inspection Overview -->
    <div class="inspection-overview">
      <h2><%= t('inspections.headers.overview') %></h2>
      <div class="overview-details">
        <div class="detail-item">
          <span class="label"><%= t('inspections.fields.unit_name') %>:</span>
          <span class="value"><%= @inspection.unit&.name || t('inspections.messages.no_unit') %></span>
        </div>
        <div class="detail-item">
          <span class="label"><%= t('inspections.fields.serial') %>:</span>
          <span class="value"><%= @inspection.unit&.serial || t('inspections.messages.not_specified') %></span>
        </div>
        <div class="detail-item">
          <span class="label"><%= t('inspections.fields.progress') %>:</span>
          <%= turbo_frame_tag "inspection_progress_#{@inspection.id}" do %>
            <span class="value"><%= "#{assessment_completion_percentage(@inspection)}%" %></span>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Completion Issues -->
    <%= turbo_frame_tag "completion_issues_#{@inspection.id}" do %>
      <% if content = render('completion_issues', inspection: @inspection) and content.strip.present? %>
        <%= content.html_safe %>
        <br>
      <% end %>
    <% end %>

    <!-- Tab Navigation -->
    <nav class="inspection-tabs" data-inspection-id="<%= @inspection.id %>">
      <ul class="tab-list">
        <% inspection_tabs(@inspection).each do |tab| %>
          <li class="tab-item">
            <%= link_to t("inspections.tabs.#{tab}"), 
                edit_inspection_path(@inspection, tab: tab), 
                class: "tab-link #{'active' if current_tab == tab}", 
                data: { tab: tab } %>
          </li>
        <% end %>
      </ul>
    </nav>

    <!-- Tab Content -->
    <div class="tab-content">
      <% case current_tab %>
      <% when 'general' %>
        <%= render 'form' %>
      <% when 'user_height' %>
        <%= render 'user_height_form' %>
      <% when 'slide' %>
        <%= render 'slide_form' %>
      <% when 'structure' %>
        <%= render 'structure_form' %>
      <% when 'materials' %>
        <%= render 'materials_form' %>
      <% when 'anchorage' %>
        <%= render 'anchorage_form' %>
      <% when 'fan' %>
        <%= render 'fan_form' %>
      <% when 'enclosed' %>
        <%= render 'enclosed_form' %>
      <% else %>
        <div class="assessment-placeholder">
          <h3><%= t("inspections.tabs.#{current_tab}") %> Assessment</h3>
          <p>This assessment form is coming soon.</p>
          <p><%= link_to "Return to General", edit_inspection_path(@inspection), class: "btn btn-primary" %></p>
        </div>
      <% end %>
    </div>

    <!-- Actions -->
    <div class="inspection-actions">
      <% if @inspection.status != "complete" || current_user.admin? %>
        <%= button_to t('inspections.buttons.delete'), 
            inspection_path(@inspection), 
            method: :delete, 
            data: { turbo_confirm: t('inspections.messages.delete_confirm') } %>
      <% end %>
    </div>
  </div>
</article>
