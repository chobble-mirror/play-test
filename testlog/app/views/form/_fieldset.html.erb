<%
  # Smart i18n key detection for legend
  if local_assigns[:i18n_base] && local_assigns[:legend_key]
    legend_text = t("#{local_assigns[:i18n_base]}.sections.#{local_assigns[:legend_key]}")
  elsif local_assigns[:legend]
    legend_text = local_assigns[:legend]
  else
    # Auto-detect from controller and current tab context
    controller_name = params[:controller]
    if controller_name == 'inspections' && params[:tab].present? && local_assigns[:legend_key]
      i18n_base = "inspections.assessments.#{params[:tab]}"
      legend_text = t("#{i18n_base}.sections.#{local_assigns[:legend_key]}", default: local_assigns[:legend_key].to_s.humanize)
    else
      legend_text = local_assigns[:legend_key]&.to_s&.humanize || "Section"
    end
  end
  
  # Form fieldset options
  css_class ||= "form-section"
%>

<fieldset class="<%= css_class %>">
  <% if legend_text.present? %>
    <legend><%= legend_text %></legend>
  <% end %>
  <%= yield %>
</fieldset>