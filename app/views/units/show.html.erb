<% if !logged_in? || (current_user && @unit.user_id != current_user.id) %>
  <article class="view-unit">
    <%= render 'shared/page_header', title: t('units.titles.show') %>
    
    <iframe src="<%= unit_path(@unit, format: :pdf) %>" 
            width="100%" 
            height="800" 
            style="border: 1px solid #ccc;">
      <p><%= t('units.messages.pdf_not_supported_html') %></p>
      <%= link_to t('units.buttons.download_pdf'), unit_path(@unit, format: :pdf) %>
    </iframe>
  </article>
<% else %>
  <article class="view-unit">
    <%= render 'shared/page_header', title: t('units.titles.show') %>

    <%= render 'unit_details', unit: @unit %>

    <hr>

    <%= render 'shared/action_buttons', actions: unit_actions(@unit) %>

    <hr>

    <h4><%= t('units.headers.inspection_history') %></h4>
    <% if @inspections.any? %>
      <%= render 'inspections/inspections_table', 
          inspections: @inspections, 
          unit: @unit,
          show_name: @inspections.any? { |i| i.name != @unit.name },
          show_serial: false,
          show_location: true,
          show_inspector: true %>
    <% else %>
      <p><%= t('units.messages.no_inspections') %></p>
    <% end %>

    <hr>

    <h4><%= t('units.headers.qr_code') %></h4>
    <%= image_tag unit_path(@unit, format: :png), alt: t('units.accessibility.qr_code_alt'), width: 250 %>

    <hr>
<% end %>

  <h4><%= t('units.headers.report_link') %></h4>
  <%= link_to unit_url(@unit, format: :pdf), unit_url(@unit, format: :pdf) %>
  <%= render 'shared/share_button', 
      url: unit_url(@unit, format: :pdf),
      title: t('units.share.title', name: @unit.name),
      button_text: t('units.share.button'),
      copied_text: t('units.share.copied') %>
  
  <h4><%= t('units.headers.report_json_link') %></h4>
  <%= link_to unit_url(@unit, format: :json), unit_url(@unit, format: :json) %>

  <hr>

  <h4><%= t('units.headers.unit_report') %></h4>
  <iframe src="<%= unit_path(@unit, format: :pdf) %>" 
          width="100%" 
          height="800px" 
          style="border: 1px solid #ccc;">
    <%= t('units.messages.pdf_not_supported') %>
    <%= link_to t('units.buttons.download_pdf'), unit_path(@unit, format: :pdf) %>.
  </iframe>
</article>
