<%= render 'form/form_context', model: @inspection.materials_assessment, i18n_base: 'forms.materials', url: inspection_materials_assessment_path(@inspection) do |form| %>

    <div class="assessment-form materials-assessment">

      <!-- Safety Standards Reference -->
      <details class="safety-standards-reference">
        <summary>View Safety Standards</summary>
        <%= render 'shared/safety_standards/material_requirements' %>
      </details>

      <!-- Rope Specifications Section -->
      <%= render 'form/fieldset', legend_key: 'rope_specifications' do %>
        <%= render 'form/number_pass_fail_comment', field: :ropes, number_options: { min: 0, step: 0.1 } %>
      <% end %>

      <!-- Critical Material Safety Checks Section -->
      <%= render 'form/fieldset', legend_key: 'critical_materials' do %>
        <%= render 'form/pass_fail_comment', field: :fabric_strength_pass %>
        <%= render 'form/pass_fail_comment', field: :fire_retardant_pass %>
        <%= render 'form/pass_fail_comment', field: :thread_pass %>
      <% end %>

      <!-- Additional Material Checks Section -->
      <%= render 'form/fieldset', legend_key: 'additional_materials' do %>
        <%= render 'form/pass_fail_comment', field: :clamber_netting_pass %>
        <%= render 'form/pass_fail_comment', field: :retention_netting_pass %>
        <%= render 'form/pass_fail_comment', field: :zips_pass %>
        <%= render 'form/pass_fail_comment', field: :windows_pass %>
        <%= render 'form/pass_fail_comment', field: :artwork_pass %>
      <% end %>

      <!-- Material Compliance Summary -->
      <% if @inspection.materials_assessment&.persisted? %>
        <div class="material-compliance-summary">
          <h4><%= t('forms.materials.summary.title') %></h4>

          <div class="compliance-overview">
            <div class="critical-materials">
              <strong><%= t('forms.materials.summary.critical_materials') %>:</strong>
              <span class="<%= @inspection.materials_assessment.has_critical_failures? ? 'text-danger' : 'text-success' %>">
                <%= @inspection.materials_assessment.material_compliance_summary[:critical_passed] %> /
                <%= @inspection.materials_assessment.material_compliance_summary[:critical_total] %>
              </span>
            </div>

            <div class="overall-materials">
              <strong><%= t('forms.materials.summary.overall_materials') %>:</strong>
              <span class="material-count">
                <%= @inspection.materials_assessment.passed_checks_count %> / <%= @inspection.enclosed_assessment.pass_columns_count %>
              </span>
            </div>
          </div>

          <% if @inspection.materials_assessment.has_critical_failures? %>
            <div class="critical-failures text-danger">
              <strong><%= t('forms.materials.summary.critical_status') %>:</strong>
              <%= @inspection.materials_assessment.critical_material_status %>
            </div>
          <% end %>

          <% if @inspection.materials_assessment.material_test_requirements.any? %>
            <div class="test-requirements">
              <strong><%= t('forms.materials.summary.test_requirements') %>:</strong>
              <ul>
                <% @inspection.materials_assessment.material_test_requirements.each do |requirement| %>
                  <li><%= requirement %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <% if @inspection.materials_assessment.non_critical_issues.any? %>
            <div class="non-critical-issues text-warning">
              <strong><%= t('forms.materials.summary.non_critical_issues') %>:</strong>
              <%= @inspection.materials_assessment.non_critical_issues.join(", ") %>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Safety Status -->
      <%= render 'form/assessment_status', assessment: @inspection.materials_assessment %>

    </div>
<% end %>
