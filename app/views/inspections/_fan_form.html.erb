<%= render 'form/form_context', model: @inspection.fan_assessment, i18n_base: 'forms.fan', url: inspection_fan_assessment_path(@inspection) do |form| %>
      <%= render 'shared/page_header', title: t('forms.fan.header') %>

      <!-- Blower Specifications Section -->
      <%= render 'form/fieldset', legend_key: 'blower_specifications' do %>
        <%= render 'form/text_field', field: :blower_serial %>
        <%= render 'form/text_field', field: :fan_size_type %>
      <% end %>

      <!-- Blower Safety Checks Section -->
      <%= render 'form/fieldset', legend_key: 'blower_safety_checks' do %>
        <%= render 'form/pass_fail', field: :blower_flap_pass %>
        <%= render 'form/comment', field: :blower_flap_comment %>
        <%= render 'form/pass_fail', field: :blower_finger_pass %>
        <%= render 'form/comment', field: :blower_finger_comment %>
        <%= render 'form/pass_fail', field: :blower_visual_pass %>
        <%= render 'form/comment', field: :blower_visual_comment %>
      <% end %>

      <!-- Electrical Safety Section -->
      <%= render 'form/fieldset', legend_key: 'electrical_safety' do %>
        <%= render 'form/pass_fail', field: :pat_pass %>
        <%= render 'form/comment', field: :pat_comment %>
      <% end %>

      <!-- Assessment Summary -->
      <% if @inspection.fan_assessment&.persisted? %>
        <div class="fan-assessment-summary">
          <h4><%= t('forms.fan.summary.title') %></h4>
          
          <div class="fan-safety-overview">
            <div class="blower-checks">
              <strong><%= t('forms.fan.summary.blower_checks') %>:</strong>
              <% passed_checks = [@inspection.fan_assessment.blower_flap_pass, @inspection.fan_assessment.blower_finger_pass, @inspection.fan_assessment.blower_visual_pass].count(true) %>
              <% total_checks = 3 %>
              <span class="checks-count <%= passed_checks == total_checks ? 'text-success' : 'text-warning' %>">
                <%= passed_checks %> / <%= total_checks %>
              </span>
            </div>

            <div class="electrical-safety">
              <strong><%= t('forms.fan.summary.electrical_safety') %>:</strong>
              <span class="<%= @inspection.fan_assessment.pat_pass ? 'text-success' : 'text-danger' %>">
                <%= @inspection.fan_assessment.pat_pass ? 
                    t('forms.fan.status.pass') : 
                    t('forms.fan.status.fail') %>
              </span>
            </div>

            <% if @inspection.fan_assessment.blower_serial.present? %>
              <div class="blower-details">
                <strong><%= t('forms.fan.summary.blower_serial') %>:</strong>
                <span class="serial-number"><%= @inspection.fan_assessment.blower_serial %></span>
              </div>
            <% end %>
          </div>

          <!-- Critical Issues Alert -->
          <% failed_checks = [@inspection.fan_assessment.blower_flap_pass, @inspection.fan_assessment.blower_finger_pass, @inspection.fan_assessment.blower_visual_pass, @inspection.fan_assessment.pat_pass].any? { |check| check == false } %>
          <% if failed_checks %>
            <div class="fan-safety-issues text-danger">
              <strong><%= t('forms.fan.summary.safety_issues') %>:</strong>
              <ul>
                <% if @inspection.fan_assessment.blower_flap_pass == false %>
                  <li><%= t('forms.fan.issues.blower_flap') %></li>
                <% end %>
                <% if @inspection.fan_assessment.blower_finger_pass == false %>
                  <li><%= t('forms.fan.issues.finger_guards') %></li>
                <% end %>
                <% if @inspection.fan_assessment.blower_visual_pass == false %>
                  <li><%= t('forms.fan.issues.visual_damage') %></li>
                <% end %>
                <% if @inspection.fan_assessment.pat_pass == false %>
                  <li><%= t('forms.fan.issues.pat_failure') %></li>
                <% end %>
              </ul>
            </div>
          <% else %>
            <div class="fan-safety-status text-success">
              <strong><%= t('forms.fan.summary.overall_status') %>:</strong>
              <%= t('forms.fan.summary.all_checks_passed') %>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Safety Status -->
      <%= render 'form/assessment_status', assessment: @inspection.fan_assessment %>

<% end %>