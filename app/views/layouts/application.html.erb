<!DOCTYPE html>
<html>
  <head>
    <title>play-test | Professional Inspection Management | play-test.co.uk</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "mvp" %>
    <%= stylesheet_link_tag "application" %>
    <%= javascript_importmap_tags %>

    <%= favicon_link_tag asset_path("favicon.svg") %>
    <script data-goatcounter="https://analytics.play-test.co.uk/count"
      async src="//analytics.play-test.co.uk/count.js"></script>
  </head>
  <body<% if current_user&.theme == "dark" %> class="dark-theme"<% end %>>
    <% if current_user %>
      <% if !current_user.is_active? %>
        <aside id="company-activation-notice">
          <%= current_user.inactive_user_message %>
        </aside>
      <% end %>
      <nav>
        <ul>
          <li>
            <%= link_to inspections_path do %>
              <strong>Inspections</strong>
            <% end %>
          </li>
          <li>
            <%= link_to units_path do %>
              <strong>Units</strong>
            <% end %>
          </li>
          <% if current_user.admin? %>
            <li>
              <%= link_to users_path do %>
                <strong>Users</strong>
              <% end %>
            </li>
            <li>
              <%= link_to inspector_companies_path do %>
                <strong><%= t('inspector_companies.titles.index') %></strong>
              <% end %>
            </li>
          <% end %>
          <li>
            <%= link_to change_settings_user_path(current_user) do %>
              <strong>Settings</strong>
            <% end %>
          </li>
          <li>
            <%= link_to safety_standards_path do %>
              <strong>Safety Standards</strong>
            <% end %>
          </li>
          <li>
            <%= link_to about_path do %>
              <strong>About</strong>
            <% end %>
          </li>
          <li>
            <%= button_to t("sessions.buttons.log_out"), logout_path, method: :delete %>
          </li>
        </ul>
      </nav>
    <% end %>
    <main>
      <% flash.each do |type, message| %>
        <article>
          <aside>
            <%= message %>
            <% if type.to_s == "notice" && session[:rpii_verification_details] %>
              <div style="margin-top: 0.5rem; padding: 0.5rem; background: #f0f0f0;">
                <strong><%= t("users.verification.details_header") %></strong><br>
                <%= t("users.verification.name") %>: <%= session[:rpii_verification_details]["name"] %><br>
                <%= t("users.verification.number") %>: <%= session[:rpii_verification_details]["number"] %><br>
                <%= t("users.verification.qualifications") %>: <%= session[:rpii_verification_details]["qualifications"] %>
              </div>
              <% session.delete(:rpii_verification_details) %>
            <% end %>
          </aside>
        </article>
      <% end %>

      <%= yield %>

      <footer>
        <p>
          <strong>Privacy policy:</strong> I won't use your info for anything other than contacting you about this service, which will be rare. You can delete your data whenever you like.
        </p>
        <p>
          <strong>Self promo:</strong> Do you need a website, software development, or honest techy advice? Get in touch with me at <a href="https://chobble.com">Chobble.com</a>.
        </p>
        <p>
          <a href="https://git.chobble.com/chobble/play-test">Source Code</a>
        </p>
      </footer>
      <%= render 'shared/debug_info' %>
    </main>
  </body>
</html>
