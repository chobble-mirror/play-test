<%= render 'shared/page_header', title: t('users.titles.edit') %>

<%= form_with(model: @user) do |form| %>
  <%= render 'form/errors', model: @user %>
  
  <%= render 'form/fieldset', legend_key: 'account_details', i18n_base: 'users.forms', form: form do %>
    <%= render 'form/text_field', field: :email, type: :email_field %>
    <%= render 'form/text_field', field: :password, type: :password_field, 
        label: t('users.forms.password_help') %>
    <%= render 'form/text_field', field: :password_confirmation, type: :password_field %>
    
    <% if current_user.admin? %>
      <%= render 'form/text_field', field: :rpii_inspector_number %>
      <%= render 'form/date_field', field: :active_until %>
      <%= render 'form/select', 
          field: :inspection_company_id,
          options: options_for_select(
            [[t('users.forms.no_company'), ""]] + 
            InspectorCompany.active.order(:name).map { |c| [c.name, c.id] },
            @user.inspection_company_id || ""
          ) %>
    <% end %>
  <% end %>
  
  <fieldset>
    <%= render 'form/submit_button', text: t('users.buttons.update_user'), form: form %>
  </fieldset>
<% end %>

<% if @user != current_user %>
  <article>
    <%= button_to t('users.buttons.impersonate', email: @user.email), 
        impersonate_user_path(@user), method: :post, 
        data: { confirm: t('users.messages.impersonate_confirm', email: @user.email) } %>
  </article>
  <article>
    <%= button_to t('users.buttons.delete'), user_path(@user), method: :delete, 
        data: { confirm: t('users.messages.delete_confirm') } %>
  </article>
<% end %>