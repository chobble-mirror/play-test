<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Play-test</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.1/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.1/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.1/favicon_green.png" />
  </head>

  <body data-branch-coverage=true>
    <div id="loading">
      <img src="./assets/0.13.1/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-06-09T22:31:21+01:00">2025-06-09T22:31:21+01:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="green">
  97.21%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         956.17
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>37</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>2111</b> relevant lines,
    <span class="green"><b>2052</b> lines covered</span> and
    <span class="red"><b>59</b> lines missed. </span>
    (<span class="green">
  97.21%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>869</b> total branches, </span>
      <span class="green"><b>727</b> branches covered</span> and
      <span class="red"><b>142</b> branches missed.</span>
      (<span class="yellow">
  83.66%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#db87b5689ad9e4ea79ba2821eac99cd31dce48d6" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">73</td>
            <td class="cell--number">35</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">30891.77</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#651d7297887ccd04189d05d93595f53c8682187a" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.72 %</td>
            <td class="cell--number">158</td>
            <td class="cell--number">72</td>
            <td class="cell--number">61</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">68.57 %</td>
              <td class="cell--number">35</td>
              <td class="cell--number">24</td>
              <td class="cell--number">11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8c27b422e6ca84d76374722ca618c6661ec2e9db" class="src_link" title="app/controllers/inspections_controller.rb">app/controllers/inspections_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.99 %</td>
            <td class="cell--number">451</td>
            <td class="cell--number">199</td>
            <td class="cell--number">195</td>
            <td class="cell--number">4</td>
            <td class="cell--number">34.92</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">89.89 %</td>
              <td class="cell--number">89</td>
              <td class="cell--number">80</td>
              <td class="cell--number">9</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#06f34603d0da312971469bcb19fbdba9612fa7f6" class="src_link" title="app/controllers/inspector_companies_controller.rb">app/controllers/inspector_companies_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">81</td>
            <td class="cell--number">43</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.49</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ce1cb863974e61842b92505eefea4ca456507ed2" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">22</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">252.09</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0b3f778b58c42d9ed9d5158148be1005132634b7" class="src_link" title="app/controllers/units_controller.rb">app/controllers/units_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.87 %</td>
            <td class="cell--number">231</td>
            <td class="cell--number">117</td>
            <td class="cell--number">111</td>
            <td class="cell--number">6</td>
            <td class="cell--number">17.13</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">86.84 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">33</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5b41f7262eb46e0d1cf1b8c69d09daf8db2cc0e1" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">129</td>
            <td class="cell--number">67</td>
            <td class="cell--number">67</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">95.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">23</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9894e74a1bb433abb5cacbc3f991919fb78477e7" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2403.27</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">12</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#85d6c3668e88de18c567acb888765e4f0cedc30b" class="src_link" title="app/helpers/inspections_helper.rb">app/helpers/inspections_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">100</td>
            <td class="cell--number">43</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0</td>
            <td class="cell--number">119.88</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">89.58 %</td>
              <td class="cell--number">48</td>
              <td class="cell--number">43</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7270708c9f971b4d6cc06004c9277ff4b4b7aa02" class="src_link" title="app/helpers/sessions_helper.rb">app/helpers/sessions_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">22</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1380.64</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5c60b996f371cb710fe6041818507b209a1ba878" class="src_link" title="app/helpers/units_helper.rb">app/helpers/units_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">26.14</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3f19ee0fc53266c4d75c7d985c47fd88eabec21d" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.78</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#963e193313680e5d0ff51b825317e34d218746e2" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d58f8591b081a2f457313a7d4d0037a79c06d8ed" class="src_link" title="app/jobs/storage_cleanup_job.rb">app/jobs/storage_cleanup_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">43</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.76</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1402d36ddea733c453b8ff4f70c0ca7aae31e143" class="src_link" title="app/models/anchorage_assessment.rb">app/models/anchorage_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">122</td>
            <td class="cell--number">58</td>
            <td class="cell--number">58</td>
            <td class="cell--number">0</td>
            <td class="cell--number">41.50</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">21</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#86fba09fe130c3277a7a5bdac9f0aad0131ab3e8" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fa7d3016ba6cf1dc32ebc044a31953212b767260" class="src_link" title="app/models/concerns/custom_id_generator.rb">app/models/concerns/custom_id_generator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2335.36</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1d1e7732cc0270e451b4d483e31e1d9ad06c5dd6" class="src_link" title="app/models/concerns/has_dimensions.rb">app/models/concerns/has_dimensions.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.32 %</td>
            <td class="cell--number">327</td>
            <td class="cell--number">112</td>
            <td class="cell--number">109</td>
            <td class="cell--number">3</td>
            <td class="cell--number">4176.27</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">88.10 %</td>
              <td class="cell--number">42</td>
              <td class="cell--number">37</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#12e9e872e81880130d42cbd1bddda7a103a52a1a" class="src_link" title="app/models/concerns/public_field_filtering.rb">app/models/concerns/public_field_filtering.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">83.33 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">12</td>
            <td class="cell--number">10</td>
            <td class="cell--number">2</td>
            <td class="cell--number">6.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4ded2acd849c5c51b97d4bc2b4b0be79ee8a0919" class="src_link" title="app/models/enclosed_assessment.rb">app/models/enclosed_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">46</td>
            <td class="cell--number">27</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.11</td>
            
              <td class="green strong cell--number t-file__branch-coverage">92.86 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">13</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08aea826fb0620cb68e33848d2fb60b56b720a23" class="src_link" title="app/models/fan_assessment.rb">app/models/fan_assessment.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.19 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">27</td>
            <td class="cell--number">23</td>
            <td class="cell--number">4</td>
            <td class="cell--number">59.33</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#010fabbc8c36172b4d4e42b9565245b9a1233cf5" class="src_link" title="app/models/inspection.rb">app/models/inspection.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.53 %</td>
            <td class="cell--number">334</td>
            <td class="cell--number">179</td>
            <td class="cell--number">171</td>
            <td class="cell--number">8</td>
            <td class="cell--number">99.97</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">80.13 %</td>
              <td class="cell--number">151</td>
              <td class="cell--number">121</td>
              <td class="cell--number">30</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8776323918f8398e04f3a8486d1187e16ef9497e" class="src_link" title="app/models/inspector_company.rb">app/models/inspector_company.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.45 %</td>
            <td class="cell--number">92</td>
            <td class="cell--number">44</td>
            <td class="cell--number">42</td>
            <td class="cell--number">2</td>
            <td class="cell--number">97.98</td>
            
              <td class="red strong cell--number t-file__branch-coverage">78.57 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">11</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#da7ce9d80bd90065a1239b2385d0277c42e603ba" class="src_link" title="app/models/materials_assessment.rb">app/models/materials_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">103</td>
            <td class="cell--number">48</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">48.98</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">12</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9e9cda40ae503f6906b8f584507be92c7bf50b9f" class="src_link" title="app/models/safety_standard.rb">app/models/safety_standard.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.18 %</td>
            <td class="cell--number">483</td>
            <td class="cell--number">166</td>
            <td class="cell--number">158</td>
            <td class="cell--number">8</td>
            <td class="cell--number">185.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">79.25 %</td>
              <td class="cell--number">53</td>
              <td class="cell--number">42</td>
              <td class="cell--number">11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a5ad64b76c0f806107a781f63f22de1c553326e3" class="src_link" title="app/models/slide_assessment.rb">app/models/slide_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">77</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.29</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ec57a6530a39d730b7d87397dad01f8ba7d5e2ba" class="src_link" title="app/models/structure_assessment.rb">app/models/structure_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">116</td>
            <td class="cell--number">51</td>
            <td class="cell--number">51</td>
            <td class="cell--number">0</td>
            <td class="cell--number">51.49</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5f4c3cffed132540e0e1364ed5c20dccfcfb2506" class="src_link" title="app/models/unit.rb">app/models/unit.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.00 %</td>
            <td class="cell--number">110</td>
            <td class="cell--number">50</td>
            <td class="cell--number">47</td>
            <td class="cell--number">3</td>
            <td class="cell--number">24.92</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">12</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8714519f1352fa42b775c0da5c04703be3ecd20d" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.50 %</td>
            <td class="cell--number">69</td>
            <td class="cell--number">40</td>
            <td class="cell--number">39</td>
            <td class="cell--number">1</td>
            <td class="cell--number">561.93</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">90.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">9</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0d029daa2e29990c0bfd180cfa08c002abf4463e" class="src_link" title="app/models/user_height_assessment.rb">app/models/user_height_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.28 %</td>
            <td class="cell--number">120</td>
            <td class="cell--number">58</td>
            <td class="cell--number">57</td>
            <td class="cell--number">1</td>
            <td class="cell--number">30.95</td>
            
              <td class="red strong cell--number t-file__branch-coverage">77.78 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">14</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c1210ff40c88ee2e719b4f2542f942a2def6b83d" class="src_link" title="app/services/image_processor_service.rb">app/services/image_processor_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.33</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3b87c4567efc2b958daeba281681433377238a42" class="src_link" title="app/services/json_serializer_service.rb">app/services/json_serializer_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">137</td>
            <td class="cell--number">51</td>
            <td class="cell--number">51</td>
            <td class="cell--number">0</td>
            <td class="cell--number">169.73</td>
            
              <td class="red strong cell--number t-file__branch-coverage">73.68 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">28</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#56b8ef4f91ac464ef6832098c18c843c539454eb" class="src_link" title="app/services/ntfy_service.rb">app/services/ntfy_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">21</td>
            <td class="cell--number">21</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e338be25c71450ce99a063b898621a3f4db2d1ac" class="src_link" title="app/services/pdf_generator_service.rb">app/services/pdf_generator_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.39 %</td>
            <td class="cell--number">708</td>
            <td class="cell--number">327</td>
            <td class="cell--number">325</td>
            <td class="cell--number">2</td>
            <td class="cell--number">108.28</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">82.93 %</td>
              <td class="cell--number">123</td>
              <td class="cell--number">102</td>
              <td class="cell--number">21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#99d09a1db65b6c0de036bf1de77a4d861dc56882" class="src_link" title="app/services/qr_code_service.rb">app/services/qr_code_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.00 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">20</td>
            <td class="cell--number">19</td>
            <td class="cell--number">1</td>
            <td class="cell--number">90.65</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6af6e7148eda8cbcb7f0db60c80b24c30fd73de0" class="src_link" title="lib/i18n_usage_tracker.rb">lib/i18n_usage_tracker.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.95 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">74</td>
            <td class="cell--number">71</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2538.41</td>
            
              <td class="red strong cell--number t-file__branch-coverage">70.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">17</td>
              <td class="cell--number">7</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#944fbd53bd59c95c47086a4e762f306615f653b5" class="src_link" title="lib/tasks/storage_cleanup.rake">lib/tasks/storage_cleanup.rake</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="green">
  96.22%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1977.16
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>7</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>555</b> relevant lines,
    <span class="green"><b>534</b> lines covered</span> and
    <span class="red"><b>21</b> lines missed. </span>
    (<span class="green">
  96.22%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>218</b> total branches, </span>
      <span class="green"><b>189</b> branches covered</span> and
      <span class="red"><b>29</b> branches missed.</span>
      (<span class="yellow">
  86.7%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#db87b5689ad9e4ea79ba2821eac99cd31dce48d6" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">73</td>
            <td class="cell--number">35</td>
            <td class="cell--number">35</td>
            <td class="cell--number">0</td>
            <td class="cell--number">30891.77</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#651d7297887ccd04189d05d93595f53c8682187a" class="src_link" title="app/controllers/home_controller.rb">app/controllers/home_controller.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.72 %</td>
            <td class="cell--number">158</td>
            <td class="cell--number">72</td>
            <td class="cell--number">61</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">68.57 %</td>
              <td class="cell--number">35</td>
              <td class="cell--number">24</td>
              <td class="cell--number">11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8c27b422e6ca84d76374722ca618c6661ec2e9db" class="src_link" title="app/controllers/inspections_controller.rb">app/controllers/inspections_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.99 %</td>
            <td class="cell--number">451</td>
            <td class="cell--number">199</td>
            <td class="cell--number">195</td>
            <td class="cell--number">4</td>
            <td class="cell--number">34.92</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">89.89 %</td>
              <td class="cell--number">89</td>
              <td class="cell--number">80</td>
              <td class="cell--number">9</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#06f34603d0da312971469bcb19fbdba9612fa7f6" class="src_link" title="app/controllers/inspector_companies_controller.rb">app/controllers/inspector_companies_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">81</td>
            <td class="cell--number">43</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0</td>
            <td class="cell--number">9.49</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ce1cb863974e61842b92505eefea4ca456507ed2" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">35</td>
            <td class="cell--number">22</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">252.09</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0b3f778b58c42d9ed9d5158148be1005132634b7" class="src_link" title="app/controllers/units_controller.rb">app/controllers/units_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.87 %</td>
            <td class="cell--number">231</td>
            <td class="cell--number">117</td>
            <td class="cell--number">111</td>
            <td class="cell--number">6</td>
            <td class="cell--number">17.13</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">86.84 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">33</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5b41f7262eb46e0d1cf1b8c69d09daf8db2cc0e1" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">129</td>
            <td class="cell--number">67</td>
            <td class="cell--number">67</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">95.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">23</td>
              <td class="cell--number">1</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="green">
  96.53%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         638.58
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>16</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>922</b> relevant lines,
    <span class="green"><b>890</b> lines covered</span> and
    <span class="red"><b>32</b> lines missed. </span>
    (<span class="green">
  96.53%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>374</b> total branches, </span>
      <span class="green"><b>306</b> branches covered</span> and
      <span class="red"><b>68</b> branches missed.</span>
      (<span class="yellow">
  81.82%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1402d36ddea733c453b8ff4f70c0ca7aae31e143" class="src_link" title="app/models/anchorage_assessment.rb">app/models/anchorage_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">122</td>
            <td class="cell--number">58</td>
            <td class="cell--number">58</td>
            <td class="cell--number">0</td>
            <td class="cell--number">41.50</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">21</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#86fba09fe130c3277a7a5bdac9f0aad0131ab3e8" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fa7d3016ba6cf1dc32ebc044a31953212b767260" class="src_link" title="app/models/concerns/custom_id_generator.rb">app/models/concerns/custom_id_generator.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2335.36</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1d1e7732cc0270e451b4d483e31e1d9ad06c5dd6" class="src_link" title="app/models/concerns/has_dimensions.rb">app/models/concerns/has_dimensions.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.32 %</td>
            <td class="cell--number">327</td>
            <td class="cell--number">112</td>
            <td class="cell--number">109</td>
            <td class="cell--number">3</td>
            <td class="cell--number">4176.27</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">88.10 %</td>
              <td class="cell--number">42</td>
              <td class="cell--number">37</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#12e9e872e81880130d42cbd1bddda7a103a52a1a" class="src_link" title="app/models/concerns/public_field_filtering.rb">app/models/concerns/public_field_filtering.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">83.33 %</td>
            <td class="cell--number">51</td>
            <td class="cell--number">12</td>
            <td class="cell--number">10</td>
            <td class="cell--number">2</td>
            <td class="cell--number">6.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4ded2acd849c5c51b97d4bc2b4b0be79ee8a0919" class="src_link" title="app/models/enclosed_assessment.rb">app/models/enclosed_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">46</td>
            <td class="cell--number">27</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.11</td>
            
              <td class="green strong cell--number t-file__branch-coverage">92.86 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">13</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08aea826fb0620cb68e33848d2fb60b56b720a23" class="src_link" title="app/models/fan_assessment.rb">app/models/fan_assessment.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.19 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">27</td>
            <td class="cell--number">23</td>
            <td class="cell--number">4</td>
            <td class="cell--number">59.33</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#010fabbc8c36172b4d4e42b9565245b9a1233cf5" class="src_link" title="app/models/inspection.rb">app/models/inspection.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.53 %</td>
            <td class="cell--number">334</td>
            <td class="cell--number">179</td>
            <td class="cell--number">171</td>
            <td class="cell--number">8</td>
            <td class="cell--number">99.97</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">80.13 %</td>
              <td class="cell--number">151</td>
              <td class="cell--number">121</td>
              <td class="cell--number">30</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8776323918f8398e04f3a8486d1187e16ef9497e" class="src_link" title="app/models/inspector_company.rb">app/models/inspector_company.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.45 %</td>
            <td class="cell--number">92</td>
            <td class="cell--number">44</td>
            <td class="cell--number">42</td>
            <td class="cell--number">2</td>
            <td class="cell--number">97.98</td>
            
              <td class="red strong cell--number t-file__branch-coverage">78.57 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">11</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#da7ce9d80bd90065a1239b2385d0277c42e603ba" class="src_link" title="app/models/materials_assessment.rb">app/models/materials_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">103</td>
            <td class="cell--number">48</td>
            <td class="cell--number">48</td>
            <td class="cell--number">0</td>
            <td class="cell--number">48.98</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">12</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9e9cda40ae503f6906b8f584507be92c7bf50b9f" class="src_link" title="app/models/safety_standard.rb">app/models/safety_standard.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.18 %</td>
            <td class="cell--number">483</td>
            <td class="cell--number">166</td>
            <td class="cell--number">158</td>
            <td class="cell--number">8</td>
            <td class="cell--number">185.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">79.25 %</td>
              <td class="cell--number">53</td>
              <td class="cell--number">42</td>
              <td class="cell--number">11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a5ad64b76c0f806107a781f63f22de1c553326e3" class="src_link" title="app/models/slide_assessment.rb">app/models/slide_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">77</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.29</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ec57a6530a39d730b7d87397dad01f8ba7d5e2ba" class="src_link" title="app/models/structure_assessment.rb">app/models/structure_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">116</td>
            <td class="cell--number">51</td>
            <td class="cell--number">51</td>
            <td class="cell--number">0</td>
            <td class="cell--number">51.49</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5f4c3cffed132540e0e1364ed5c20dccfcfb2506" class="src_link" title="app/models/unit.rb">app/models/unit.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.00 %</td>
            <td class="cell--number">110</td>
            <td class="cell--number">50</td>
            <td class="cell--number">47</td>
            <td class="cell--number">3</td>
            <td class="cell--number">24.92</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">12</td>
              <td class="cell--number">6</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8714519f1352fa42b775c0da5c04703be3ecd20d" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.50 %</td>
            <td class="cell--number">69</td>
            <td class="cell--number">40</td>
            <td class="cell--number">39</td>
            <td class="cell--number">1</td>
            <td class="cell--number">561.93</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">90.00 %</td>
              <td class="cell--number">10</td>
              <td class="cell--number">9</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0d029daa2e29990c0bfd180cfa08c002abf4463e" class="src_link" title="app/models/user_height_assessment.rb">app/models/user_height_assessment.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.28 %</td>
            <td class="cell--number">120</td>
            <td class="cell--number">58</td>
            <td class="cell--number">57</td>
            <td class="cell--number">1</td>
            <td class="cell--number">30.95</td>
            
              <td class="red strong cell--number t-file__branch-coverage">77.78 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">14</td>
              <td class="cell--number">4</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         918.47
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>107</b> relevant lines,
    <span class="green"><b>107</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>74</b> total branches, </span>
      <span class="green"><b>69</b> branches covered</span> and
      <span class="red"><b>5</b> branches missed.</span>
      (<span class="green">
  93.24%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9894e74a1bb433abb5cacbc3f991919fb78477e7" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">61</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">2403.27</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">12</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#85d6c3668e88de18c567acb888765e4f0cedc30b" class="src_link" title="app/helpers/inspections_helper.rb">app/helpers/inspections_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">100</td>
            <td class="cell--number">43</td>
            <td class="cell--number">43</td>
            <td class="cell--number">0</td>
            <td class="cell--number">119.88</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">89.58 %</td>
              <td class="cell--number">48</td>
              <td class="cell--number">43</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#7270708c9f971b4d6cc06004c9277ff4b4b7aa02" class="src_link" title="app/helpers/sessions_helper.rb">app/helpers/sessions_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">22</td>
            <td class="cell--number">22</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1380.64</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">8</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#5c60b996f371cb710fe6041818507b209a1ba878" class="src_link" title="app/helpers/units_helper.rb">app/helpers/units_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">36</td>
            <td class="cell--number">7</td>
            <td class="cell--number">7</td>
            <td class="cell--number">0</td>
            <td class="cell--number">26.14</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3f19ee0fc53266c4d75c7d985c47fd88eabec21d" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">15</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">8.78</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         4.1
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>20</b> relevant lines,
    <span class="green"><b>20</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>4</b> total branches, </span>
      <span class="green"><b>4</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#963e193313680e5d0ff51b825317e34d218746e2" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d58f8591b081a2f457313a7d4d0037a79c06d8ed" class="src_link" title="app/jobs/storage_cleanup_job.rb">app/jobs/storage_cleanup_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">43</td>
            <td class="cell--number">17</td>
            <td class="cell--number">17</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.76</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="green">
  96.2%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         2377.81
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>79</b> relevant lines,
    <span class="green"><b>76</b> lines covered</span> and
    <span class="red"><b>3</b> lines missed. </span>
    (<span class="green">
  96.2%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>24</b> total branches, </span>
      <span class="green"><b>17</b> branches covered</span> and
      <span class="red"><b>7</b> branches missed.</span>
      (<span class="red">
  70.83%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6af6e7148eda8cbcb7f0db60c80b24c30fd73de0" class="src_link" title="lib/i18n_usage_tracker.rb">lib/i18n_usage_tracker.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.95 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">74</td>
            <td class="cell--number">71</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2538.41</td>
            
              <td class="red strong cell--number t-file__branch-coverage">70.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">17</td>
              <td class="cell--number">7</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#944fbd53bd59c95c47086a4e762f306615f653b5" class="src_link" title="lib/tasks/storage_cleanup.rake">lib/tasks/storage_cleanup.rake</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">5</td>
            <td class="cell--number">5</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent">
      <span class="green">
  99.3%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         107.88
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Ungrouped"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>428</b> relevant lines,
    <span class="green"><b>425</b> lines covered</span> and
    <span class="red"><b>3</b> lines missed. </span>
    (<span class="green">
  99.3%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>175</b> total branches, </span>
      <span class="green"><b>142</b> branches covered</span> and
      <span class="red"><b>33</b> branches missed.</span>
      (<span class="yellow">
  81.14%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c1210ff40c88ee2e719b4f2542f942a2def6b83d" class="src_link" title="app/services/image_processor_service.rb">app/services/image_processor_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">9</td>
            <td class="cell--number">9</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.33</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3b87c4567efc2b958daeba281681433377238a42" class="src_link" title="app/services/json_serializer_service.rb">app/services/json_serializer_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">137</td>
            <td class="cell--number">51</td>
            <td class="cell--number">51</td>
            <td class="cell--number">0</td>
            <td class="cell--number">169.73</td>
            
              <td class="red strong cell--number t-file__branch-coverage">73.68 %</td>
              <td class="cell--number">38</td>
              <td class="cell--number">28</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#56b8ef4f91ac464ef6832098c18c843c539454eb" class="src_link" title="app/services/ntfy_service.rb">app/services/ntfy_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">21</td>
            <td class="cell--number">21</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e338be25c71450ce99a063b898621a3f4db2d1ac" class="src_link" title="app/services/pdf_generator_service.rb">app/services/pdf_generator_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">99.39 %</td>
            <td class="cell--number">708</td>
            <td class="cell--number">327</td>
            <td class="cell--number">325</td>
            <td class="cell--number">2</td>
            <td class="cell--number">108.28</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">82.93 %</td>
              <td class="cell--number">123</td>
              <td class="cell--number">102</td>
              <td class="cell--number">21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#99d09a1db65b6c0de036bf1de77a4d861dc56882" class="src_link" title="app/services/qr_code_service.rb">app/services/qr_code_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.00 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">20</td>
            <td class="cell--number">19</td>
            <td class="cell--number">1</td>
            <td class="cell--number">90.65</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.1<br/>
        using RSpec-, RSpec-10, RSpec-11, RSpec-12, RSpec-13, RSpec-14, RSpec-15, RSpec-16, RSpec-2, RSpec-3, RSpec-4, RSpec-5, RSpec-6, RSpec-7, RSpec-8, RSpec-9, Unit Tests
      </div>

      <div class="source_files">
      
        <div class="source_table" id="db87b5689ad9e4ea79ba2821eac99cd31dce48d6">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>35</b> relevant lines.
      <span class="green"><b>35</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="1">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Only allow modern browsers supporting webp images, web push, badges, import maps, CSS nesting, and CSS :has.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="3">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  allow_browser versions: :modern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="5">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  include SessionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="7">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="8">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  before_action :update_last_active_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # Performance tracking for debug info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="11">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  before_action :start_debug_timer, if: :admin_debug_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="13">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="15">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="667" data-linenumber="16">
            
              <span class="hits">667</span>
            

            
              
                <span class="hits" title="else branch hit 637 times">
                  else: 637
                </span>
              
                <span class="hits" title="then branch hit 30 times">
                  then: 30
                </span>
              
            

            <code class="ruby">    unless logged_in?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="17">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;authorization.login_required&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="18">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">      redirect_to login_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="22">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def update_last_active_at</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2137" data-linenumber="23">
            
              <span class="hits">2137</span>
            

            
              
                <span class="hits" title="then branch hit 1087 times">
                  then: 1087
                </span>
              
                <span class="hits" title="else branch hit 1050 times">
                  else: 1050
                </span>
              
                <span class="hits" title="then branch hit 1087 times">
                  then: 1087
                </span>
              
                <span class="hits" title="else branch hit 1050 times">
                  else: 1050
                </span>
              
            

            <code class="ruby">    if current_user&amp;.is_a?(User)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1087" data-linenumber="24">
            
              <span class="hits">1087</span>
            

            
              
            

            <code class="ruby">      current_user.update(last_active_at: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="28">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def require_admin</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="33" data-linenumber="29">
            
              <span class="hits">33</span>
            

            
              
                <span class="hits" title="then branch hit 33 times">
                  then: 33
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 24 times">
                  else: 24
                </span>
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
            

            <code class="ruby">    unless current_user&amp;.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="30">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;authorization.admin_required&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="31">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="35">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def admin_debug_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3393" data-linenumber="36">
            
              <span class="hits">3393</span>
            

            
              
                <span class="hits" title="then branch hit 1899 times">
                  then: 1899
                </span>
              
                <span class="hits" title="else branch hit 1493 times">
                  else: 1493
                </span>
              
            

            <code class="ruby">    Rails.env.development? || current_user&amp;.admin? || impersonating?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="39">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def impersonating?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    # Check if we have an original admin ID stored (indicating impersonation is active)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3223" data-linenumber="41">
            
              <span class="hits">3223</span>
            

            
              
            

            <code class="ruby">    session[:original_admin_id].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="44">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def start_debug_timer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="170" data-linenumber="45">
            
              <span class="hits">170</span>
            

            
              
            

            <code class="ruby">    @debug_start_time = Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="170" data-linenumber="46">
            
              <span class="hits">170</span>
            

            
              
            

            <code class="ruby">    @debug_sql_queries = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    # Subscribe to SQL queries for this request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="170" data-linenumber="49">
            
              <span class="hits">170</span>
            

            
              
            

            <code class="ruby">    ActiveSupport::Notifications.subscribe(&quot;sql.active_record&quot;) do |name, start, finish, id, payload|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="358257" data-linenumber="50">
            
              <span class="hits">358257</span>
            

            
              
                <span class="hits" title="else branch hit 2763 times">
                  else: 2763
                </span>
              
                <span class="hits" title="then branch hit 355494 times">
                  then: 355494
                </span>
              
            

            <code class="ruby">      unless payload[:name] == &quot;SCHEMA&quot; || payload[:sql] =~ /^PRAGMA/</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="355494" data-linenumber="51">
            
              <span class="hits">355494</span>
            

            
              
            

            <code class="ruby">        @debug_sql_queries &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">          sql: payload[:sql],</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="355494" data-linenumber="53">
            
              <span class="hits">355494</span>
            

            
              
            

            <code class="ruby">          duration: ((finish - start) * 1000).round(2),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">          name: payload[:name]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  # Make debug data available to views</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="61">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  helper_method :admin_debug_enabled?, :impersonating?, :debug_render_time, :debug_sql_queries</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="63">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def debug_render_time</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    # Calculate time since request started</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="128" data-linenumber="65">
            
              <span class="hits">128</span>
            

            
              
                <span class="hits" title="then branch hit 128 times">
                  then: 128
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if @debug_start_time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="128" data-linenumber="66">
            
              <span class="hits">128</span>
            

            
              
            

            <code class="ruby">      ((Time.current - @debug_start_time) * 1000).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="70">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def debug_sql_queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="327" data-linenumber="71">
            
              <span class="hits">327</span>
            

            
              
            

            <code class="ruby">    @debug_sql_queries || []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="651d7297887ccd04189d05d93595f53c8682187a">
  <div class="header">
    <h3>app/controllers/home_controller.rb</h3>
    <h4>
      <span class="yellow">
  84.72%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  68.57%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>72</b> relevant lines.
      <span class="green"><b>61</b> lines covered</span> and
      <span class="red"><b>11</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>35</b> total branches, </span>
          <span class="green"><b>24</b> branches covered</span> and
          <span class="red"><b>11</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="1">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">class HomeController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="2">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="3">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  skip_before_action :verify_authenticity_token, only: [:safety_standards]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="5">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="8">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def about</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="11">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def safety_standards</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    # Always provide calculation metadata for the view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="13">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">    @calculation_metadata = SafetyStandard.calculation_metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="15">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="then branch hit 20 times">
                  then: 20
                </span>
              
            

            <code class="ruby">    if request.post? &amp;&amp; params[:calculation].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="16">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      calculate_safety_standard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="17">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="18">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="19">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">        format.json { render json: build_json_response }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="20">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">        format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">          # Preserve calculation params for the redirect so form values are maintained</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">          redirect_to safety_standards_path(calculation: params[:calculation].to_unsafe_h)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
                <span class="hits" title="else branch hit 35 times">
                  else: 35
                </span>
              
            

            <code class="ruby">      # Handle GET requests with calculation parameters (from redirect)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="27">
            
              <span class="hits">35</span>
            

            
              
                <span class="hits" title="then branch hit 18 times">
                  then: 18
                </span>
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">      if params[:calculation].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="28">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">        calculate_safety_standard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="30">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="31">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        format.html</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="36">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="38">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def calculate_safety_standard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="39">
            
              <span class="hits">38</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    case params[:calculation][:type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
                <span class="hits" title="when branch hit 18 times">
                  when: 18
                </span>
              
            

            <code class="ruby">    when &quot;anchors&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="41">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      calculate_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
                <span class="hits" title="when branch hit 7 times">
                  when: 7
                </span>
              
            

            <code class="ruby">    when &quot;user_capacity&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="43">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      calculate_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;slide_runout&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="45">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      calculate_slide_runout</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
                <span class="hits" title="when branch hit 8 times">
                  when: 8
                </span>
              
            

            <code class="ruby">    when &quot;wall_height&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="47">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      calculate_wall_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="51">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def calculate_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="52">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    area = params[:calculation][:area].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="53">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 15 times">
                  then: 15
                </span>
              
            

            <code class="ruby">    if area &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      @anchor_result = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="55">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">        area: area,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">        required_anchors: SafetyStandard.calculate_required_anchors(area),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        formula_breakdown: &quot;((#{area}² × 114) ÷ 1600) × 1.5 = #{SafetyStandard.calculate_required_anchors(area)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="60">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      @anchor_error = t(&quot;safety_standards_reference.errors.invalid_area&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="64">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def calculate_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="65">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    length = params[:calculation][:length].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="66">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    width = params[:calculation][:width].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="67">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    negative_adjustment = params[:calculation][:negative_adjustment].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="69">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">    if length &gt; 0 &amp;&amp; width &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      @capacity_result = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="71">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        length: length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">        width: width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">        area: length * width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">        negative_adjustment: negative_adjustment,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="75">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        usable_area: (length * width) - negative_adjustment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        capacities: SafetyStandard.calculate_user_capacity(length, width, negative_adjustment)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="79">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      @capacity_error = t(&quot;safety_standards_reference.errors.invalid_dimensions&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="83">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def calculate_slide_runout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="84">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    platform_height = params[:calculation][:platform_height].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="86">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    if platform_height &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="87">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      required_runout = SafetyStandard.calculate_required_runout(platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      @runout_result = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="89">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        platform_height: platform_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">        required_runout: required_runout,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        calculation: &quot;50% of #{platform_height}m = #{platform_height * 0.5}m, minimum 0.3m = #{required_runout}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="93">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">      @runout_error = t(&quot;safety_standards_reference.errors.invalid_platform_height&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="98">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def calculate_wall_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="99">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    user_height = params[:calculation][:user_height].to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="101">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
            

            <code class="ruby">    if user_height &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      @wall_height_result = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="103">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        user_height: user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">        requirement: wall_height_requirement_text(user_height),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">        requires_roof: SafetyStandard.requires_permanent_roof?(user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="107">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            

            
              
            

            <code class="ruby">      @wall_height_error = t(&quot;safety_standards_reference.errors.invalid_user_height&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="112">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def wall_height_requirement_text(user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="113">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    thresholds = SafetyStandard::SLIDE_HEIGHT_THRESHOLDS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="114">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    case user_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when 0..thresholds[:no_walls_required]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="116">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;No containing walls required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when thresholds[:no_walls_required]..thresholds[:basic_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="118">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;Walls must be at least #{user_height}m (equal to user height)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when thresholds[:basic_walls]..thresholds[:enhanced_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="120">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;Walls must be at least #{(user_height * 1.25).round(2)}m (1.25× user height)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when thresholds[:enhanced_walls]..thresholds[:max_safe_height]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="122">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;Walls must be at least #{(user_height * 1.25).round(2)}m + permanent roof required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="123">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            

            
              
            

            <code class="ruby">      &quot;Exceeds safe height limits (&gt;#{thresholds[:max_safe_height]}m)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="128">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def build_json_response</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="129">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    case params[:calculation][:type]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;anchors&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="131">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      if @anchor_result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="132">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        {success: true, result: @anchor_result}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="134">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        {success: false, error: @anchor_error}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;user_capacity&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="137">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      if @capacity_result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        {success: true, result: @capacity_result}</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="139">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            

            
              
            

            <code class="ruby">        {success: false, error: @capacity_error}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="142">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;slide_runout&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="143">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      if @runout_result</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            

            
              
            

            <code class="ruby">        {success: true, result: @runout_result}</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="145">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            

            
              
            

            <code class="ruby">        {success: false, error: @runout_error}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="148">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;wall_height&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="149">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      if @wall_height_result</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            

            
              
            

            <code class="ruby">        {success: true, result: @wall_height_result}</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="151">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            

            
              
            

            <code class="ruby">        {success: false, error: @wall_height_error}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="154">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="155">
            

            
              
            

            <code class="ruby">      {success: false, error: &quot;Invalid calculation type&quot;}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8c27b422e6ca84d76374722ca618c6661ec2e9db">
  <div class="header">
    <h3>app/controllers/inspections_controller.rb</h3>
    <h4>
      <span class="green">
  97.99%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  89.89%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>199</b> relevant lines.
      <span class="green"><b>195</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>89</b> total branches, </span>
          <span class="green"><b>80</b> branches covered</span> and
          <span class="red"><b>9</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="1">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">class InspectionsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="2">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  before_action :set_inspection, except: [:index, :create]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="3">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  before_action :check_inspection_owner, except: [:index, :create, :report, :qr_code]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="4">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  before_action :redirect_if_complete, except: [:show, :mark_draft, :report, :qr_code, :index, :create, :destroy]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="5">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  before_action :no_index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="6">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: [:report, :qr_code]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="8">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    # Base filtered query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="10">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    filtered_inspections = current_user.inspections</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      .search(params[:query])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      .filter_by_result(params[:result])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      .filter_by_unit(params[:unit_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      .order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    # Split into draft and complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="17">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    @draft_inspections = filtered_inspections.draft</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="18">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    @complete_inspections = filtered_inspections.complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="20">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    @title = build_index_title</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="22">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="23">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="24">
            
              <span class="hits">71</span>
            

            
              
            

            <code class="ruby">      format.csv { send_data inspections_to_csv, filename: &quot;inspections-#{Date.today}.csv&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="28">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="29">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="30">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="31">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">      format.pdf do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="32">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        pdf_data = PdfGeneratorService.generate_inspection_report(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="33">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        @inspection.update(pdf_last_accessed_at: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="35">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        send_data pdf_data.render,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">          filename: &quot;PAT_Report_#{@inspection.serial}.pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">          type: &quot;application/pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">          disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="43">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    # Handle unit_id from URL parameter (from unit show page button)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="45">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    unit_id = params[:unit_id] || inspection_params[:unit_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="46">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    unit = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="48">
            
              <span class="hits">26</span>
            

            
              
                <span class="hits" title="else branch hit 22 times">
                  else: 22
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    unless current_user.inspection_company_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="49">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = current_user.inspection_company_required_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="50">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      redirect_to unit_id.present? ? unit_path(unit_id) : root_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="53">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="else branch hit 19 times">
                  else: 19
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    unless current_user.can_create_inspection?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="54">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = current_user.inspection_company_required_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="55">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      redirect_to unit_id.present? ? unit_path(unit_id) : root_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="58">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    if unit_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
                <span class="hits" title="then branch hit 16 times">
                  then: 16
                </span>
              
            

            <code class="ruby">      # Securely handle unit association</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="60">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      unit = current_user.units.find_by(id: unit_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="61">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
            

            <code class="ruby">      if unit.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        flash[:alert] = I18n.t(&quot;inspections.errors.invalid_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to root_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    # Create minimal inspection with just the unit and default values</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="68">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @inspection = current_user.inspections.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      unit: unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      inspection_date: Date.current,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      inspector_company_id: current_user.inspection_company_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      inspection_location: current_user.default_inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    # Copy dimensions from unit before saving</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="76">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @inspection.send(:copy_unit_values)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="78">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">    if @inspection.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="79">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">      if Rails.env.production?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        NtfyService.notify(&quot;new inspection by #{current_user.email}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="83">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">      flash[:notice] = if unit.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="84">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;inspections.messages.created_without_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="86">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;inspections.messages.created&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="88">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;inspections.errors.creation_failed&quot;, errors: @inspection.errors.full_messages.join(&quot;, &quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      redirect_to unit.present? ? unit_path(unit) : root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="95">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    # Build assessments if they don&#39;t exist yet and pre-fill with inspection attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="97">
            
              <span class="hits">133</span>
            

            
              
            

            <code class="ruby">    @inspection.build_assessments_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="100">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="101">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">    params = inspection_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    # Securely handle unit association</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="104">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 40 times">
                  else: 40
                </span>
              
            

            <code class="ruby">    if params[:unit_id].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      unit = current_user.units.find_by(id: params[:unit_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="107">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if unit.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">        # Unit ID not found or doesn&#39;t belong to user - security issue</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        flash[:alert] = I18n.t(&quot;inspections.errors.invalid_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="110">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        render :edit, status: :unprocessable_entity and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="114">
            
              <span class="hits">40</span>
            

            
              
                <span class="hits" title="then branch hit 35 times">
                  then: 35
                </span>
              
            

            <code class="ruby">    if @inspection.update(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="115">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="116">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="117">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">          flash[:notice] = I18n.t(&quot;inspections.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="118">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">          redirect_to @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="120">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">        format.json { render json: {status: &quot;success&quot;, inspection: @inspection} }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="121">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="122">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;inspection_progress_#{@inspection.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">              html: &quot;&lt;span class=&#39;value&#39;&gt;#{helpers.assessment_completion_percentage(@inspection)}%&lt;/span&gt;&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;completion_issues_#{@inspection.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">              partial: &quot;inspections/completion_issues&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">              locals: {inspection: @inspection}),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;inspection_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">                dom_id: &quot;inspection_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">                success: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">                success_message: t(&quot;inspections.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">              }),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;assessment_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">                dom_id: &quot;assessment_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">                success: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">                success_message: t(&quot;inspections.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">              })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="146">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="147">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="148">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        format.json { render json: {status: &quot;error&quot;, errors: @inspection.errors.full_messages} }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="149">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="150">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;inspection_progress_#{@inspection.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">              html: &quot;&lt;span class=&#39;value&#39;&gt;#{helpers.assessment_completion_percentage(@inspection)}%&lt;/span&gt;&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;completion_issues_#{@inspection.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">              partial: &quot;inspections/completion_issues&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">              locals: {inspection: @inspection}),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;inspection_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">                dom_id: &quot;inspection_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">                errors: @inspection.errors.full_messages,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">                error_message: t(&quot;shared.messages.save_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">              }),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;assessment_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">                dom_id: &quot;assessment_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">                errors: @inspection.errors.full_messages,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">                error_message: t(&quot;shared.messages.save_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">              })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="176">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="177">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    if @inspection.complete? &amp;&amp; !current_user.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="178">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to @inspection.preferred_path, alert: I18n.t(&quot;inspections.messages.delete_complete_denied&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="179">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="182">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @inspection.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="183">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    redirect_to inspections_path, notice: I18n.t(&quot;inspections.messages.deleted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="186">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def replace_dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="187">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @inspection.unit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="188">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @inspection.copy_attributes_from(@inspection.unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="190">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      if @inspection.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="191">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        flash[:notice] = t(&quot;inspections.messages.dimensions_replaced&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="192">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="193">
            

            
              
            

            <code class="ruby">        flash[:alert] = t(&quot;inspections.messages.dimensions_replace_failed&quot;, errors: @inspection.errors.full_messages.join(&quot;, &quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="196">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.messages.no_unit_for_dimensions&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="199">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    redirect_to edit_inspection_path(@inspection, tab: params[:tab] || &quot;general&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="202">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def select_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="203">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @units = current_user.units</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="204">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @title = t(&quot;inspections.titles.select_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">    # Apply the same filters as the units index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="207">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">    if params[:search].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="208">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      @units = @units.where(&quot;name LIKE ? OR serial LIKE ? OR manufacturer LIKE ?&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">        &quot;%#{params[:search]}%&quot;, &quot;%#{params[:search]}%&quot;, &quot;%#{params[:search]}%&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="212">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    if params[:manufacturer].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="213">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @units = @units.where(manufacturer: params[:manufacturer])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="216">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    if params[:has_slide].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="217">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @units = @units.where(has_slide: params[:has_slide] == &quot;true&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="220">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @units = @units.order(:name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="222">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    render :select_unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="225">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def update_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="226">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    unit = current_user.units.find_by(id: params[:unit_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="228">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    if unit.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="229">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.errors.invalid_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="230">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to select_unit_inspection_path(@inspection) and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">    # Update the inspection with the new unit and copy all dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="234">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @inspection.unit = unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="235">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @inspection.copy_attributes_from(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="237">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    if @inspection.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="238">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = t(&quot;inspections.messages.unit_changed&quot;, unit_name: unit.name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="239">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="240">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="241">
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.messages.unit_change_failed&quot;, errors: @inspection.errors.full_messages.join(&quot;, &quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="242">
            

            
              
            

            <code class="ruby">      redirect_to select_unit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="246">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def report</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="247">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="248">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="75" data-linenumber="249">
            
              <span class="hits">75</span>
            

            
              
            

            <code class="ruby">        pdf_data = PdfGeneratorService.generate_inspection_report(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="75" data-linenumber="251">
            
              <span class="hits">75</span>
            

            
              
            

            <code class="ruby">        @inspection.update(pdf_last_accessed_at: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="75" data-linenumber="253">
            
              <span class="hits">75</span>
            

            
              
            

            <code class="ruby">        send_data pdf_data.render,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">          filename: &quot;PAT_Report_#{@inspection.serial}.pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">          type: &quot;application/pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">          disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="259">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="260">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">        render json: JsonSerializerService.serialize_inspection(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="265">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def qr_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="266">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    qr_code_png = QrCodeService.generate_qr_code(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="268">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    send_data qr_code_png,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">      filename: &quot;PAT_Report_QR_#{@inspection.serial}.png&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">      type: &quot;image/png&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">      disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="274">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def complete</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby">    # Check if inspection can be completed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="276">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    validation_errors = @inspection.validate_completeness</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="278">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    if validation_errors.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="279">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.messages.cannot_complete&quot;, errors: validation_errors.join(&quot;, &quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="280">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="281">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="285">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      @inspection.complete!(current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="286">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = t(&quot;inspections.messages.marked_complete&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="287">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      redirect_to @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="289">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.messages.completion_failed&quot;, error: e.message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="290">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="294">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def mark_draft</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="295">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if @inspection.update(complete_date: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="296">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = t(&quot;inspections.messages.marked_in_progress&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="298">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspections.messages.mark_in_progress_failed&quot;, errors: @inspection.errors.full_messages.join(&quot;, &quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="300">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    redirect_to edit_inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="303">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="305">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def inspection_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">    # Get the base params with permitted top-level attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="307">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    inspection_specific_params = [:inspection_date, :inspection_location, :passed, :comments, :unit_id, :inspector_company_id, :unique_report_number]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="308">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    copyable_attributes = Inspection.new.copyable_attributes_via_reflection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="309">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    base_params = params.require(:inspection).permit(inspection_specific_params + copyable_attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby">    # For each assessment, dynamically permit attributes based on the model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">    assessment_types = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="313">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">      user_height_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby">      slide_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">      structure_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">      anchorage_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby">      materials_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">      fan_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">      enclosed_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="322">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    assessment_types.each do |assessment_type|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="329" data-linenumber="323">
            
              <span class="hits">329</span>
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 319 times">
                  then: 319
                </span>
              
            

            <code class="ruby">      next unless params[:inspection][&quot;#{assessment_type}_attributes&quot;].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">      # Get permitted attributes dynamically from the assessment model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="326">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      permitted_attrs = permitted_assessment_attributes(assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="10" data-linenumber="328">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if permitted_attrs.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="329">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">        base_params[&quot;#{assessment_type}_attributes&quot;] = </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            
              
            

            <code class="ruby">          params[:inspection][&quot;#{assessment_type}_attributes&quot;].permit(*permitted_attrs)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="334">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    base_params</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="337">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def permitted_assessment_attributes(assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            

            
              
            

            <code class="ruby">    # Convert assessment_type string to model class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="339">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    model_class = assessment_type.camelize.constantize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="341">
            

            
              
            

            <code class="ruby">    # Get all column names from the model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="342">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    all_attributes = model_class.column_names</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            
              
            

            <code class="ruby">    # Exclude system/protected attributes (but keep id for updates)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="345">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    excluded_attributes = %w[inspection_id created_at updated_at]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            

            
              
            

            <code class="ruby">    # Return the permitted attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="348">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    (all_attributes - excluded_attributes).map(&amp;:to_sym)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            

            
              
            

            <code class="ruby">  rescue NameError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
            

            <code class="ruby">    # If model class doesn&#39;t exist, return empty array</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="351">
            

            
              
            

            <code class="ruby">    []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="352">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="354">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def no_index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="435" data-linenumber="355">
            
              <span class="hits">435</span>
            

            
              
            

            <code class="ruby">    response.set_header(&quot;X-Robots-Tag&quot;, &quot;noindex,nofollow&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="358">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def set_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="359">
            

            
              
            

            <code class="ruby">    # Try exact match first, then case-insensitive match for user-friendly URLs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="380" data-linenumber="360">
            
              <span class="hits">380</span>
            

            
              
            

            <code class="ruby">    @inspection = Inspection.find_by(id: params[:id]) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="361">
            

            
              
            

            <code class="ruby">      Inspection.find_by(&quot;UPPER(id) = ?&quot;, params[:id].upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="362">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="380" data-linenumber="363">
            
              <span class="hits">380</span>
            

            
              
                <span class="hits" title="else branch hit 363 times">
                  else: 363
                </span>
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">    unless @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="364">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      if action_name.in?([&quot;report&quot;, &quot;qr_code&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
            

            <code class="ruby">        # For public report access, return 404 instead of redirect</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="366">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        render file: &quot;#{Rails.root}/public/404.html&quot;, status: :not_found, layout: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="368">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        flash[:alert] = I18n.t(&quot;inspections.errors.not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="369">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        redirect_to inspections_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="370">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="374">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def check_inspection_owner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="268" data-linenumber="375">
            
              <span class="hits">268</span>
            

            
              
                <span class="hits" title="else branch hit 259 times">
                  else: 259
                </span>
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
            

            <code class="ruby">    unless @inspection.user_id == current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="376">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;inspections.errors.access_denied&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="377">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      redirect_to inspections_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="378">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="381">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def redirect_if_complete</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="213" data-linenumber="382">
            
              <span class="hits">213</span>
            

            
              
                <span class="hits" title="then branch hit 213 times">
                  then: 213
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 206 times">
                  else: 206
                </span>
              
            

            <code class="ruby">    if @inspection&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="383">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;inspections.messages.cannot_edit_complete&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="384">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      redirect_to @inspection and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="386">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="387">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="388">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def inspections_to_csv</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="389">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    CSV.generate(headers: true) do |csv|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            
              
            

            <code class="ruby">      # Get headers dynamically</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="391">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      headers = csv_headers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="392">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      csv &lt;&lt; headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            

            
              
            

            <code class="ruby">      # Export whatever inspections are already filtered by the index action</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="395">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      @complete_inspections.includes(:unit, :inspector_company, :user).each do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="396">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        csv &lt;&lt; csv_row_data(inspection, headers)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="397">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="401">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def csv_headers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="402">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    headers = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="404">
            

            
              
            

            <code class="ruby">    # All inspection column names (excluding foreign keys we&#39;ll handle specially)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="405">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    excluded_columns = %w[user_id inspector_company_id unit_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="406">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    inspection_columns = Inspection.column_names - excluded_columns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="407">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    headers += inspection_columns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="408">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="409">
            

            
              
            

            <code class="ruby">    # Related model data with prefixes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="410">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    headers += %w[unit_name unit_serial unit_manufacturer unit_owner unit_description]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="411">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    headers += %w[inspector_company_name]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="412">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    headers += %w[inspector_user_email]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="413">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="414">
            

            
              
            

            <code class="ruby">    # Computed fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="415">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    headers += %w[complete]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="416">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="417">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="418">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="419">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="420">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def csv_row_data(inspection, headers)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="421">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    headers.map do |header|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="846" data-linenumber="422">
            
              <span class="hits">846</span>
            

            
              
            

            <code class="ruby">      case header</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="423">
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
            

            <code class="ruby">      # Unit fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="424">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      when &quot;unit_name&quot; then inspection.unit&amp;.name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="425">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      when &quot;unit_serial&quot; then inspection.unit&amp;.serial</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="426">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      when &quot;unit_manufacturer&quot; then inspection.unit&amp;.manufacturer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="427">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      when &quot;unit_owner&quot; then inspection.unit&amp;.owner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="428">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      when &quot;unit_description&quot; then inspection.unit&amp;.description</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="429">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="430">
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
            

            <code class="ruby">      # Inspector company</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="431">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      when &quot;inspector_company_name&quot; then inspection.inspector_company&amp;.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="432">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="433">
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
            

            <code class="ruby">      # User (inspector) fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="434">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      when &quot;inspector_user_email&quot; then inspection.user&amp;.email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="435">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="436">
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
            

            <code class="ruby">      # Special computed fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="437">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      when &quot;complete&quot; then inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="438">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="439">
            

            
              
            

            <code class="ruby">      # All other fields are direct inspection attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="440">
            

            
              
                <span class="hits" title="else branch hit 774 times">
                  else: 774
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="774" data-linenumber="441">
            
              <span class="hits">774</span>
            

            
              
                <span class="hits" title="then branch hit 774 times">
                  then: 774
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        inspection.send(header) if inspection.respond_to?(header)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="442">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="443">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="445">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="446">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  def build_index_title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="447">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    title = &quot;Inspections&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="448">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 52 times">
                  else: 52
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    title += &quot; - #{(params[:result] == &quot;passed&quot;) ? &quot;Passed&quot; : &quot;Failed&quot;}&quot; if params[:result].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="449">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    title</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="450">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="451">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="06f34603d0da312971469bcb19fbdba9612fa7f6">
  <div class="header">
    <h3>app/controllers/inspector_companies_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>43</b> relevant lines.
      <span class="green"><b>43</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>7</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="1">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">class InspectorCompaniesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="2">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  before_action :set_inspector_company, only: [:show, :edit, :update, :archive, :unarchive]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="3">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  before_action :require_login</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="4">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  before_action :require_admin, except: [:show]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="6">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="7">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">    @inspector_companies = InspectorCompany</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      .by_status(params[:active])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      .search_by_term(params[:search])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      .order(:name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="13">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @company_stats = @inspector_company.company_statistics</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @recent_inspections = @inspector_company.recent_inspections(5)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="18">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="19">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    @inspector_company = InspectorCompany.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="20">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    @inspector_company.country = &quot;UK&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="23">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="24">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    @inspector_company = InspectorCompany.new(inspector_company_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="26">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
            

            <code class="ruby">    if @inspector_company.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="27">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = t(&quot;inspector_companies.messages.created&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="28">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      redirect_to @inspector_company</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="30">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="34">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="37">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="38">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    if @inspector_company.update(inspector_company_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="39">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = t(&quot;inspector_companies.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="40">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      redirect_to @inspector_company</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="42">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      render :edit, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="46">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def archive</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="47">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    @inspector_company.update(active: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="48">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = t(&quot;inspector_companies.messages.archived&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="49">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    redirect_to inspector_companies_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="52">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def unarchive</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="53">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @inspector_company.update(active: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="54">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = t(&quot;inspector_companies.messages.unarchived&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="55">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    redirect_to inspector_companies_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="58">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="60">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def set_inspector_company</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="61">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    @inspector_company = InspectorCompany.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  rescue ActiveRecord::RecordNotFound</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    flash[:alert] = t(&quot;inspector_companies.messages.not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to inspector_companies_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="67">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def inspector_company_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="68">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    params.require(:inspector_company).permit(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      :name, :rpii_registration_number, :email, :phone, :address,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      :city, :state, :postal_code, :country,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      :active, :notes, :logo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="75">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def require_admin</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="70" data-linenumber="76">
            
              <span class="hits">70</span>
            

            
              
                <span class="hits" title="then branch hit 70 times">
                  then: 70
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 62 times">
                  else: 62
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
            

            <code class="ruby">    unless current_user&amp;.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="77">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = t(&quot;inspector_companies.messages.unauthorized&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="78">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ce1cb863974e61842b92505eefea4ca456507ed2">
  <div class="header">
    <h3>app/controllers/sessions_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>22</b> relevant lines.
      <span class="green"><b>22</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>8</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="1">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">class SessionsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="2">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: [:new, :create, :destroy]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="4">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="7">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="498" data-linenumber="8">
            
              <span class="hits">498</span>
            

            
              
            

            <code class="ruby">    email = params.dig(:session, :email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="498" data-linenumber="9">
            
              <span class="hits">498</span>
            

            
              
            

            <code class="ruby">    password = params.dig(:session, :password)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="498" data-linenumber="11">
            
              <span class="hits">498</span>
            

            
              
                <span class="hits" title="then branch hit 497 times">
                  then: 497
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if email.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="497" data-linenumber="12">
            
              <span class="hits">497</span>
            

            
              
            

            <code class="ruby">      user = User.find_by(email: email.downcase)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="497" data-linenumber="13">
            
              <span class="hits">497</span>
            

            
              
                <span class="hits" title="then branch hit 495 times">
                  then: 495
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 491 times">
                  then: 491
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">      if user&amp;.authenticate(password)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="491" data-linenumber="14">
            
              <span class="hits">491</span>
            

            
              
            

            <code class="ruby">        log_in user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="491" data-linenumber="15">
            
              <span class="hits">491</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">        if params[:session][:remember_me] == &quot;1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="16">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          cookies.permanent.signed[:user_id] = user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
                <span class="hits" title="else branch hit 488 times">
                  else: 488
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="488" data-linenumber="18">
            
              <span class="hits">488</span>
            

            
              
            

            <code class="ruby">          cookies.delete(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="491" data-linenumber="20">
            
              <span class="hits">491</span>
            

            
              
            

            <code class="ruby">        flash[:notice] = I18n.t(&quot;session.login.success&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="491" data-linenumber="21">
            
              <span class="hits">491</span>
            

            
              
            

            <code class="ruby">        redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="491" data-linenumber="22">
            
              <span class="hits">491</span>
            

            
              
            

            <code class="ruby">        return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="26">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    flash.now[:alert] = I18n.t(&quot;session.login.error&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="27">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="30">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="31">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    log_out</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="32">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;session.logout.success&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="33">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0b3f778b58c42d9ed9d5158148be1005132634b7">
  <div class="header">
    <h3>app/controllers/units_controller.rb</h3>
    <h4>
      <span class="green">
  94.87%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  86.84%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>117</b> relevant lines.
      <span class="green"><b>111</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>38</b> total branches, </span>
          <span class="green"><b>33</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="1">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">class UnitsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="2">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  before_action :set_unit, only: [:show, :edit, :update, :destroy, :report, :qr_code]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="3">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  before_action :check_unit_owner, only: [:show, :edit, :update, :destroy]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="4">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  before_action :require_inspection_company, only: [:new, :create]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="5">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  before_action :no_index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="6">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: [:report, :qr_code]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="8">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="9">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">    @units = current_user.units.order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    # Apply search</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="41" data-linenumber="12">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 41 times">
                  else: 41
                </span>
              
            

            <code class="ruby">    @units = @units.search(params[:query]) if params[:query].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    # Apply filters</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="41" data-linenumber="15">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 41 times">
                  else: 41
                </span>
              
            

            <code class="ruby">    @units = @units.overdue if params[:status] == &quot;overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="16">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 38 times">
                  else: 38
                </span>
              
            

            <code class="ruby">    @units = @units.where(manufacturer: params[:manufacturer]) if params[:manufacturer].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="17">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 40 times">
                  else: 40
                </span>
              
            

            <code class="ruby">    @units = @units.where(owner: params[:owner]) if params[:owner].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="19">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">    @title = &quot;Units&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="41" data-linenumber="20">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 41 times">
                  else: 41
                </span>
              
            

            <code class="ruby">    @title += &quot; - Overdue&quot; if params[:status] == &quot;overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="21">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 38 times">
                  else: 38
                </span>
              
            

            <code class="ruby">    @title += &quot; - #{params[:manufacturer]}&quot; if params[:manufacturer].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="22">
            
              <span class="hits">41</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 40 times">
                  else: 40
                </span>
              
            

            <code class="ruby">    @title += &quot; - #{params[:owner]}&quot; if params[:owner].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="24">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="25">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="26">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">      format.csv { send_data unit_to_csv, filename: &quot;unit-#{Date.today}.csv&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="30">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="31">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    @inspections = @unit.inspections.order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="33">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="34">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      format.html</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="35">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      format.json { render json: {id: @unit.id, name: @unit.name, serial: @unit.serial, manufacturer: @unit.manufacturer, has_slide: @unit.has_slide} }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="39">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="40">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @unit = Unit.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="43">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="44">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @unit = current_user.units.build(unit_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="46">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">    if @unit.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="47">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      process_photo_if_present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="48">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;units.messages.created&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="49">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      redirect_to @unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="51">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="55">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="58">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="59">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    if @unit.update(unit_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="60">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      process_photo_if_present</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="62">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="63">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="64">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          flash[:notice] = I18n.t(&quot;units.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="65">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          redirect_to @unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="67">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;unit_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">                dom_id: &quot;unit_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">                success: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">                success_message: t(&quot;units.messages.updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">              })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="81">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: {status: &quot;error&quot;, errors: @unit.errors.full_messages} }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;unit_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">              partial: &quot;shared/save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">              locals: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">                dom_id: &quot;unit_save_message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">                errors: @unit.errors.full_messages,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">                error_message: t(&quot;shared.messages.save_failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">              })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="98">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @unit.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;units.messages.deleted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to units_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="105">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def report</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="106">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="107">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">      format.html do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="108">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">        pdf_data = PdfGeneratorService.generate_unit_report(@unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="110">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">        send_data pdf_data.render,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">          filename: &quot;Equipment_History_#{@unit.serial}.pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">          type: &quot;application/pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">          disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="41" data-linenumber="116">
            
              <span class="hits">41</span>
            

            
              
            

            <code class="ruby">      format.json do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="117">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        render json: JsonSerializerService.serialize_unit(@unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="122">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def qr_code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="123">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    qr_code_png = QrCodeService.generate_qr_code(@unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="125">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    send_data qr_code_png,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">      filename: &quot;Equipment_History_QR_#{@unit.serial}.png&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      type: &quot;image/png&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      disposition: &quot;inline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="131">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def new_from_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="132">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    @inspection = current_user.inspections.find_by(id: params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="134">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="135">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.errors.inspection_not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="136">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="139">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    if @inspection.unit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.errors.inspection_has_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="141">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to inspection_path(@inspection) and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="144">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @unit = Unit.new(user: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="147">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def create_from_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="148">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @inspection = current_user.inspections.find_by(id: params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="150">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    unless @inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.errors.inspection_not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            

            
              
            

            <code class="ruby">      redirect_to root_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="155">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    if @inspection.unit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.errors.inspection_has_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            

            
              
            

            <code class="ruby">      redirect_to inspection_path(@inspection) and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="160">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @unit = current_user.units.build(unit_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="161">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @unit.copy_attributes_from(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="163">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if @unit.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="164">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      @inspection.update!(unit: @unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="165">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;units.messages.created_from_inspection&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="166">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to inspection_path(@inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="168">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :new_from_inspection, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="172">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="174">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def unit_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="175">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    unit_specific_params = [:name, :serial, :manufacturer, :photo, :description, :owner, :model, :manufacture_date, :notes]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="176">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    copyable_attributes = Unit.new.copyable_attributes_via_reflection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="177">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    params.require(:unit).permit(unit_specific_params + copyable_attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="180">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def no_index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="181">
            
              <span class="hits">189</span>
            

            
              
            

            <code class="ruby">    response.set_header(&quot;X-Robots-Tag&quot;, &quot;noindex,nofollow&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="184">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def set_unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="185">
            
              <span class="hits">122</span>
            

            
              
            

            <code class="ruby">    @unit = Unit.find_by(id: params[:id].upcase)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="122" data-linenumber="187">
            
              <span class="hits">122</span>
            

            
              
                <span class="hits" title="else branch hit 116 times">
                  else: 116
                </span>
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    unless @unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="188">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      if action_name.in?([&quot;report&quot;, &quot;qr_code&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">        # For public report access, return 404 instead of redirect</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="190">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        render file: &quot;#{Rails.root}/public/404.html&quot;, status: :not_found, layout: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="192">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        flash[:alert] = I18n.t(&quot;units.messages.not_found&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="193">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to units_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="198">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def check_unit_owner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="199">
            
              <span class="hits">71</span>
            

            
              
                <span class="hits" title="else branch hit 66 times">
                  else: 66
                </span>
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">    unless @unit.user_id == current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="200">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.messages.access_denied&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="201">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      redirect_to units_path and return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="205">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def process_photo_if_present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="206">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
            

            <code class="ruby">    nil unless @unit.photo.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">    # The ImageProcessorService will handle resizing when the image is displayed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">    # No need to process here as Rails Active Storage handles variants on demand</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="212">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def require_inspection_company</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="213">
            
              <span class="hits">30</span>
            

            
              
                <span class="hits" title="else branch hit 28 times">
                  else: 28
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    unless current_user.has_inspection_company?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="214">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;units.messages.inspection_company_required&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="215">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to units_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="219">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  def unit_to_csv</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="220">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attributes = %w[id name manufacturer serial has_slide]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="222">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    CSV.generate(headers: true) do |csv|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="223">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      csv &lt;&lt; attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="225">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      current_user.units.order(created_at: :desc).each do |unit|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="226">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        row = attributes.map { |attr| unit.send(attr) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="227">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        csv &lt;&lt; row</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5b41f7262eb46e0d1cf1b8c69d09daf8db2cc0e1">
  <div class="header">
    <h3>app/controllers/users_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  95.83%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>67</b> relevant lines.
      <span class="green"><b>67</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>24</b> total branches, </span>
          <span class="green"><b>23</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="1">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">class UsersController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="2">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  skip_before_action :require_login, only: [:new, :create]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="3">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  before_action :require_admin, only: [:index, :edit, :update, :destroy, :impersonate]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="4">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  before_action :set_user, only: [:edit, :update, :destroy, :change_password, :update_password, :change_settings, :update_settings, :impersonate]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="5">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  before_action :require_correct_user, only: [:change_password, :update_password, :change_settings, :update_settings]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="7">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="8">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    @users = User.includes(:inspections).all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    @active_jobs = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="10">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      storage_cleanup: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">        name: &quot;StorageCleanupJob&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">        scheduled: StorageCleanupJob.scheduled?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">        last_run: StorageCleanupJob.last_run_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        next_run: StorageCleanupJob.next_run_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="19">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="20">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @user = User.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="23">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="24">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    @user = User.new(user_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="25">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    if @user.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="26">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      if Rails.env.production?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        NtfyService.notify(&quot;new user: #{@user.email}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="30">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      log_in @user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="31">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;users.messages.account_created&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="32">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="34">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="38">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="41">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    # Convert empty string to nil for inspection_company_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="43">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    if params[:user][:inspection_company_id] == &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="44">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      params[:user][:inspection_company_id] = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="47">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    if @user.update(user_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="48">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;users.messages.user_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="49">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      redirect_to users_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :edit, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="55">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @user.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;users.messages.user_deleted&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to users_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="61">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def change_password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="64">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def update_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="65">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if @user.authenticate(params[:user][:current_password])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="66">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      if @user.update(password_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        flash[:notice] = I18n.t(&quot;users.messages.password_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        render :change_password, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @user.errors.add(:current_password, I18n.t(&quot;activerecord.errors.models.user.attributes.current_password.incorrect&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :change_password, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="78">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def impersonate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    # Store original admin user ID before impersonating</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    session[:original_admin_id] = current_user.id if current_user.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    log_in @user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    flash[:notice] = I18n.t(&quot;users.messages.impersonating&quot;, email: @user.email)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="86">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def change_settings</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="89">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def update_settings</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="90">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @user.update(settings_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      flash[:notice] = I18n.t(&quot;users.messages.settings_updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :change_settings, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="98">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="100">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def set_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="101">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    @user = User.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="104">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def user_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="105">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
            

            <code class="ruby">    if current_user&amp;.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="106">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      params.require(:user).permit(:email, :password, :password_confirmation, :inspection_limit, :inspection_company_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="108">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      params.require(:user).permit(:email, :password, :password_confirmation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">  # Using require_admin from ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="114">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def require_correct_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="115">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    unless current_user == @user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="116">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      action = action_name.include?(&quot;password&quot;) ? &quot;password&quot; : &quot;settings&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="117">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      flash[:alert] = I18n.t(&quot;users.messages.own_action_only&quot;, action: action)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="118">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      redirect_to root_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="122">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def password_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="123">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    params.require(:user).permit(:password, :password_confirmation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="126">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def settings_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="127">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    params.require(:user).permit(:time_display, :default_inspection_location, :theme)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9894e74a1bb433abb5cacbc3f991919fb78477e7">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  TIME_FORMATS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    &quot;date&quot; =&gt; &quot;%b %d, %Y&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">    &quot;time&quot; =&gt; &quot;%b %d, %Y - %H:%M&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def render_time(datetime)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="220" data-linenumber="8">
            
              <span class="hits">220</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 219 times">
                  else: 219
                </span>
              
            

            <code class="ruby">    return nil if datetime.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="219" data-linenumber="10">
            
              <span class="hits">219</span>
            

            
              
                <span class="hits" title="then branch hit 218 times">
                  then: 218
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    format = TIME_FORMATS[current_user&amp;.time_display] || TIME_FORMATS[&quot;date&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="219" data-linenumber="11">
            
              <span class="hits">219</span>
            

            
              
            

            <code class="ruby">    datetime.strftime(format)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def date_for_form(datetime)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="86" data-linenumber="15">
            
              <span class="hits">86</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 84 times">
                  else: 84
                </span>
              
            

            <code class="ruby">    return nil if datetime.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="84" data-linenumber="17">
            
              <span class="hits">84</span>
            

            
              
                <span class="hits" title="then branch hit 83 times">
                  then: 83
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 81 times">
                  then: 81
                </span>
              
            

            <code class="ruby">    if current_user&amp;.time_display == &quot;date&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="81" data-linenumber="18">
            
              <span class="hits">81</span>
            

            
              
            

            <code class="ruby">      datetime.to_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="20">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      datetime</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def scrollable_table(html_options = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="25">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">    content_tag(:div, class: &quot;table-container&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="26">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">      content_tag(:table, html_options, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  # Shared form field helper logic - requires explicit i18n_base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def form_field_setup(field, local_assigns, i18n_base: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    # Get form object - either passed directly or from wrapper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5567" data-linenumber="33">
            
              <span class="hits">5567</span>
            

            
              
            

            <code class="ruby">    form_object = local_assigns[:form] || @_current_form</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    # Require explicit i18n_base - no more guessing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5567" data-linenumber="36">
            
              <span class="hits">5567</span>
            

            
              
            

            <code class="ruby">    i18n_base = local_assigns[:i18n_base] || i18n_base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5567" data-linenumber="37">
            
              <span class="hits">5567</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5566 times">
                  else: 5566
                </span>
              
            

            <code class="ruby">    raise ArgumentError, &quot;i18n_base is required for form field setup&quot; if i18n_base.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    # Simple label key construction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5566" data-linenumber="40">
            
              <span class="hits">5566</span>
            

            
              
            

            <code class="ruby">    label_key = &quot;#{i18n_base}.#{field}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    # Get label, hint, placeholder - fail loudly if required keys are missing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5566" data-linenumber="43">
            
              <span class="hits">5566</span>
            

            
              
            

            <code class="ruby">    field_label = local_assigns[:label] || t(label_key, raise: true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    # Build hint and placeholder keys with proper structure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5565" data-linenumber="46">
            
              <span class="hits">5565</span>
            

            
              
            

            <code class="ruby">    base_parts = i18n_base.split(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5565" data-linenumber="47">
            
              <span class="hits">5565</span>
            

            
              
            

            <code class="ruby">    hint_key = (base_parts[0..-2] + [&quot;hints&quot;, field.to_s]).join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5565" data-linenumber="48">
            
              <span class="hits">5565</span>
            

            
              
            

            <code class="ruby">    placeholder_key = (base_parts[0..-2] + [&quot;placeholders&quot;, field.to_s]).join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5565" data-linenumber="50">
            
              <span class="hits">5565</span>
            

            
              
            

            <code class="ruby">    field_hint = local_assigns[:hint] || t(hint_key, default: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5565" data-linenumber="51">
            
              <span class="hits">5565</span>
            

            
              
            

            <code class="ruby">    field_placeholder = local_assigns[:placeholder] || t(placeholder_key, default: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5565" data-linenumber="54">
            
              <span class="hits">5565</span>
            

            
              
            

            <code class="ruby">      form_object: form_object,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      i18n_base: i18n_base,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      field_label: field_label,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      field_hint: field_hint,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      field_placeholder: field_placeholder</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="85d6c3668e88de18c567acb888765e4f0cedc30b">
  <div class="header">
    <h3>app/helpers/inspections_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  89.58%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>43</b> relevant lines.
      <span class="green"><b>43</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>48</b> total branches, </span>
          <span class="green"><b>43</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module InspectionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_inspection_count(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    count = user.inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="4">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if user.inspection_limit &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;#{count} / #{user.inspection_limit} inspections&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="7">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;#{count} inspections&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_result_badge(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="107" data-linenumber="12">
            
              <span class="hits">107</span>
            

            
              
                <span class="hits" title="then branch hit 83 times">
                  then: 83
                </span>
              
            

            <code class="ruby">    if inspection.passed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="83" data-linenumber="13">
            
              <span class="hits">83</span>
            

            
              
            

            <code class="ruby">      content_tag(:mark, &quot;PASS&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
                <span class="hits" title="else branch hit 24 times">
                  else: 24
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="15">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      content_tag(:mark, &quot;FAIL&quot;, style: &quot;background-color:#f2dede;color:#a94442;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_actions(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    actions = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="22">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">        label: t(&quot;inspections.buttons.update&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        url: edit_inspection_path(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    # Add delete action (always allowed now)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="28">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      label: t(&quot;inspections.buttons.delete&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      url: inspection_path(inspection),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      method: :delete,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      confirm: t(&quot;inspections.messages.delete_confirm&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      danger: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="36">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  # Tabbed inspection editing helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_tabs(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="283" data-linenumber="41">
            
              <span class="hits">283</span>
            

            
              
            

            <code class="ruby">    tabs = %w[general user_height]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    # Only show slide tab for inspections that have slides</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="283" data-linenumber="44">
            
              <span class="hits">283</span>
            

            
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 258 times">
                  else: 258
                </span>
              
            

            <code class="ruby">    if inspection.has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="45">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      tabs &lt;&lt; &quot;slide&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="283" data-linenumber="48">
            
              <span class="hits">283</span>
            

            
              
            

            <code class="ruby">    tabs += %w[structure anchorage materials fan]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    # Only show enclosed tab for totally enclosed inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="283" data-linenumber="51">
            
              <span class="hits">283</span>
            

            
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 258 times">
                  else: 258
                </span>
              
            

            <code class="ruby">    tabs &lt;&lt; &quot;enclosed&quot; if inspection.is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="283" data-linenumber="53">
            
              <span class="hits">283</span>
            

            
              
            

            <code class="ruby">    tabs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="56">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def current_tab</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="976" data-linenumber="57">
            
              <span class="hits">976</span>
            

            
              
            

            <code class="ruby">    params[:tab].presence || &quot;general&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="60">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def assessment_completion_percentage(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    # Check if inspection has any assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="162" data-linenumber="62">
            
              <span class="hits">162</span>
            

            
              
            

            <code class="ruby">    has_assessments = inspection.user_height_assessment.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">      inspection.structure_assessment.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      inspection.anchorage_assessment.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      inspection.materials_assessment.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      inspection.fan_assessment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    # Also check conditional assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="162" data-linenumber="69">
            
              <span class="hits">162</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 150 times">
                  else: 150
                </span>
              
            

            <code class="ruby">    if inspection.has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="70">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      has_assessments ||= inspection.slide_assessment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="162" data-linenumber="72">
            
              <span class="hits">162</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 150 times">
                  else: 150
                </span>
              
            

            <code class="ruby">    if inspection.is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="73">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      has_assessments ||= inspection.enclosed_assessment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="162" data-linenumber="76">
            
              <span class="hits">162</span>
            

            
              
                <span class="hits" title="else branch hit 144 times">
                  else: 144
                </span>
              
                <span class="hits" title="then branch hit 18 times">
                  then: 18
                </span>
              
            

            <code class="ruby">    return 0 unless has_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="78">
            
              <span class="hits">144</span>
            

            
              
            

            <code class="ruby">    total_assessments = inspection_tabs(inspection).count - 1 # Exclude &#39;general&#39; tab</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="144" data-linenumber="79">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 144 times">
                  else: 144
                </span>
              
            

            <code class="ruby">    return 0 if total_assessments == 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="81">
            
              <span class="hits">144</span>
            

            
              
            

            <code class="ruby">    completed_assessments = 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="144" data-linenumber="82">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 144 times">
                  then: 144
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 127 times">
                  else: 127
                </span>
              
            

            <code class="ruby">    completed_assessments += 1 if inspection.user_height_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="83">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 134 times">
                  then: 134
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 140 times">
                  else: 140
                </span>
              
            

            <code class="ruby">    completed_assessments += 1 if inspection.structure_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="84">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 134 times">
                  then: 134
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 136 times">
                  else: 136
                </span>
              
            

            <code class="ruby">    completed_assessments += 1 if inspection.anchorage_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="85">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 134 times">
                  then: 134
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 140 times">
                  else: 140
                </span>
              
            

            <code class="ruby">    completed_assessments += 1 if inspection.materials_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="86">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 134 times">
                  then: 134
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 140 times">
                  else: 140
                </span>
              
            

            <code class="ruby">    completed_assessments += 1 if inspection.fan_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    # Only count slide assessment if inspection has a slide</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="89">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 132 times">
                  else: 132
                </span>
              
            

            <code class="ruby">    if inspection.has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="12" data-linenumber="90">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">      completed_assessments += 1 if inspection.slide_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    # Only count enclosed assessment if inspection is totally enclosed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="94">
            
              <span class="hits">144</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 132 times">
                  else: 132
                </span>
              
            

            <code class="ruby">    if inspection.is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="12" data-linenumber="95">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">      completed_assessments += 1 if inspection.enclosed_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="144" data-linenumber="98">
            
              <span class="hits">144</span>
            

            
              
            

            <code class="ruby">    (completed_assessments.to_f / total_assessments * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="7270708c9f971b4d6cc06004c9277ff4b4b7aa02">
  <div class="header">
    <h3>app/helpers/sessions_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>22</b> relevant lines.
      <span class="green"><b>22</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>8</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module SessionsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_in(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="497" data-linenumber="3">
            
              <span class="hits">497</span>
            

            
              
            

            <code class="ruby">    session[:user_id] = user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def remember_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="7">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    cookies.permanent.signed[:user_id] = current_user.id if current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def forget_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="11">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    cookies.delete(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14517" data-linenumber="15">
            
              <span class="hits">14517</span>
            

            
              
                <span class="hits" title="then branch hit 11014 times">
                  then: 11014
                </span>
              
            

            <code class="ruby">    if session[:user_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11014" data-linenumber="16">
            
              <span class="hits">11014</span>
            

            
              
                <span class="hits" title="else branch hit 3503 times">
                  else: 3503
                </span>
              
            

            <code class="ruby">      @current_user ||= User.find_by(id: session[:user_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3503" data-linenumber="17">
            
              <span class="hits">3503</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 3499 times">
                  else: 3499
                </span>
              
            

            <code class="ruby">    elsif cookies.signed[:user_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="18">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      user = User.find_by(id: cookies.signed[:user_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="19">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      if user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        log_in user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        @current_user = user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def logged_in?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="660" data-linenumber="27">
            
              <span class="hits">660</span>
            

            
              
            

            <code class="ruby">    !current_user.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_out</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="31">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    session.delete(:user_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="32">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    session.delete(:original_admin_id)  # Clear impersonation tracking</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="33">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    forget_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="34">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @current_user = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5c60b996f371cb710fe6041818507b209a1ba878">
  <div class="header">
    <h3>app/helpers/units_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>7</b> relevant lines.
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module UnitsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def manufacturer_options(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="3">
            
              <span class="hits">37</span>
            

            
              
            

            <code class="ruby">    user.units.distinct.pluck(:manufacturer).compact.reject(&amp;:blank?).sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def owner_options(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="7">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    user.units.distinct.pluck(:owner).compact.reject(&amp;:blank?).sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def unit_actions(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="59" data-linenumber="13">
            
              <span class="hits">59</span>
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;ui.edit&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        url: edit_unit_path(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;units.buttons.pdf_report&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        url: report_unit_path(unit),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">        target: &quot;_blank&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;units.buttons.delete&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        url: unit,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        method: :delete,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        danger: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        label: I18n.t(&quot;units.buttons.add_inspection&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        url: inspections_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">        method: :post,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        params: {unit_id: unit.id},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">        confirm: I18n.t(&quot;units.messages.add_inspection_confirm&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3f19ee0fc53266c4d75c7d985c47fd88eabec21d">
  <div class="header">
    <h3>app/helpers/users_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module UsersHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def admin_status(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="3">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    user.admin? ? &quot;Yes&quot; : &quot;No&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_count(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="7">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    count = user.inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="8">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    &quot;#{count} #{(count == 1) ? &quot;inspection&quot; : &quot;inspections&quot;}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def format_job_time(time)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="12">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return &quot;Never&quot; unless time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    &quot;#{time_ago_in_words(time)} ago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="963e193313680e5d0ff51b825317e34d218746e2">
  <div class="header">
    <h3>app/jobs/application_job.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">class ApplicationJob &lt; ActiveJob::Base</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Automatically retry jobs that encountered a deadlock</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="3">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  retry_on ActiveRecord::Deadlocked</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Most jobs are safe to ignore if the underlying records are no longer available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="6">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  discard_on ActiveJob::DeserializationError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d58f8591b081a2f457313a7d4d0037a79c06d8ed">
  <div class="header">
    <h3>app/jobs/storage_cleanup_job.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>17</b> relevant lines.
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">class StorageCleanupJob &lt; ApplicationJob</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="2">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  queue_as :default</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Class variable to track last execution and next scheduled time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="5">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  cattr_accessor :last_run_at, :next_run_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="7">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def perform</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    # Find unattached blobs older than 2 days and schedule them for deletion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="9">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    count = ActiveStorage::Blob.unattached</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      .where(&quot;active_storage_blobs.created_at &lt;= ?&quot;, 2.days.ago)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      .count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    # Only log if we found something to clean up</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="14">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if count &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="15">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      Rails.logger.info &quot;StorageCleanupJob: Found #{count} unattached blobs to clean up&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    # Process in batches to avoid memory issues</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="19">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    ActiveStorage::Blob.unattached</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      .where(&quot;active_storage_blobs.created_at &lt;= ?&quot;, 2.days.ago)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      .find_each(&amp;:purge_later)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    # Update last run time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="24">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    self.class.last_run_at = Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    # Schedule next run - this makes it easier to test</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="27">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    schedule_next_run</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  # Re-schedule itself to run daily</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="31">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def schedule_next_run</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="32">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if Rails.env.production? || Rails.env.development?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      next_time = 1.day.from_now</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      self.class.next_run_at = next_time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      self.class.set(wait: 1.day).perform_later</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  # Check if a job is scheduled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="40">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def self.scheduled?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="41">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    next_run_at.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1402d36ddea733c453b8ff4f70c0ca7aae31e143">
  <div class="header">
    <h3>app/models/anchorage_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>58</b> relevant lines.
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>24</b> total branches, </span>
          <span class="green"><b>21</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - Anchorage Assessment model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class AnchorageAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Anchor counts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :num_low_anchors, :num_high_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0, only_integer: true}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Pass/fail assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :num_anchors_pass, :anchor_accessories_pass, :anchor_degree_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    :anchor_type_pass, :pull_strength_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_save :update_anchor_calculations, if: :saved_change_to_anchor_counts?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="414" data-linenumber="19">
            
              <span class="hits">414</span>
            

            
              
            

            <code class="ruby">    anchor_counts_present? &amp;&amp; anchor_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meets_anchor_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="80" data-linenumber="23">
            
              <span class="hits">80</span>
            

            
              
                <span class="hits" title="else branch hit 80 times">
                  else: 80
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless total_anchors.present? &amp;&amp; inspection.unit.area.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="80" data-linenumber="25">
            
              <span class="hits">80</span>
            

            
              
            

            <code class="ruby">    required_anchors = SafetyStandard.calculate_required_anchors(inspection.unit.area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="80" data-linenumber="26">
            
              <span class="hits">80</span>
            

            
              
            

            <code class="ruby">    total_anchors &gt;= required_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="29">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_critical_failures?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="30">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    [anchor_type_pass, pull_strength_pass].any? { |check| check == false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="33">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def total_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="201" data-linenumber="34">
            
              <span class="hits">201</span>
            

            
              
            

            <code class="ruby">    (num_low_anchors || 0) + (num_high_anchors || 0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="37">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def required_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="15" data-linenumber="38">
            
              <span class="hits">15</span>
            

            
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return 0 unless inspection.unit.area.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="39">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.calculate_required_anchors(inspection.unit.area)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchor_compliance_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="43">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return &quot;Not Assessed&quot; unless total_anchors.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="45">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if meets_anchor_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Compliant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="48">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      &quot;Non-Compliant (Requires #{required_anchors} total anchors, has #{total_anchors})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="52">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_check_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="53">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    5 # All anchor-related pass/fail checks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="56">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_checks_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="57">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    [num_anchors_pass, anchor_accessories_pass, anchor_degree_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      anchor_type_pass, pull_strength_pass].count(true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="62">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    total_fields = 7 # Total assessable fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">    completed_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="64">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      num_low_anchors, num_high_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      num_anchors_pass, anchor_accessories_pass, anchor_degree_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      anchor_type_pass, pull_strength_pass</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="67">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">    ].count { |field| !field.nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="69">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    (completed_fields.to_f / total_fields * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="72">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchor_distribution</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="73">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return {} unless num_low_anchors.present? &amp;&amp; num_high_anchors.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="76">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      low_anchors: num_low_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      high_anchors: num_high_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      total: total_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      required: required_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="80">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      percentage_low: (num_low_anchors.to_f / total_anchors * 100).round(1),</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="81">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      percentage_high: (num_high_anchors.to_f / total_anchors * 100).round(1)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchor_safety_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="86">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    issues = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="88">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
            

            <code class="ruby">    issues &lt;&lt; &quot;Insufficient total anchors&quot; unless meets_anchor_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="89">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    issues &lt;&lt; &quot;Anchor type non-compliant&quot; if anchor_type_pass == false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="90">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
            

            <code class="ruby">    issues &lt;&lt; &quot;Pull strength insufficient&quot; if pull_strength_pass == false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="91">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    issues &lt;&lt; &quot;Anchor angle incorrect&quot; if anchor_degree_pass == false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="92">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    issues &lt;&lt; &quot;Missing anchor accessories&quot; if anchor_accessories_pass == false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="94">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    issues.empty? ? &quot;All anchor requirements met&quot; : issues.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="99">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchor_counts_present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="477" data-linenumber="100">
            
              <span class="hits">477</span>
            

            
              
            

            <code class="ruby">    num_low_anchors.present? &amp;&amp; num_high_anchors.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="103">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchor_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="104">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">    [num_anchors_pass, anchor_accessories_pass, anchor_degree_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      anchor_type_pass, pull_strength_pass].none?(&amp;:nil?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="108">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def saved_change_to_anchor_counts?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="109">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">    saved_change_to_num_low_anchors? || saved_change_to_num_high_anchors?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="112">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_anchor_calculations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">    # Auto-update num_anchors_pass based on calculations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="114">
            
              <span class="hits">61</span>
            

            
              
                <span class="hits" title="then branch hit 52 times">
                  then: 52
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    if anchor_counts_present? &amp;&amp; inspection.unit.area.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="115">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">      update_column(:num_anchors_pass, meets_anchor_requirements?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="119">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_assessment_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="120">
            
              <span class="hits">27</span>
            

            
              
            

            <code class="ruby">    inspection.log_audit_action(&quot;assessment_updated&quot;, inspection.user, &quot;Anchorage Assessment updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="86fba09fe130c3277a7a5bdac9f0aad0131ab3e8">
  <div class="header">
    <h3>app/models/application_record.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class ApplicationRecord &lt; ActiveRecord::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  primary_abstract_class</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fa7d3016ba6cf1dc32ebc044a31953212b767260">
  <div class="header">
    <h3>app/models/concerns/custom_id_generator.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  included do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="5">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">    self.primary_key = &quot;id&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4513" data-linenumber="6">
            
              <span class="hits">4513</span>
            

            
              
            

            <code class="ruby">    before_create :generate_custom_id, if: -&gt; { id.blank? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class_methods do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def generate_random_id(scope_conditions = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5598" data-linenumber="11">
            
              <span class="hits">5598</span>
            

            
              
            

            <code class="ruby">      loop do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5599" data-linenumber="12">
            
              <span class="hits">5599</span>
            

            
              
            

            <code class="ruby">        id = SecureRandom.alphanumeric(12).upcase</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5599" data-linenumber="13">
            
              <span class="hits">5599</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 5598 times">
                  then: 5598
                </span>
              
            

            <code class="ruby">        break id unless exists?({id: id}.merge(scope_conditions))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def generate_custom_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5595" data-linenumber="21">
            
              <span class="hits">5595</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5594 times">
                  else: 5594
                </span>
              
            

            <code class="ruby">    scope_conditions = respond_to?(:uniqueness_scope) ? uniqueness_scope : {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5595" data-linenumber="22">
            
              <span class="hits">5595</span>
            

            
              
            

            <code class="ruby">    self.id = self.class.generate_random_id(scope_conditions)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1d1e7732cc0270e451b4d483e31e1d9ad06c5dd6">
  <div class="header">
    <h3>app/models/concerns/has_dimensions.rb</h3>
    <h4>
      <span class="green">
  97.32%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  88.1%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>112</b> relevant lines.
      <span class="green"><b>109</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>42</b> total branches, </span>
          <span class="green"><b>37</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Shared concern for models that have dimension fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module HasDimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  included do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    # Basic dimension validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="7">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    validates :width, :length, :height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      presence: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      numericality: {greater_than: 0, less_than: 200},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      allow_nil: true # Allow nil for optional dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    # Optional dimension validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="13">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    validates :num_low_anchors, :num_high_anchors, :exit_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      :users_at_1000mm, :users_at_1200mm, :users_at_1500mm, :users_at_1800mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      numericality: {only_integer: true, greater_than_or_equal_to: 0},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="18">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    validates :rope_size, :slide_platform_height, :slide_wall_height, :runout_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      :slide_first_metre_height, :slide_beyond_first_metre_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      :stitch_length, :unit_pressure_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      :blower_tube_length, :step_size_value, :fall_off_height_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      :trough_depth_value, :trough_width_value, :containing_wall_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      :platform_height, :tallest_user_height, :play_area_length, :play_area_width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      :negative_adjustment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      numericality: {greater_than_or_equal_to: 0},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    # Scopes for dimensional queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="29">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    scope :within_dimensions, -&gt;(width, length, height) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      where(&quot;width &lt;= ? AND length &lt;= ? AND height &lt;= ?&quot;, width, length, height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="33">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    scope :by_area_range, -&gt;(min_area, max_area) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      where(&quot;(width * length) BETWEEN ? AND ?&quot;, min_area, max_area)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="39">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="40">
            
              <span class="hits">68</span>
            

            
              
                <span class="hits" title="else branch hit 67 times">
                  else: 67
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return nil unless width.present? &amp;&amp; length.present? &amp;&amp; height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    # Format dimensions nicely - show integers without decimals</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="67" data-linenumber="43">
            
              <span class="hits">67</span>
            

            
              
                <span class="hits" title="then branch hit 58 times">
                  then: 58
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    w = (width % 1 == 0) ? width.to_i : width</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="67" data-linenumber="44">
            
              <span class="hits">67</span>
            

            
              
                <span class="hits" title="then branch hit 67 times">
                  then: 67
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    l = (length % 1 == 0) ? length.to_i : length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="67" data-linenumber="45">
            
              <span class="hits">67</span>
            

            
              
                <span class="hits" title="then branch hit 66 times">
                  then: 66
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    h = (height % 1 == 0) ? height.to_i : height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="67" data-linenumber="47">
            
              <span class="hits">67</span>
            

            
              
            

            <code class="ruby">    &quot;#{w}m × #{l}m × #{h}m&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def area</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="249" data-linenumber="51">
            
              <span class="hits">249</span>
            

            
              
                <span class="hits" title="then branch hit 248 times">
                  then: 248
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    width * length if width.present? &amp;&amp; length.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def volume</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="55">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    width * length * height if width.present? &amp;&amp; length.present? &amp;&amp; height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  # Attribute groups for better organization and DRY code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="59">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def basic_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            

            
              
            

            <code class="ruby">      width: width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      length: length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">      height: height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      width_comment: width_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      length_comment: length_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      height_comment: height_comment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def anchorage_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="72">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">      num_low_anchors: num_low_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      num_high_anchors: num_high_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      num_anchors_comment: [num_low_anchors_comment, num_high_anchors_comment].compact.join(&quot;; &quot;).presence</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="78">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def enclosed_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="131" data-linenumber="80">
            
              <span class="hits">131</span>
            

            
              
            

            <code class="ruby">      exit_number: exit_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      exit_number_comment: exit_number_comment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def materials_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="123" data-linenumber="87">
            
              <span class="hits">123</span>
            

            
              
            

            <code class="ruby">      rope_size: rope_size,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      rope_size_comment: rope_size_comment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="92">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def slide_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="94">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      slide_platform_height: slide_platform_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      slide_wall_height: slide_wall_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      runout_value: runout_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      slide_first_metre_height: slide_first_metre_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      slide_beyond_first_metre_height: slide_beyond_first_metre_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">      slide_permanent_roof: slide_permanent_roof,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      slide_platform_height_comment: slide_platform_height_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      slide_wall_height_comment: slide_wall_height_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      runout_comment: runout_value_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      slide_first_metre_height_comment: slide_first_metre_height_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      slide_beyond_first_metre_height_comment: slide_beyond_first_metre_height_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      slide_permanent_roof_comment: slide_permanent_roof_comment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="109">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def structure_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="123" data-linenumber="111">
            
              <span class="hits">123</span>
            

            
              
            

            <code class="ruby">      stitch_length: stitch_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      unit_pressure_value: unit_pressure_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      blower_tube_length: blower_tube_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      step_size_value: step_size_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      fall_off_height_value: fall_off_height_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      trough_depth_value: trough_depth_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      trough_width_value: trough_width_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="121">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def user_height_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="123">
            
              <span class="hits">117</span>
            

            
              
            

            <code class="ruby">      containing_wall_height: containing_wall_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">      platform_height: platform_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      tallest_user_height: tallest_user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">      users_at_1000mm: users_at_1000mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      users_at_1200mm: users_at_1200mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      users_at_1500mm: users_at_1500mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      users_at_1800mm: users_at_1800mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">      play_area_length: play_area_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">      play_area_width: play_area_width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      negative_adjustment: negative_adjustment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      permanent_roof: permanent_roof,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      containing_wall_height_comment: containing_wall_height_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      platform_height_comment: platform_height_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      permanent_roof_comment: permanent_roof_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      play_area_length_comment: play_area_length_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      play_area_width_comment: play_area_width_comment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      negative_adjustment_comment: negative_adjustment_comment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="143">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def copyable_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">    # Use reflection-based approach to get all copyable attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="145">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">    copyable_attrs = copyable_attributes_via_reflection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    # Create a hash with current values for these attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="148">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">    copyable_attrs.each_with_object({}) do |attr, hash|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2242" data-linenumber="149">
            
              <span class="hits">2242</span>
            

            
              
                <span class="hits" title="then branch hit 2242 times">
                  then: 2242
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if respond_to?(attr)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2242" data-linenumber="150">
            
              <span class="hits">2242</span>
            

            
              
            

            <code class="ruby">        hash[attr] = send(attr)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">    end.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">  # Alias for backward compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="156">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def dimension_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="157">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">    copyable_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="160">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_slide_attributes?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="161">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    slide_platform_height.present? || slide_wall_height.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">      runout_value.present? || slide_first_metre_height.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">      slide_beyond_first_metre_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="166">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_structure_attributes?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="167">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    stitch_length.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">      unit_pressure_value.present? || blower_tube_length.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">      step_size_value.present? || fall_off_height_value.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">      trough_depth_value.present? || trough_width_value.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="173">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_user_height_attributes?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="174">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    containing_wall_height.present? || platform_height.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">      tallest_user_height.present? || play_area_length.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">      play_area_width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="179">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_anchorage_attributes?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="180">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    num_low_anchors.present? || num_high_anchors.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="183">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def total_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="184">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    (num_low_anchors || 0) + (num_high_anchors || 0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="187">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def max_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="188">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    [users_at_1000mm, users_at_1200mm, users_at_1500mm, users_at_1800mm].compact.max || 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">  # Copy all attributes from another object (dimensions, comments, flags, etc.)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="192">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def copy_attributes_from(source)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1882" data-linenumber="193">
            
              <span class="hits">1882</span>
            

            
              
            

            <code class="ruby">    copy_shared_attributes(source)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">  # Alias for backward compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="197">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def copy_dimensions_from(source)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="198">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    copy_attributes_from(source)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">  # Copy all shared attributes from another object using reflection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="202">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def copy_shared_attributes(source)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1882" data-linenumber="203">
            
              <span class="hits">1882</span>
            

            
              
                <span class="hits" title="else branch hit 1881 times">
                  else: 1881
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless source</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1881" data-linenumber="204">
            
              <span class="hits">1881</span>
            

            
              
                <span class="hits" title="else branch hit 1879 times">
                  else: 1879
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return unless source.respond_to?(:attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">    # Get all attribute names from the source object</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1879" data-linenumber="207">
            
              <span class="hits">1879</span>
            

            
              
            

            <code class="ruby">    source_attributes = source.attributes.keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">    # Get all setter methods on this object</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="223460" data-linenumber="210">
            
              <span class="hits">223460</span>
            

            
              
            

            <code class="ruby">    my_setters = methods.grep(/=$/).map { |m| m.to_s.chomp(&quot;=&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">    # Find common attributes (source has the attribute and we have a setter for it)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1879" data-linenumber="213">
            
              <span class="hits">1879</span>
            

            
              
            

            <code class="ruby">    common_attributes = source_attributes &amp; my_setters</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">    # Copy each copyable attribute</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1879" data-linenumber="216">
            
              <span class="hits">1879</span>
            

            
              
            

            <code class="ruby">    (common_attributes - excluded_copyable_attributes).each do |attr|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110861" data-linenumber="217">
            
              <span class="hits">110861</span>
            

            
              
            

            <code class="ruby">      value = source.send(attr)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="110861" data-linenumber="218">
            
              <span class="hits">110861</span>
            

            
              
                <span class="hits" title="then branch hit 110861 times">
                  then: 110861
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      send(&quot;#{attr}=&quot;, value) if value.present? || source.send(&quot;#{attr}?&quot;) == false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">  # Get list of copyable attributes using reflection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="223">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def copyable_attributes_via_reflection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">    # Get column names from this model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="225">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    my_columns = self.class.column_names</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">    # Get column names from the other model we copy to/from</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="228">
            
              <span class="hits">102</span>
            

            
              
                <span class="hits" title="then branch hit 53 times">
                  then: 53
                </span>
              
            

            <code class="ruby">    other_columns = if instance_of?(Unit) &amp;&amp; defined?(Inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="229">
            
              <span class="hits">53</span>
            

            
              
                <span class="hits" title="else branch hit 49 times">
                  else: 49
                </span>
              
            

            <code class="ruby">      Inspection.column_names</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="230">
            
              <span class="hits">49</span>
            

            
              
                <span class="hits" title="then branch hit 47 times">
                  then: 47
                </span>
              
            

            <code class="ruby">    elsif instance_of?(Inspection) &amp;&amp; defined?(Unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="231">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">      Unit.column_names</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      # Fallback to just this model&#39;s columns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="234">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      my_columns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">    # Find common attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="238">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    common_attributes = my_columns &amp; other_columns</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">    # Remove excluded attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="241">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    (common_attributes - excluded_copyable_attributes).map(&amp;:to_sym)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">  # Check if any copyable attribute has changed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="245">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def attributes_changed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="246">
            

            
              
            

            <code class="ruby">    copyable_attributes.keys.any? { |attr| send(&quot;#{attr}_changed?&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">  # Alias for backward compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="250">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def dimension_changed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="251">
            

            
              
            

            <code class="ruby">    attributes_changed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">  # Assessment pre-filling methods (for inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="255">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_assessments_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="133" data-linenumber="256">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 133 times">
                  else: 133
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless respond_to?(:user_height_assessment)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="258">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
                <span class="hits" title="then branch hit 117 times">
                  then: 117
                </span>
              
            

            <code class="ruby">    build_user_height_assessment_with_attributes unless user_height_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="259">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
            

            <code class="ruby">    build_slide_assessment_with_attributes unless slide_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="260">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 123 times">
                  then: 123
                </span>
              
            

            <code class="ruby">    build_structure_assessment_with_attributes unless structure_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="261">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
                <span class="hits" title="then branch hit 118 times">
                  then: 118
                </span>
              
            

            <code class="ruby">    build_anchorage_assessment_with_attributes unless anchorage_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="262">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 123 times">
                  then: 123
                </span>
              
            

            <code class="ruby">    build_materials_assessment_with_attributes unless materials_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="263">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
            

            <code class="ruby">    build_fan_assessment unless fan_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="133" data-linenumber="264">
            
              <span class="hits">133</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 131 times">
                  then: 131
                </span>
              
            

            <code class="ruby">    build_enclosed_assessment_with_attributes unless enclosed_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="267">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">  # Attributes that should never be copied between models</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="270">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def excluded_copyable_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">    %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1987" data-linenumber="272">
            
              <span class="hits">1987</span>
            

            
              
            

            <code class="ruby">      id created_at updated_at user_id unit_id inspection_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">      unique_report_number status passed comments recommendations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">      general_notes inspector_signature signature_timestamp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby">      pdf_last_accessed_at inspection_date inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">      name serial manufacturer model owner description</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby">      manufacture_date condition notes serial_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="281">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_user_height_assessment_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="117" data-linenumber="282">
            
              <span class="hits">117</span>
            

            
              
            

            <code class="ruby">    build_user_height_assessment(user_height_attributes.compact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="285">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_slide_assessment_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="286">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    build_slide_assessment(slide_attributes.compact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="289">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_structure_assessment_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="123" data-linenumber="290">
            
              <span class="hits">123</span>
            

            
              
            

            <code class="ruby">    build_structure_assessment(structure_attributes.compact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="293">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_anchorage_assessment_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="118" data-linenumber="294">
            
              <span class="hits">118</span>
            

            
              
            

            <code class="ruby">    build_anchorage_assessment(anchorage_attributes.compact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="297">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_materials_assessment_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="123" data-linenumber="298">
            
              <span class="hits">123</span>
            

            
              
            

            <code class="ruby">    build_materials_assessment(materials_attributes.compact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="301">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def build_enclosed_assessment_with_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="131" data-linenumber="302">
            
              <span class="hits">131</span>
            

            
              
            

            <code class="ruby">    build_enclosed_assessment(enclosed_attributes.compact)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="305">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module ClassMethods</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">    # Find units/inspections with similar dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="307">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def with_similar_dimensions(reference, tolerance: 0.1)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="308">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return none unless reference.respond_to?(:width) &amp;&amp; reference.width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="310">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      width_range = (reference.width * (1 - tolerance))..(reference.width * (1 + tolerance))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="311">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      length_range = (reference.length * (1 - tolerance))..(reference.length * (1 + tolerance))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="312">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      height_range = (reference.height * (1 - tolerance))..(reference.height * (1 + tolerance))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="314">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      where(width: width_range, length: length_range, height: height_range)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby">    # Statistical methods for dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="318">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def dimension_statistics</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="320">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        width: {avg: average(:width), min: minimum(:width), max: maximum(:width)},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
            

            <code class="ruby">        length: {avg: average(:length), min: minimum(:length), max: maximum(:length)},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">        height: {avg: average(:height), min: minimum(:height), max: maximum(:height)},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            
              
            

            <code class="ruby">        area: {avg: average(&quot;width * length&quot;), min: minimum(&quot;width * length&quot;), max: maximum(&quot;width * length&quot;)}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="12e9e872e81880130d42cbd1bddda7a103a52a1a">
  <div class="header">
    <h3>app/models/concerns/public_field_filtering.rb</h3>
    <h4>
      <span class="yellow">
  83.33%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>12</b> relevant lines.
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Shared concern for defining which fields should be excluded from public output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"># Used by both PDF generation and JSON serialization to ensure consistency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="3">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">module PublicFieldFiltering</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="4">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # System/metadata fields to exclude from public outputs (shared)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  EXCLUDED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="8">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    created_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    pdf_last_accessed_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    user_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    unit_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    inspector_company_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    inspector_signature</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    signature_timestamp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    inspection_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  # Additional fields to exclude from PDFs specifically</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  PDF_EXCLUDED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="22">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    complete_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    inspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    unique_report_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    general_notes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    recommendations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  # Fields excluded from PDFs (combines shared + PDF-specific)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="30">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  PDF_TOTAL_EXCLUDED_FIELDS = (EXCLUDED_FIELDS + PDF_EXCLUDED_FIELDS).freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  # Computed fields to exclude from public outputs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  EXCLUDED_COMPUTED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="34">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    reinspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  # Unit-specific exclusions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  UNIT_EXCLUDED_FIELDS = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="39">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    notes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="42">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  class_methods do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="43">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    def public_fields</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="44">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      column_names - EXCLUDED_FIELDS - ((self == Unit) ? UNIT_EXCLUDED_FIELDS : [])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="47">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    def excluded_fields_for_assessment(klass_name)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">      EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4ded2acd849c5c51b97d4bc2b4b0be79ee8a0919">
  <div class="header">
    <h3>app/models/enclosed_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  92.86%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>13</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class EnclosedAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_id, presence: true, uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :exit_number, numericality: {greater_than: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # Required assessment methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="9">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">    exit_number.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      exit_number_pass.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      exit_visible_pass.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="15">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    total_fields = 3 # exit_number, exit_number_pass, exit_visible_pass</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="16">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    completed_fields = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="18">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    completed_fields += 1 if exit_number.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="19">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    completed_fields += 1 if exit_number_pass.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="20">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    completed_fields += 1 if exit_visible_pass.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="22">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    (completed_fields.to_f / total_fields * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_checks_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="26">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    count = 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="27">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    count += 1 if exit_number_pass == true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="28">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    count += 1 if exit_visible_pass == true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="29">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_check_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="33">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    2 # exit_number_pass and exit_visible_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_critical_failures?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="37">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    exit_number_pass == false || exit_visible_pass == false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def critical_failure_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="41">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    failures = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="42">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    failures &lt;&lt; &quot;Insufficient exits&quot; if exit_number_pass == false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="43">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    failures &lt;&lt; &quot;Exits not clearly visible&quot; if exit_visible_pass == false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="44">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    failures.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="08aea826fb0620cb68e33848d2fb60b56b720a23">
  <div class="header">
    <h3>app/models/fan_assessment.rb</h3>
    <h4>
      <span class="yellow">
  85.19%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class FanAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_id, presence: true, uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # Fan safety checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  SAFETY_CHECKS = %w[blower_flap_pass blower_finger_pass blower_visual_pass pat_pass].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Pass/fail validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  SAFETY_CHECKS.each do |check|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="11">
            
              <span class="hits">68</span>
            

            
              
            

            <code class="ruby">    validates check.to_sym, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="405" data-linenumber="15">
            
              <span class="hits">405</span>
            

            
              
            

            <code class="ruby">    safety_checks_assessed? &amp;&amp; specifications_present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_critical_failures?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">    SAFETY_CHECKS.any? { |check| send(check) == false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="22">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_check_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    SAFETY_CHECKS.length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_checks_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="27">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    SAFETY_CHECKS.count { |check| send(check) == true }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    total_fields = 6 # 4 safety checks + serial + comment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    completed_fields = (</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="33">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      SAFETY_CHECKS.map { |check| send(check) } +</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      [blower_serial, fan_size_comment]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    ).count(&amp;:present?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    (completed_fields.to_f / total_fields * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_issues_summary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">    failures = SAFETY_CHECKS.select { |check| send(check) == false }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="42">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot;No safety issues&quot; if failures.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">    &quot;Safety issues: #{failures.map(&amp;:humanize).join(&quot;, &quot;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_checks_assessed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="861" data-linenumber="50">
            
              <span class="hits">861</span>
            

            
              
            

            <code class="ruby">    SAFETY_CHECKS.all? { |check| !send(check).nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def specifications_present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    blower_serial.present? &amp;&amp; fan_size_comment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="010fabbc8c36172b4d4e42b9565245b9a1233cf5">
  <div class="header">
    <h3>app/models/inspection.rb</h3>
    <h4>
      <span class="green">
  95.53%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  80.13%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>179</b> relevant lines.
      <span class="green"><b>171</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>151</b> total branches, </span>
          <span class="green"><b>121</b> branches covered</span> and
          <span class="red"><b>30</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Inspection &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include HasDimensions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :unit, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspector_company</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Assessment associations (normalized from single table)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one :user_height_assessment, class_name: &quot;UserHeightAssessment&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  alias_method :tallest_user_height_assessment, :user_height_assessment  # Alias for new field name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one :slide_assessment, class_name: &quot;SlideAssessment&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one :structure_assessment, class_name: &quot;StructureAssessment&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one :anchorage_assessment, class_name: &quot;AnchorageAssessment&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one :materials_assessment, class_name: &quot;MaterialsAssessment&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one :fan_assessment, class_name: &quot;FanAssessment&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one :enclosed_assessment, class_name: &quot;EnclosedAssessment&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  # Accept nested attributes for all assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  accepts_nested_attributes_for :user_height_assessment, :slide_assessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    :structure_assessment, :anchorage_assessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    :materials_assessment, :fan_assessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    :enclosed_assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  # Validations - allow drafts to be incomplete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_location, presence: true, if: :complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_date, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :unique_report_number, presence: true, uniqueness: {scope: :user_id}, if: :complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  # Step/Ramp Size validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :step_ramp_size, numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :step_ramp_size_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  # Critical Fall Off Height validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :critical_fall_off_height, numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :critical_fall_off_height_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  # Unit Pressure validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="39">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :unit_pressure, numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :unit_pressure_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  # Trough validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :trough_depth, numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="44">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :trough_adjacent_panel_width, numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="45">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :trough_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  # Entrapment validation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="48">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :entrapment_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  # Markings/ID validation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="51">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :markings_id_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  # Grounding validation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :grounding_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  # Additional pass/fail validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :clamber_netting_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="58">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :retention_netting_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="59">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :zips_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="60">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :windows_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :artwork_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="62">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :exit_sign_visible_pass, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="65">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_validation :set_inspector_company_from_user, on: :create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="66">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_validation :copy_unit_values, on: :create, if: :unit_id_changed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="67">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_create :generate_unique_report_number, if: :complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="68">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_create :copy_unit_values</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="69">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_save :auto_determine_pass_fail, if: :all_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="72">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">  scope :passed, -&gt; { where(passed: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="73">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">  scope :failed, -&gt; { where(passed: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="154" data-linenumber="74">
            
              <span class="hits">154</span>
            

            
              
            

            <code class="ruby">  scope :complete, -&gt; { where.not(complete_date: nil) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="81" data-linenumber="75">
            
              <span class="hits">81</span>
            

            
              
            

            <code class="ruby">  scope :draft, -&gt; { where(complete_date: nil) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="76">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :search, -&gt;(query) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="79" data-linenumber="77">
            
              <span class="hits">79</span>
            

            
              
                <span class="hits" title="then branch hit 15 times">
                  then: 15
                </span>
              
            

            <code class="ruby">    if query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="78">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      joins(&quot;LEFT JOIN units ON units.id = inspections.unit_id&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        .where(&quot;inspections.inspection_location LIKE ? OR inspections.id LIKE ? OR inspections.unique_report_number LIKE ? OR units.serial LIKE ? OR units.manufacturer LIKE ? OR units.name LIKE ?&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">          &quot;%#{query}%&quot;, &quot;%#{query}%&quot;, &quot;%#{query}%&quot;, &quot;%#{query}%&quot;, &quot;%#{query}%&quot;, &quot;%#{query}%&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
                <span class="hits" title="else branch hit 64 times">
                  else: 64
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="64" data-linenumber="82">
            
              <span class="hits">64</span>
            

            
              
            

            <code class="ruby">      all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :filter_by_result, -&gt;(result) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="86">
            
              <span class="hits">65</span>
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
                <span class="hits" title="else branch hit 53 times">
                  else: 53
                </span>
              
            

            <code class="ruby">    case result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="87">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when &quot;passed&quot; then where(passed: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="88">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    when &quot;failed&quot; then where(passed: false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="82" data-linenumber="91">
            
              <span class="hits">82</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 62 times">
                  else: 62
                </span>
              
            

            <code class="ruby">  scope :filter_by_unit, -&gt;(unit_id) { where(unit_id: unit_id) if unit_id.present? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="92">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">  scope :filter_by_date_range, -&gt;(start_date, end_date) { where(inspection_date: start_date..end_date) if start_date.present? &amp;&amp; end_date.present? }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="93">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">  scope :overdue, -&gt; { where(&quot;inspection_date &lt; ?&quot;, Date.today - 1.year) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  # Delegate methods to unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="96">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  delegate :name, :serial, :manufacturer, to: :unit, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  # Calculated fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="99">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def reinspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="191" data-linenumber="100">
            
              <span class="hits">191</span>
            

            
              
                <span class="hits" title="else branch hit 189 times">
                  else: 189
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return nil unless inspection_date.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="189" data-linenumber="101">
            
              <span class="hits">189</span>
            

            
              
            

            <code class="ruby">    inspection_date + 1.year</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  # Check if inspection is complete (not draft)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="105">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5369" data-linenumber="106">
            
              <span class="hits">5369</span>
            

            
              
            

            <code class="ruby">    complete_date.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">  # URL routing based on completion status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="110">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def primary_url_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="111">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="112">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;inspection_path(self)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;edit_inspection_path(self)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="118">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def preferred_path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="119">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    if complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="120">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      Rails.application.routes.url_helpers.inspection_path(self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Rails.application.routes.url_helpers.edit_inspection_path(self)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">  # Advanced methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="127">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def can_be_completed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="174" data-linenumber="128">
            
              <span class="hits">174</span>
            

            
              
            

            <code class="ruby">    unit.present? &amp;&amp; all_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="131">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="133">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      complete: complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      all_assessments_complete: all_assessments_complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      missing_assessments: get_missing_assessments,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      can_be_completed: can_be_completed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="140">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def get_missing_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="141">
            
              <span class="hits">171</span>
            

            
              
            

            <code class="ruby">    missing = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="142">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="else branch hit 165 times">
                  else: 165
                </span>
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Unit&quot; unless unit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="143">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="then branch hit 141 times">
                  then: 141
                </span>
              
                <span class="hits" title="else branch hit 30 times">
                  else: 30
                </span>
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
                <span class="hits" title="then branch hit 157 times">
                  then: 157
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;User Height&quot; unless user_height_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="171" data-linenumber="144">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="then branch hit 131 times">
                  then: 131
                </span>
              
                <span class="hits" title="else branch hit 40 times">
                  else: 40
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 171 times">
                  then: 171
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Structure&quot; unless structure_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="145">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="then branch hit 132 times">
                  then: 132
                </span>
              
                <span class="hits" title="else branch hit 39 times">
                  else: 39
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
                <span class="hits" title="then branch hit 165 times">
                  then: 165
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Anchorage&quot; unless anchorage_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="171" data-linenumber="146">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="then branch hit 130 times">
                  then: 130
                </span>
              
                <span class="hits" title="else branch hit 41 times">
                  else: 41
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 171 times">
                  then: 171
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Materials&quot; unless materials_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="171" data-linenumber="147">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="then branch hit 130 times">
                  then: 130
                </span>
              
                <span class="hits" title="else branch hit 41 times">
                  else: 41
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 171 times">
                  then: 171
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Fan&quot; unless fan_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="148">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 154 times">
                  else: 154
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Slide&quot; if has_slide? &amp;&amp; !slide_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="149">
            
              <span class="hits">171</span>
            

            
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
                <span class="hits" title="else branch hit 158 times">
                  else: 158
                </span>
              
            

            <code class="ruby">    missing &lt;&lt; &quot;Enclosed&quot; if is_totally_enclosed? &amp;&amp; !enclosed_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="171" data-linenumber="150">
            
              <span class="hits">171</span>
            

            
              
            

            <code class="ruby">    missing</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="153">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete!(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="154">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    update!(complete_date: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="155">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    log_audit_action(&quot;completed&quot;, user, &quot;Inspection completed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="158">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def duplicate_for_user(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="159">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_inspection = dup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="160">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_inspection.user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="161">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_inspection.complete_date = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="162">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_inspection.unique_report_number = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="163">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_inspection.passed = nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="164">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_inspection.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">    # Duplicate all assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="167">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    duplicate_assessments(new_inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="169">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="172">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def validate_completeness</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="173">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    errors = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">    # Check each assessment section if they exist</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="176">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;User Height Assessment incomplete&quot; if user_height_assessment.present? &amp;&amp; !user_height_assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="177">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;Slide Assessment incomplete&quot; if slide_assessment.present? &amp;&amp; !slide_assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="178">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;Structure Assessment incomplete&quot; if structure_assessment.present? &amp;&amp; !structure_assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="179">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;Anchorage Assessment incomplete&quot; if anchorage_assessment.present? &amp;&amp; !anchorage_assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="180">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;Materials Assessment incomplete&quot; if materials_assessment.present? &amp;&amp; !materials_assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="181">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;Fan Assessment incomplete&quot; if fan_assessment.present? &amp;&amp; !fan_assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="182">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    errors &lt;&lt; &quot;Totally Enclosed Assessment incomplete&quot; if enclosed_assessment.present? &amp;&amp; !enclosed_assessment.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="184">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="187">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def pass_fail_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="188">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return {total_checks: 0, passed_checks: 0, failed_checks: 0, pass_percentage: 0} if total_safety_checks == 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="191">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      total_checks: total_safety_checks,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">      passed_checks: passed_safety_checks,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">      failed_checks: failed_safety_checks,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="194">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      pass_percentage: (passed_safety_checks.to_f / total_safety_checks * 100).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="198">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_audit_action(action, user, details)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">    # Simple logging for now - could be enhanced with audit log table later</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="68" data-linenumber="200">
            
              <span class="hits">68</span>
            

            
              
                <span class="hits" title="then branch hit 67 times">
                  then: 67
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    Rails.logger.info(&quot;Inspection #{id}: #{action} by #{user&amp;.email} - #{details}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="203">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="205">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def generate_unique_report_number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="197" data-linenumber="206">
            
              <span class="hits">197</span>
            

            
              
                <span class="hits" title="then branch hit 196 times">
                  then: 196
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return if unique_report_number.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="207">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    self.unique_report_number = &quot;RPII-#{Date.current.strftime(&quot;%Y%m%d&quot;)}-#{SecureRandom.hex(4).upcase}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="210">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def copy_unit_values</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1889" data-linenumber="211">
            
              <span class="hits">1889</span>
            

            
              
                <span class="hits" title="else branch hit 1866 times">
                  else: 1866
                </span>
              
                <span class="hits" title="then branch hit 23 times">
                  then: 23
                </span>
              
            

            <code class="ruby">    return unless unit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">    # Copy all dimensions and boolean flags from unit using the concern method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1866" data-linenumber="214">
            
              <span class="hits">1866</span>
            

            
              
            

            <code class="ruby">    copy_attributes_from(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="217">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_inspector_company_from_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="960" data-linenumber="218">
            
              <span class="hits">960</span>
            

            
              
            

            <code class="ruby">    self.inspector_company_id ||= user.inspection_company_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="221">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def all_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1270" data-linenumber="222">
            
              <span class="hits">1270</span>
            

            
              
                <span class="hits" title="else branch hit 166 times">
                  else: 166
                </span>
              
                <span class="hits" title="then branch hit 1104 times">
                  then: 1104
                </span>
              
            

            <code class="ruby">    return false unless has_assessments?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">    required_assessments = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="225">
            
              <span class="hits">166</span>
            

            
              
                <span class="hits" title="then branch hit 165 times">
                  then: 165
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      user_height_assessment&amp;.complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
                <span class="hits" title="then branch hit 145 times">
                  then: 145
                </span>
              
                <span class="hits" title="else branch hit 21 times">
                  else: 21
                </span>
              
            

            <code class="ruby">      structure_assessment&amp;.complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
                <span class="hits" title="then branch hit 145 times">
                  then: 145
                </span>
              
                <span class="hits" title="else branch hit 21 times">
                  else: 21
                </span>
              
            

            <code class="ruby">      anchorage_assessment&amp;.complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
                <span class="hits" title="then branch hit 141 times">
                  then: 141
                </span>
              
                <span class="hits" title="else branch hit 25 times">
                  else: 25
                </span>
              
            

            <code class="ruby">      materials_assessment&amp;.complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
                <span class="hits" title="then branch hit 141 times">
                  then: 141
                </span>
              
                <span class="hits" title="else branch hit 25 times">
                  else: 25
                </span>
              
            

            <code class="ruby">      fan_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">    # Add slide assessment if inspection has a slide</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="233">
            
              <span class="hits">166</span>
            

            
              
                <span class="hits" title="then branch hit 18 times">
                  then: 18
                </span>
              
                <span class="hits" title="else branch hit 148 times">
                  else: 148
                </span>
              
            

            <code class="ruby">    if has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="234">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      required_assessments &lt;&lt; slide_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">    # Add enclosed assessment if required</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="238">
            
              <span class="hits">166</span>
            

            
              
                <span class="hits" title="then branch hit 18 times">
                  then: 18
                </span>
              
                <span class="hits" title="else branch hit 148 times">
                  else: 148
                </span>
              
            

            <code class="ruby">    if is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="239">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      required_assessments &lt;&lt; enclosed_assessment&amp;.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="166" data-linenumber="242">
            
              <span class="hits">166</span>
            

            
              
            

            <code class="ruby">    required_assessments.all?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="245">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_assessments?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1285" data-linenumber="246">
            
              <span class="hits">1285</span>
            

            
              
            

            <code class="ruby">    user_height_assessment.present? || slide_assessment.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">      structure_assessment.present? || anchorage_assessment.present? ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">      materials_assessment.present? || fan_assessment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="251">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def auto_determine_pass_fail</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="252">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    self.passed = all_safety_checks_pass?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="255">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def all_safety_checks_pass?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="256">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return true unless has_assessments?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">    # Business logic to determine overall pass/fail</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">    critical_failures = [</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="260">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      structure_assessment&amp;.respond_to?(:has_critical_failures?) &amp;&amp; structure_assessment.has_critical_failures?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      anchorage_assessment&amp;.respond_to?(:has_critical_failures?) &amp;&amp; anchorage_assessment.has_critical_failures?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      materials_assessment&amp;.respond_to?(:has_critical_failures?) &amp;&amp; materials_assessment.has_critical_failures?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">    ].any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="265">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    !critical_failures &amp;&amp; meet_safety_thresholds?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="268">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meet_safety_thresholds?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="269">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return true unless has_assessments?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="271">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    height_ok = !user_height_assessment&amp;.respond_to?(:meets_height_requirements?) || user_height_assessment&amp;.meets_height_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="272">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    runout_ok = !slide_assessment&amp;.respond_to?(:meets_runout_requirements?) || slide_assessment&amp;.meets_runout_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="273">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    anchor_ok = !anchorage_assessment&amp;.respond_to?(:meets_anchor_requirements?) || anchorage_assessment&amp;.meets_anchor_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="275">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    height_ok &amp;&amp; runout_ok &amp;&amp; anchor_ok</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="278">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def total_safety_checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="279">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return 0 unless has_assessments?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="281">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    assessments = [user_height_assessment, slide_assessment, structure_assessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">      anchorage_assessment, materials_assessment, fan_assessment]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="283">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    assessments &lt;&lt; enclosed_assessment if is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="285">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    assessments.compact.sum { |a| a.respond_to?(:safety_check_count) ? a.safety_check_count : 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="288">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_safety_checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="289">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return 0 unless has_assessments?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="291">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    assessments = [user_height_assessment, slide_assessment, structure_assessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">      anchorage_assessment, materials_assessment, fan_assessment]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="293">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    assessments &lt;&lt; enclosed_assessment if is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="295">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    assessments.compact.sum { |a| a.respond_to?(:passed_checks_count) ? a.passed_checks_count : 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="298">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def failed_safety_checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="299">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    total_safety_checks - passed_safety_checks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="302">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def duplicate_assessments(new_inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="303">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    user_height_assessment&amp;.dup&amp;.tap { |a|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="304">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      a.inspection = new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="305">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      a.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="307">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    slide_assessment&amp;.dup&amp;.tap { |a|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="308">
            

            
              
            

            <code class="ruby">      a.inspection = new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="309">
            

            
              
            

            <code class="ruby">      a.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="311">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    structure_assessment&amp;.dup&amp;.tap { |a|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="312">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      a.inspection = new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="313">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      a.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="315">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    anchorage_assessment&amp;.dup&amp;.tap { |a|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="316">
            

            
              
            

            <code class="ruby">      a.inspection = new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="317">
            

            
              
            

            <code class="ruby">      a.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="319">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    materials_assessment&amp;.dup&amp;.tap { |a|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="320">
            

            
              
            

            <code class="ruby">      a.inspection = new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="321">
            

            
              
            

            <code class="ruby">      a.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="323">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    fan_assessment&amp;.dup&amp;.tap { |a|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="324">
            

            
              
            

            <code class="ruby">      a.inspection = new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="325">
            

            
              
            

            <code class="ruby">      a.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="327">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="328">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      enclosed_assessment&amp;.dup&amp;.tap { |a|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="329">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        a.inspection = new_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="330">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        a.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8776323918f8398e04f3a8486d1187e16ef9497e">
  <div class="header">
    <h3>app/models/inspector_company.rb</h3>
    <h4>
      <span class="green">
  95.45%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  78.57%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>44</b> relevant lines.
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>11</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - Company credentials and branding model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class InspectorCompany &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :inspections, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # File attachments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one_attached :logo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :name, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :rpii_registration_number, presence: true, uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :email, format: {with: URI::MailTo::EMAIL_REGEXP}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :phone, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :address, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="18">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">  scope :active, -&gt; { where(active: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="19">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">  scope :archived, -&gt; { where(active: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :by_status, -&gt;(status) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="21">
            
              <span class="hits">27</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    case status&amp;.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;active&quot; then active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="23">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when &quot;archived&quot; then archived</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="24">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 18 times">
                  else: 18
                </span>
              
            

            <code class="ruby">    when &quot;all&quot; then all</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="25">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    else all # Default to all companies when no parameter provided</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="28">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :search_by_term, -&gt;(term) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="29">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 21 times">
                  then: 21
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return all if term.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    where(&quot;name LIKE ? OR rpii_registration_number LIKE ?&quot;, &quot;%#{term}%&quot;, &quot;%#{term}%&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="34">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_save :normalize_phone_number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :update_inspection_company_data, if: :saved_change_to_name?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  # Methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_valid_credentials?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="39">
            
              <span class="hits">78</span>
            

            
              
            

            <code class="ruby">    rpii_registration_number.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def full_address</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="43">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    [address, city, state, postal_code].compact.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="46">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def recent_inspections(limit = 10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    # Will be enhanced when Unit relationship is added</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="52">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    inspections.order(inspection_date: :desc).limit(limit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="55">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def pass_rate</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="12" data-linenumber="56">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return 0 if inspections.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">    passed_count = inspections.passed.count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">    (passed_count.to_f / inspections.count * 100).round(2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def company_statistics</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="63">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      total_inspections: inspections.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      passed_inspections: inspections.passed.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      failed_inspections: inspections.failed.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      pass_rate: pass_rate,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      active_since: created_at.year</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="71">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def logo_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    logo.attached? ? logo : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="75">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="77">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def normalize_phone_number</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1818" data-linenumber="78">
            
              <span class="hits">1818</span>
            

            
              
                <span class="hits" title="else branch hit 1818 times">
                  else: 1818
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless phone.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    # Remove all non-digit characters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1818" data-linenumber="81">
            
              <span class="hits">1818</span>
            

            
              
            

            <code class="ruby">    self.phone = phone.gsub(/\D/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="84">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_inspection_company_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">    # Update any draft inspections with new company name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    # Will be enhanced when draft scope and audit logging are added to Inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="87">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    inspections.each do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      # inspection.update(inspection_company_name: name) - will be added in later step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      # inspection.log_audit_action(&#39;company_updated&#39;, user, &#39;Company name updated&#39;) - will be added in later step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="da7ce9d80bd90065a1239b2385d0277c42e603ba">
  <div class="header">
    <h3>app/models/materials_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>48</b> relevant lines.
      <span class="green"><b>48</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - Materials Assessment model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class MaterialsAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Material specifications</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :rope_size, numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  # Pass/fail assessments for all materials</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  MATERIAL_CHECKS = %w[rope_size_pass clamber_pass retention_netting_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    zips_pass windows_pass artwork_pass thread_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    fabric_pass fire_retardant_pass].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  # Critical material checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  CRITICAL_MATERIAL_CHECKS = %w[fabric_pass fire_retardant_pass thread_pass].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  MATERIAL_CHECKS.each do |check|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="153" data-linenumber="17">
            
              <span class="hits">153</span>
            

            
              
            

            <code class="ruby">    validates check.to_sym, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="23">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="408" data-linenumber="24">
            
              <span class="hits">408</span>
            

            
              
            

            <code class="ruby">    material_assessments_complete? &amp;&amp; rope_specifications_present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_critical_failures?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    # Fire retardant, fabric strength, and thread are critical for safety</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="56" data-linenumber="29">
            
              <span class="hits">56</span>
            

            
              
            

            <code class="ruby">    CRITICAL_MATERIAL_CHECKS.any? { |check| send(check) == false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="32">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_check_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="33">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    MATERIAL_CHECKS.length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_checks_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="130" data-linenumber="37">
            
              <span class="hits">130</span>
            

            
              
            

            <code class="ruby">    MATERIAL_CHECKS.count { |check| send(check) == true }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="40">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="41">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    total_fields = MATERIAL_CHECKS.length + 1 # Include rope_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="42">
            
              <span class="hits">70</span>
            

            
              
            

            <code class="ruby">    completed_fields = (MATERIAL_CHECKS.map { |check| send(check) } + [rope_size]).count(&amp;:present?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="44">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    (completed_fields.to_f / total_fields * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def material_compliance_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="49">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      critical_passed: CRITICAL_MATERIAL_CHECKS.count { |check| send(check) == true },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      critical_total: CRITICAL_MATERIAL_CHECKS.length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      overall_passed: passed_checks_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      overall_total: safety_check_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      rope_compliant: rope_size_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def critical_material_status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="58">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    failed_critical = CRITICAL_MATERIAL_CHECKS.select { |check| send(check) == false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="60">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if failed_critical.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;All critical materials compliant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="63">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;Critical failures: #{failed_critical.map(&amp;:humanize).join(&quot;, &quot;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="67">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def material_test_requirements</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="68">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    requirements = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="70">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    requirements &lt;&lt; &quot;Fabric tensile strength: 1850N minimum&quot; if fabric_pass != true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="71">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    requirements &lt;&lt; &quot;Fabric tear strength: 350N minimum&quot; if fabric_pass != true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="72">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    requirements &lt;&lt; &quot;Fire retardancy: EN 71-3 compliance&quot; if fire_retardant_pass != true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="73">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    requirements &lt;&lt; &quot;Thread tensile strength: 88N minimum&quot; if thread_pass != true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="74">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    requirements &lt;&lt; &quot;Rope diameter: 18-45mm range&quot; unless rope_size_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="76">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="79">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def non_critical_issues</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="80">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    non_critical_checks = MATERIAL_CHECKS - CRITICAL_MATERIAL_CHECKS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="81">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">    failed_checks = non_critical_checks.select { |check| send(check) == false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="83">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    failed_checks.map(&amp;:humanize)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="86">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="88">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def material_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="997" data-linenumber="89">
            
              <span class="hits">997</span>
            

            
              
            

            <code class="ruby">    MATERIAL_CHECKS.all? { |check| !send(check).nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="92">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def rope_specifications_present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="93">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">    rope_size.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="96">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def rope_size_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="97">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.valid_rope_diameter?(rope_size)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="100">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_assessment_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    inspection.log_audit_action(&quot;assessment_updated&quot;, inspection.user, &quot;Materials Assessment updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9e9cda40ae503f6906b8f584507be92c7bf50b9f">
  <div class="header">
    <h3>app/models/safety_standard.rb</h3>
    <h4>
      <span class="green">
  95.18%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  79.25%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>166</b> relevant lines.
      <span class="green"><b>158</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>53</b> total branches, </span>
          <span class="green"><b>42</b> branches covered</span> and
          <span class="red"><b>11</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - Business rules and calculations model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="2">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">class SafetyStandard</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="3">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  include ActiveModel::Model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Height category constants based on EN 14960:2019</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  HEIGHT_CATEGORIES = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="7">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    1000 =&gt; {label: &quot;1.0m (Young children)&quot;, max_users: :calculate_by_area},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    1200 =&gt; {label: &quot;1.2m (Children)&quot;, max_users: :calculate_by_area},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    1500 =&gt; {label: &quot;1.5m (Adolescents)&quot;, max_users: :calculate_by_area},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    1800 =&gt; {label: &quot;1.8m (Adults)&quot;, max_users: :calculate_by_area}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  # Slide safety thresholds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="14">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  SLIDE_HEIGHT_THRESHOLDS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    no_walls_required: 0.6,      # Under 600mm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    basic_walls: 3.0,            # 600mm - 3000mm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    enhanced_walls: 6.0,         # 3000mm - 6000mm</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    max_safe_height: 8.0         # Maximum recommended height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  # Anchor calculation constants (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="22">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  ANCHOR_CALCULATION_CONSTANTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    area_coefficient: 114.0,     # Area coefficient in anchor formula</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    base_divisor: 1600.0,        # Base divisor for anchor calculation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    safety_factor: 1.5           # Safety factor multiplier</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  # User space requirements by age group (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="29">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  USER_SPACE_REQUIREMENTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    young_children_1000mm: 1.5,  # 1.5m² per young child (1.0m height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    children_1200mm: 2.0,        # 2.0m² per child (1.2m height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    adolescents_1500mm: 2.5,     # 2.5m² per adolescent (1.5m height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    adults_1800mm: 3.0           # 3.0m² per adult (1.8m height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  # Slide runout calculation constants (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="37">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  RUNOUT_CALCULATION_CONSTANTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    platform_height_ratio: 0.5, # 50% of platform height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    minimum_runout_meters: 0.3   # Absolute minimum 300mm (0.3m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  # Wall height calculation constants (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="43">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  WALL_HEIGHT_CONSTANTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    enhanced_height_multiplier: 1.25  # 1.25× multiplier for enhanced walls</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  # Material safety standards (EN 14960:2019 &amp; EN 71-3)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  MATERIAL_STANDARDS = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="49">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    fabric: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      min_tensile_strength: 1850,    # Newtons minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      min_tear_strength: 350,        # Newtons minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      fire_standard: &quot;EN 71-3&quot;       # Fire retardancy standard</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    thread: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      min_tensile_strength: 88,      # Newtons minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      stitch_length_min: 3,          # mm minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      stitch_length_max: 8           # mm maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    rope: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      min_diameter: 18,              # mm minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      max_diameter: 45,              # mm maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      max_swing_percentage: 20       # % maximum swing</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">    },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    netting: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      max_vertical_mesh: 30,         # mm maximum for &gt;1m height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      max_roof_mesh: 8               # mm maximum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  # Equipment safety limits (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="71">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  EQUIPMENT_SAFETY_LIMITS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">    max_fall_height: 0.6,            # meters (600mm)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    min_pressure: 1.0,               # KPA operational pressure</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    max_evacuation_time: 30,         # seconds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    min_blower_distance: 1.2,        # meters from equipment edge</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">    multi_exit_threshold: 15,        # users requiring multiple exits</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    max_inclination_degrees: 10      # degrees maximum for runouts</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  # Grounding test weights by user height (EN 14960:2019)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="81">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  GROUNDING_TEST_WEIGHTS = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    height_1000mm: 25,               # kg test weight for 1.0m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    height_1200mm: 35,               # kg test weight for 1.2m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">    height_1500mm: 65,               # kg test weight for 1.5m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">    height_1800mm: 85                # kg test weight for 1.8m users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">  }.freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  # Reinspection interval</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="89">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  REINSPECTION_INTERVAL_DAYS = 365  # days</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="91">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="92">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def height_categories</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      HEIGHT_CATEGORIES</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="96">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def calculation_metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="337" data-linenumber="98">
            
              <span class="hits">337</span>
            

            
              
            

            <code class="ruby">        anchors: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">          title: &quot;Anchor Requirements&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">          description: &quot;Anchors must be calculated based on the play area to ensure adequate ground restraint for wind loads.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">          method_name: :calculate_required_anchors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">          example_input: 25.0,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">          input_unit: &quot;m²&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">          output_unit: &quot;anchors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">          formula_text: &quot;((Area² × #{ANCHOR_CALCULATION_CONSTANTS[:area_coefficient]}) ÷ #{ANCHOR_CALCULATION_CONSTANTS[:base_divisor]}) × #{ANCHOR_CALCULATION_CONSTANTS[:safety_factor]} safety factor&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">        user_capacity: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">          title: &quot;User Capacity Calculations&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">          description: &quot;Based on age-appropriate space allocation per user by height category.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">          method_name: :calculate_user_capacity,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">          example_input: [5.0, 4.0, 2.0],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">          input_unit: [&quot;length (m)&quot;, &quot;width (m)&quot;, &quot;negative adjustment (m²)&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">          output_unit: &quot;users per category&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">          formula_text: &quot;Usable area ÷ space requirement per age group&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">        slide_runout: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">          title: &quot;Slide Runout Requirements&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">          description: &quot;Minimum runout distance for safe slide deceleration.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">          method_name: :calculate_required_runout,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">          example_input: 2.5,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">          input_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">          output_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="337" data-linenumber="125">
            
              <span class="hits">337</span>
            

            
              
            

            <code class="ruby">          formula_text: &quot;#{(RUNOUT_CALCULATION_CONSTANTS[:platform_height_ratio] * 100).to_i}% of platform height, minimum #{(RUNOUT_CALCULATION_CONSTANTS[:minimum_runout_meters] * 1000).to_i}mm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">        wall_height: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">          title: &quot;Wall Height Requirements&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">          description: &quot;Containing wall heights must scale with user height.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">          method_name: :meets_height_requirements?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">          example_input: 1.2,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">          input_unit: &quot;m&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">          output_unit: &quot;requirement text&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">          formula_text: &quot;Tiered requirements based on user height thresholds&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">          standard_reference: &quot;EN 14960:2019&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="141">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def get_method_source(method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="142">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      method_obj = method(method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="143">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      source_location = method_obj.source_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="142" data-linenumber="145">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="else branch hit 142 times">
                  else: 142
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return &quot;Source code not available&quot; unless source_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="147">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      file_path, line_number = source_location</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="142" data-linenumber="148">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="else branch hit 142 times">
                  else: 142
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return &quot;Source file not found&quot; unless File.exist?(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="150">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      lines = File.readlines(file_path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="151">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      method_lines = extract_method_lines(lines, line_number - 1, method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">      # Add related constants for complete transparency</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="154">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      related_constants = get_related_constants(method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="156">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="then branch hit 142 times">
                  then: 142
                </span>
              
            

            <code class="ruby">      if related_constants.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="157">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">        constants_section = &quot;\n# Related Constants:\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="158">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">        related_constants.each do |constant_name|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="159">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">          constants_section += extract_constant_definition(lines, constant_name)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="161">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">        constants_section + &quot;\n# Method Implementation:\n&quot; + method_lines.join(&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="162">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            

            
              
            

            <code class="ruby">        method_lines.join(&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            

            
              
            

            <code class="ruby">      &quot;Error retrieving source: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="169">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def get_related_constants(method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="170">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      case method_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
                <span class="hits" title="when branch hit 36 times">
                  when: 36
                </span>
              
            

            <code class="ruby">      when :calculate_required_anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="172">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">        [&quot;ANCHOR_CALCULATION_CONSTANTS&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
                <span class="hits" title="when branch hit 35 times">
                  when: 35
                </span>
              
            

            <code class="ruby">      when :calculate_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="174">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        [&quot;USER_SPACE_REQUIREMENTS&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
                <span class="hits" title="when branch hit 35 times">
                  when: 35
                </span>
              
            

            <code class="ruby">      when :calculate_required_runout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="176">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        [&quot;RUNOUT_CALCULATION_CONSTANTS&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
                <span class="hits" title="when branch hit 36 times">
                  when: 36
                </span>
              
            

            <code class="ruby">      when :meets_height_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="178">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">        [&quot;SLIDE_HEIGHT_THRESHOLDS&quot;, &quot;WALL_HEIGHT_CONSTANTS&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="179">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="180">
            

            
              
            

            <code class="ruby">        []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="184">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def extract_constant_definition(lines, constant_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="185">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">      constant_lines = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="186">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">      in_constant = false</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="187">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">      brace_count = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="189">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">      lines.each_with_index do |line, index|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5830" data-linenumber="190">
            
              <span class="hits">5830</span>
            

            
              
                <span class="hits" title="then branch hit 178 times">
                  then: 178
                </span>
              
                <span class="hits" title="else branch hit 5652 times">
                  else: 5652
                </span>
              
            

            <code class="ruby">        if line.strip.start_with?(&quot;#{constant_name} =&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="191">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">          in_constant = true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="192">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">          constant_lines &lt;&lt; &quot;#{index + 1}: #{line}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="193">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">          brace_count += line.count(&quot;{&quot;) - line.count(&quot;}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="194">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">          next</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5652" data-linenumber="197">
            
              <span class="hits">5652</span>
            

            
              
                <span class="hits" title="then branch hit 676 times">
                  then: 676
                </span>
              
                <span class="hits" title="else branch hit 4976 times">
                  else: 4976
                </span>
              
            

            <code class="ruby">        if in_constant</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="676" data-linenumber="198">
            
              <span class="hits">676</span>
            

            
              
            

            <code class="ruby">          constant_lines &lt;&lt; &quot;#{index + 1}: #{line}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="676" data-linenumber="199">
            
              <span class="hits">676</span>
            

            
              
            

            <code class="ruby">          brace_count += line.count(&quot;{&quot;) - line.count(&quot;}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">          # Check if we&#39;ve closed all braces and reached the end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="676" data-linenumber="202">
            
              <span class="hits">676</span>
            

            
              
                <span class="hits" title="then branch hit 178 times">
                  then: 178
                </span>
              
                <span class="hits" title="else branch hit 498 times">
                  else: 498
                </span>
              
            

            <code class="ruby">          if brace_count &lt;= 0 &amp;&amp; (line.strip.end_with?(&quot;.freeze&quot;) || line.strip == &quot;}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="203">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">            break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="208">
            
              <span class="hits">178</span>
            

            
              
            

            <code class="ruby">      constant_lines.join(&quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="211">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def generate_example(calculation_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="140" data-linenumber="212">
            
              <span class="hits">140</span>
            

            
              
            

            <code class="ruby">      metadata = calculation_metadata[calculation_type]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="140" data-linenumber="213">
            
              <span class="hits">140</span>
            

            
              
                <span class="hits" title="else branch hit 140 times">
                  else: 140
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return &quot;No metadata available&quot; unless metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="140" data-linenumber="215">
            
              <span class="hits">140</span>
            

            
              
            

            <code class="ruby">      case calculation_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
                <span class="hits" title="when branch hit 35 times">
                  when: 35
                </span>
              
            

            <code class="ruby">      when :anchors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="217">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        area = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="218">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        result = calculate_required_anchors(area)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="219">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        &quot;For #{area}#{metadata[:input_unit]} area: #{result} #{metadata[:output_unit]} required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
                <span class="hits" title="when branch hit 35 times">
                  when: 35
                </span>
              
            

            <code class="ruby">      when :user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="221">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        length, width, negative_adj = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="222">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        result = calculate_user_capacity(length, width, negative_adj)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="223">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        usable_area = (length * width) - negative_adj</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="224">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        &quot;For #{length}m × #{width}m (#{usable_area}m² usable): #{result[:users_1200mm]} children (1.2m category)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
                <span class="hits" title="when branch hit 35 times">
                  when: 35
                </span>
              
            

            <code class="ruby">      when :slide_runout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="226">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        platform_height = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="227">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        result = calculate_required_runout(platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="228">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        &quot;For #{platform_height}#{metadata[:input_unit]} platform: #{result}#{metadata[:output_unit]} runout required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
                <span class="hits" title="when branch hit 35 times">
                  when: 35
                </span>
              
            

            <code class="ruby">      when :wall_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="230">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        user_height = metadata[:example_input]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="35" data-linenumber="231">
            
              <span class="hits">35</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        case user_height</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="232">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when 0..SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="233">
            

            
              
            

            <code class="ruby">          requirement = &quot;No containing walls required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
                <span class="hits" title="when branch hit 35 times">
                  when: 35
                </span>
              
            

            <code class="ruby">        when SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]..SLIDE_HEIGHT_THRESHOLDS[:basic_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="235">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">          requirement = &quot;Walls must be at least #{user_height}m (equal to user height)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="236">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when SLIDE_HEIGHT_THRESHOLDS[:basic_walls]..SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="237">
            

            
              
            

            <code class="ruby">          multiplier = WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="238">
            

            
              
            

            <code class="ruby">          requirement = &quot;Walls must be at least #{(user_height * multiplier).round(2)}m (#{multiplier}× user height)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="35" data-linenumber="240">
            
              <span class="hits">35</span>
            

            
              
            

            <code class="ruby">        &quot;For #{user_height}#{metadata[:input_unit]} user height: #{requirement}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="241">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="242">
            

            
              
            

            <code class="ruby">        &quot;Example not available for #{calculation_type}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="246">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def meets_height_requirements?(user_height, containing_wall_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Containing wall heights must scale with user height using WALL_HEIGHT_CONSTANTS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="248">
            
              <span class="hits">53</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 51 times">
                  else: 51
                </span>
              
            

            <code class="ruby">      return false if user_height.nil? || containing_wall_height.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="250">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      enhanced_multiplier = WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="252">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      case user_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when 0..SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="254">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        true # No containing walls required</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
                <span class="hits" title="when branch hit 40 times">
                  when: 40
                </span>
              
            

            <code class="ruby">      when SLIDE_HEIGHT_THRESHOLDS[:no_walls_required]..SLIDE_HEIGHT_THRESHOLDS[:basic_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="256">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">        containing_wall_height &gt;= user_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">      when SLIDE_HEIGHT_THRESHOLDS[:basic_walls]..SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="258">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        containing_wall_height &gt;= (user_height * enhanced_multiplier)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      when SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]..SLIDE_HEIGHT_THRESHOLDS[:max_safe_height]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="260">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        containing_wall_height &gt;= (user_height * enhanced_multiplier) # Plus permanent roof required</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="262">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        false # Exceeds safe height limits</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="266">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def meets_runout_requirements?(runout_length, platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Slide runout length must be minimum 50% of platform height or 300mm, whichever is greater, to ensure safe deceleration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="268">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">      return false if runout_length.nil? || platform_height.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="270">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      required_runout = calculate_required_runout(platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="271">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      runout_length &gt;= required_runout</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="274">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def calculate_required_runout(platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Minimum runout distance calculation using RUNOUT_CALCULATION_CONSTANTS for safe landing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="276">
            
              <span class="hits">61</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 58 times">
                  else: 58
                </span>
              
            

            <code class="ruby">      return 0 if platform_height.nil? || platform_height &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">      # Calculate using constants from RUNOUT_CALCULATION_CONSTANTS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="279">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">      height_ratio = RUNOUT_CALCULATION_CONSTANTS[:platform_height_ratio]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="280">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">      minimum_runout = RUNOUT_CALCULATION_CONSTANTS[:minimum_runout_meters]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="282">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">      [platform_height * height_ratio, minimum_runout].max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="285">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def calculate_required_anchors(area_m2)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Anchor point calculation: ((Area² × area_coefficient) ÷ base_divisor) × safety_factor, ensuring adequate ground restraint for wind loads</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">      # Formula from original Windows app: ((Area² × area_coefficient) ÷ base_divisor) × safety_factor, rounded up</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="170" data-linenumber="288">
            
              <span class="hits">170</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 167 times">
                  else: 167
                </span>
              
            

            <code class="ruby">      return 0 if area_m2.nil? || area_m2 &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">      # Formula using constants from ANCHOR_CALCULATION_CONSTANTS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="291">
            
              <span class="hits">167</span>
            

            
              
            

            <code class="ruby">      area_coeff = ANCHOR_CALCULATION_CONSTANTS[:area_coefficient]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="292">
            
              <span class="hits">167</span>
            

            
              
            

            <code class="ruby">      base_div = ANCHOR_CALCULATION_CONSTANTS[:base_divisor]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="293">
            
              <span class="hits">167</span>
            

            
              
            

            <code class="ruby">      safety_mult = ANCHOR_CALCULATION_CONSTANTS[:safety_factor]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="167" data-linenumber="295">
            
              <span class="hits">167</span>
            

            
              
            

            <code class="ruby">      ((area_m2.to_f**2 * area_coeff) / base_div * safety_mult).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="298">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def calculate_user_capacity(length, width, negative_adjustment = 0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - User capacity based on age-appropriate space allocation using USER_SPACE_REQUIREMENTS constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="300">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 53 times">
                  else: 53
                </span>
              
            

            <code class="ruby">      return {} if length.nil? || width.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="302">
            
              <span class="hits">53</span>
            

            
              
            

            <code class="ruby">      usable_area = (length * width) - (negative_adjustment || 0)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="303">
            
              <span class="hits">53</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 51 times">
                  else: 51
                </span>
              
            

            <code class="ruby">      return {} if usable_area &lt;= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">      # Standard capacity calculation using constants from USER_SPACE_REQUIREMENTS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="307">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">        users_1000mm: (usable_area / USER_SPACE_REQUIREMENTS[:young_children_1000mm]).floor,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="308">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">        users_1200mm: (usable_area / USER_SPACE_REQUIREMENTS[:children_1200mm]).floor,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="309">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">        users_1500mm: (usable_area / USER_SPACE_REQUIREMENTS[:adolescents_1500mm]).floor,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="310">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">        users_1800mm: (usable_area / USER_SPACE_REQUIREMENTS[:adults_1800mm]).floor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="314">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def slide_calculations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Comprehensive slide safety requirements including containing wall heights, runout specifications, and gradient limitations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="317">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        containing_wall_heights: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">          under_600mm: &quot;No containing walls required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">          between_600_3000mm: &quot;Containing walls required of user height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">          between_3000_6000mm: &quot;Containing walls required #{WALL_HEIGHT_CONSTANTS[:enhanced_height_multiplier]} times user height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
            

            <code class="ruby">          over_6000mm: &quot;Both containing walls AND permanent roof required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            
              
            

            <code class="ruby">        runout_requirements: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            
              
            

            <code class="ruby">          minimum_length: &quot;50% of highest platform height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">          absolute_minimum: &quot;300mm in any case&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby">          maximum_inclination: &quot;Not more than 10°&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby">          stop_wall_addition: &quot;If fitted, adds 50cm to required run-out length&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            

            
              
            

            <code class="ruby">          wall_height_requirement: &quot;50% of user height on run-out sides&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="329">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            
              
            

            <code class="ruby">        safety_factors: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            
              
            

            <code class="ruby">          first_metre_gradient: &quot;Special requirements for first metre of slope&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">          surface_requirements: &quot;Non-slip surface material required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby">          edge_protection: &quot;Rounded edges and smooth transitions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="338">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def anchor_formulas</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Anchoring system calculations and requirements for secure ground attachment with specified pull strength minimums</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="341">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        calculation: &quot;((Area² × 114) ÷ 1600) × 1.5&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="342">
            

            
              
            

            <code class="ruby">        description: &quot;Number of anchor points per side, rounded up&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            
              
            

            <code class="ruby">        example: &quot;For 25m² area: ((25² × 114) ÷ 1600) × 1.5 = 6.6 → 7 anchors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            
              
            

            <code class="ruby">        requirements: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            

            
              
            

            <code class="ruby">          low_anchors: &quot;Ground-level anchoring points&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            

            
              
            

            <code class="ruby">          high_anchors: &quot;Elevated anchoring points for tall structures&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            

            
              
            

            <code class="ruby">          angle_requirements: &quot;30° to 45° angle to ground&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="348">
            

            
              
            

            <code class="ruby">          strength_requirements: &quot;1600 Newton pull strength minimum&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="352">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="353">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def material_requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 &amp; EN 71-3 - Material specifications using MATERIAL_STANDARDS constants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="355">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      fabric_standards = MATERIAL_STANDARDS[:fabric]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="356">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      thread_standards = MATERIAL_STANDARDS[:thread]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="357">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      rope_standards = MATERIAL_STANDARDS[:rope]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="358">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      netting_standards = MATERIAL_STANDARDS[:netting]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="359">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="361">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        fabric: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="362">
            

            
              
            

            <code class="ruby">          tensile_strength: &quot;#{fabric_standards[:min_tensile_strength]} Newtons minimum&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="363">
            

            
              
            

            <code class="ruby">          tear_strength: &quot;#{fabric_standards[:min_tear_strength]} Newtons minimum&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="364">
            

            
              
            

            <code class="ruby">          fire_retardancy: &quot;Must meet #{fabric_standards[:fire_standard]} requirements&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            

            
              
            

            <code class="ruby">        thread: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            
              
            

            <code class="ruby">          material: &quot;Non-rotting yarn required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            

            
              
            

            <code class="ruby">          tensile_strength: &quot;#{thread_standards[:min_tensile_strength]} Newtons minimum&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            

            
              
            

            <code class="ruby">          stitch_type: &quot;Lock stitching required&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="370">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            
              
            

            <code class="ruby">        rope: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            
              
            

            <code class="ruby">          diameter_range: &quot;#{rope_standards[:min_diameter]}mm - #{rope_standards[:max_diameter]}mm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            
              
            

            <code class="ruby">          material: &quot;Non-monofilament&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="374">
            

            
              
            

            <code class="ruby">          attachment: &quot;Fixed at both ends&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            

            
              
            

            <code class="ruby">          swing_limitation: &quot;No greater than #{rope_standards[:max_swing_percentage]}% swing to prevent strangulation&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            

            
              
            

            <code class="ruby">        netting: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="378">
            

            
              
            

            <code class="ruby">          vertical_mesh_size: &quot;#{netting_standards[:max_vertical_mesh]}mm maximum for &gt;1m height&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            

            
              
            

            <code class="ruby">          roof_mesh_size: &quot;#{netting_standards[:max_roof_mesh]}mm maximum&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby">          strength: &quot;Support heaviest intended user&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="381">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="382">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="383">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="384">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="385">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def electrical_requirements</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="386">
            

            
              
            

            <code class="ruby">      # PAT testing standards and EN 14960:2019 - Electrical safety requirements using EQUIPMENT_SAFETY_LIMITS and GROUNDING_TEST_WEIGHTS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="387">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      safety_limits = EQUIPMENT_SAFETY_LIMITS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="388">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      test_weights = GROUNDING_TEST_WEIGHTS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="389">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      netting_mesh = MATERIAL_STANDARDS[:netting][:max_roof_mesh]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="391">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="392">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        pat_testing: &quot;Portable Appliance Test required&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby">        blower_requirements: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            

            
              
            

            <code class="ruby">          minimum_pressure: &quot;#{safety_limits[:min_pressure]} KPA operational pressure&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            

            
              
            

            <code class="ruby">          finger_probe: &quot;#{netting_mesh}mm probe must not contact moving/hot parts&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="396">
            

            
              
            

            <code class="ruby">          return_flap: &quot;Required to reduce deflation time&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="397">
            

            
              
            

            <code class="ruby">          distance: &quot;#{safety_limits[:min_blower_distance]}m minimum from equipment edge&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            

            
              
            

            <code class="ruby">        grounding_test: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            
              
            

            <code class="ruby">          &quot;1.0m_height&quot;: &quot;#{test_weights[:height_1000mm]}kg test weight&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="401">
            

            
              
            

            <code class="ruby">          &quot;1.2m_height&quot;: &quot;#{test_weights[:height_1200mm]}kg test weight&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="402">
            

            
              
            

            <code class="ruby">          &quot;1.5m_height&quot;: &quot;#{test_weights[:height_1500mm]}kg test weight&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="403">
            

            
              
            

            <code class="ruby">          &quot;1.8m_height&quot;: &quot;#{test_weights[:height_1800mm]}kg test weight&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="404">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="405">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="406">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="407">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="408">
            

            
              
            

            <code class="ruby">    # Validation methods for business rules</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="409">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def valid_stitch_length?(length_mm)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="410">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Stitch length must be within specified range to ensure adequate seam strength while maintaining fabric integrity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="411">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      min_length = MATERIAL_STANDARDS[:thread][:stitch_length_min]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="412">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      max_length = MATERIAL_STANDARDS[:thread][:stitch_length_max]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="413">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      length_mm.present? &amp;&amp; length_mm.between?(min_length, max_length)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="414">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="415">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="416">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def valid_pressure?(pressure_kpa)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="417">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Minimum operational pressure required to maintain structural integrity and prevent collapse</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="418">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      min_pressure = EQUIPMENT_SAFETY_LIMITS[:min_pressure]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="419">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      pressure_kpa.present? &amp;&amp; pressure_kpa &gt;= min_pressure</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="421">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="422">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def valid_fall_height?(height_m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="423">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Maximum fall height to minimize injury risk from accidental falls outside the structure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="424">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      max_height = EQUIPMENT_SAFETY_LIMITS[:max_fall_height]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="425">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      height_m.present? &amp;&amp; height_m &lt;= max_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="426">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="427">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="428">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def valid_rope_diameter?(diameter_mm)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="429">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Rope diameter range prevents finger entrapment while ensuring adequate grip and structural strength</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="430">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      min_diameter = MATERIAL_STANDARDS[:rope][:min_diameter]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="431">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      max_diameter = MATERIAL_STANDARDS[:rope][:max_diameter]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="432">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      diameter_mm.present? &amp;&amp; diameter_mm.between?(min_diameter, max_diameter)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="433">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="434">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="435">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def requires_permanent_roof?(user_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="436">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Permanent roof mandatory for user heights above enhanced walls threshold to prevent users from being thrown clear</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="437">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      user_height.present? &amp;&amp; user_height &gt; SLIDE_HEIGHT_THRESHOLDS[:enhanced_walls]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="438">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="439">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="440">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def requires_multiple_exits?(user_count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="441">
            

            
              
            

            <code class="ruby">      # EN 14960:2019 - Multiple exits required above threshold to ensure adequate emergency evacuation capacity and prevent overcrowding</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="442">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      threshold = EQUIPMENT_SAFETY_LIMITS[:multi_exit_threshold]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="443">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      user_count.present? &amp;&amp; user_count &gt; threshold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="444">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="445">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="446">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="447">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="448">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    def extract_method_lines(lines, start_line, method_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="449">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      method_lines = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="450">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      current_line = start_line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="451">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      indent_level = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="452">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="453">
            

            
              
            

            <code class="ruby">      # Find the method definition line</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="454">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="body branch hit 142 times">
                  body: 142
                </span>
              
            

            <code class="ruby">      while current_line &lt; lines.length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="455">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">        line = lines[current_line]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="142" data-linenumber="456">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="then branch hit 142 times">
                  then: 142
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if line.strip.start_with?(&quot;def #{method_name}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="457">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">          indent_level = line.index(&quot;def&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="458">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">          method_lines &lt;&lt; &quot;#{current_line + 1}: #{line}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="459">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">          current_line += 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="460">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">          break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="461">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="462">
            

            
              
            

            <code class="ruby">        current_line += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="463">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="464">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="142" data-linenumber="465">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 142 times">
                  else: 142
                </span>
              
            

            <code class="ruby">      return [&quot;Method definition not found&quot;] if indent_level.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="466">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="467">
            

            
              
            

            <code class="ruby">      # Extract method body until we reach the same or lesser indentation with &#39;end&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="468">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="body branch hit 1849 times">
                  body: 1849
                </span>
              
            

            <code class="ruby">      while current_line &lt; lines.length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1849" data-linenumber="469">
            
              <span class="hits">1849</span>
            

            
              
            

            <code class="ruby">        line = lines[current_line]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1849" data-linenumber="470">
            
              <span class="hits">1849</span>
            

            
              
            

            <code class="ruby">        method_lines &lt;&lt; &quot;#{current_line + 1}: #{line}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="471">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="472">
            

            
              
            

            <code class="ruby">        # Check if we&#39;ve reached the end of the method</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1849" data-linenumber="473">
            
              <span class="hits">1849</span>
            

            
              
                <span class="hits" title="then branch hit 142 times">
                  then: 142
                </span>
              
                <span class="hits" title="else branch hit 1707 times">
                  else: 1707
                </span>
              
            

            <code class="ruby">        if line.strip == &quot;end&quot; &amp;&amp; (line.index(/\S/) || 0) &lt;= indent_level</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="474">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">          break</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="475">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="476">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1707" data-linenumber="477">
            
              <span class="hits">1707</span>
            

            
              
            

            <code class="ruby">        current_line += 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="478">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="479">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="480">
            
              <span class="hits">142</span>
            

            
              
            

            <code class="ruby">      method_lines</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="481">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="482">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="483">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a5ad64b76c0f806107a781f63f22de1c553326e3">
  <div class="header">
    <h3>app/models/slide_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>34</b> relevant lines.
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>8</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - Slide Assessment model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class SlideAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Slide measurements</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :slide_platform_height, :slide_wall_height, :runout_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    :slide_first_metre_height, :slide_beyond_first_metre_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # Pass/fail assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :clamber_netting_pass, :runout_pass, :slip_sheet_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="18">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">    slide_measurements_present? &amp;&amp; safety_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meets_runout_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="22">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
            

            <code class="ruby">    return false unless runout_value.present? &amp;&amp; slide_platform_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="24">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.meets_runout_requirements?(runout_value, slide_platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="27">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_check_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="28">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    3 # clamber_netting, runout, slip_sheet</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_checks_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="32">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    [clamber_netting_pass, runout_pass, slip_sheet_pass].count(true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="36">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    total_fields = 10 # Total assessable fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    completed_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="38">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      slide_platform_height, slide_wall_height, runout_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      slide_first_metre_height, slide_beyond_first_metre_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      slide_platform_height_comment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    ].count(&amp;:present?) + [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      clamber_netting_pass, runout_pass, slip_sheet_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      slide_permanent_roof</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="44">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    ].count { |field| !field.nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="46">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    (completed_fields.to_f / total_fields * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def required_runout_length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="50">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return nil unless slide_platform_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="51">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.calculate_required_runout(slide_platform_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="54">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def runout_compliance_status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="55">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    return &quot;Not Assessed&quot; unless runout_value.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if meets_runout_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Compliant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Non-Compliant (Requires #{required_runout_length}m minimum)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="64">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="66">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def slide_measurements_present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="67">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">    slide_platform_height.present? &amp;&amp; runout_value.present? &amp;&amp; slide_wall_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_assessments_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="71">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    [clamber_netting_pass, runout_pass, slip_sheet_pass].none?(&amp;:nil?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="74">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_assessment_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="75">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    inspection.log_audit_action(&quot;assessment_updated&quot;, inspection.user, &quot;Slide Assessment updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ec57a6530a39d730b7d87397dad01f8ba7d5e2ba">
  <div class="header">
    <h3>app/models/structure_assessment.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>51</b> relevant lines.
      <span class="green"><b>51</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - Structure Assessment model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class StructureAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Critical safety checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  CRITICAL_CHECKS = %w[seam_integrity_pass lock_stitch_pass air_loss_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    straight_walls_pass sharp_edges_pass unit_stable_pass].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Additional pass/fail checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ADDITIONAL_CHECKS = %w[stitch_length_pass blower_tube_length_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    step_size_pass fall_off_height_pass unit_pressure_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    trough_pass entrapment_pass markings_pass grounding_pass].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  # Required measurements</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  REQUIRED_MEASUREMENTS = %w[stitch_length unit_pressure_value blower_tube_length].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  # Pass/fail checks for measurements</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  MEASUREMENT_CHECKS = %w[stitch_length_pass unit_pressure_pass blower_tube_length_pass].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  # Pass/fail validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  CRITICAL_CHECKS.each do |check|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="22">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">    validates check.to_sym, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  # Additional pass/fail checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  ADDITIONAL_CHECKS.each do |check|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="153" data-linenumber="27">
            
              <span class="hits">153</span>
            

            
              
            

            <code class="ruby">    validates check.to_sym, inclusion: {in: [true, false]}, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  # Measurements</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :stitch_length, :unit_pressure_value, :blower_tube_length,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    :step_size_value, :fall_off_height_value, :trough_depth_value, :trough_width_value,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="36">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="413" data-linenumber="39">
            
              <span class="hits">413</span>
            

            
              
            

            <code class="ruby">    critical_checks_assessed? &amp;&amp; measurements_present? &amp;&amp; additional_checks_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="42">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_critical_failures?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="86" data-linenumber="43">
            
              <span class="hits">86</span>
            

            
              
            

            <code class="ruby">    CRITICAL_CHECKS.any? { |check| send(check) == false }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="46">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_check_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="47">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    CRITICAL_CHECKS.length + ADDITIONAL_CHECKS.length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="50">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_checks_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="51">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">    critical_passes = CRITICAL_CHECKS.count { |check| send(check) == true }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="70" data-linenumber="52">
            
              <span class="hits">70</span>
            

            
              
            

            <code class="ruby">    additional_passes = ADDITIONAL_CHECKS.count { |check| send(check) == true }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="54">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    critical_passes + additional_passes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="58">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    all_assessable_fields = CRITICAL_CHECKS + REQUIRED_MEASUREMENTS + MEASUREMENT_CHECKS</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="59">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    total_fields = all_assessable_fields.length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="61">
            
              <span class="hits">78</span>
            

            
              
            

            <code class="ruby">    completed_fields = all_assessable_fields.count { |field| send(field).present? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="63">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    (completed_fields.to_f / total_fields * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="66">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def critical_failure_summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="67">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">    failures = CRITICAL_CHECKS.select { |check| send(check) == false }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="68">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return &quot;No critical failures&quot; if failures.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="70">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    &quot;Critical failures: #{failures.map(&amp;:humanize).join(&quot;, &quot;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="73">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def measurement_compliance</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      stitch_length: stitch_length_compliant?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      unit_pressure: unit_pressure_compliant?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      blower_tube_distance: blower_tube_distance_compliant?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      fall_off_height: fall_off_height_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="82">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="84">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def critical_checks_assessed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="957" data-linenumber="85">
            
              <span class="hits">957</span>
            

            
              
            

            <code class="ruby">    CRITICAL_CHECKS.all? { |check| !send(check).nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="88">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def measurements_present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="89">
            
              <span class="hits">78</span>
            

            
              
            

            <code class="ruby">    REQUIRED_MEASUREMENTS.all? { |measurement| send(measurement).present? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="92">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def additional_checks_complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="93">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    key_additional_checks = %w[stitch_length_pass unit_pressure_pass blower_tube_length_pass step_size_pass fall_off_height_pass]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110" data-linenumber="94">
            
              <span class="hits">110</span>
            

            
              
            

            <code class="ruby">    key_additional_checks.none? { |check| send(check).nil? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def stitch_length_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="98">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.valid_stitch_length?(stitch_length)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="101">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def unit_pressure_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="102">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.valid_pressure?(unit_pressure_value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="105">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def blower_tube_distance_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="106">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    blower_tube_length.present? &amp;&amp; blower_tube_length &gt;= 1.2 # 1.2m minimum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="109">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def fall_off_height_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="110">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.valid_fall_height?(fall_off_height_value)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="113">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_assessment_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="114">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    inspection.log_audit_action(&quot;assessment_updated&quot;, inspection.user, &quot;Structure Assessment updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5f4c3cffed132540e0e1364ed5c20dccfcfb2506">
  <div class="header">
    <h3>app/models/unit.rb</h3>
    <h4>
      <span class="green">
  94.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  66.67%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>50</b> relevant lines.
      <span class="green"><b>47</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>18</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>6</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - Unit model for bounce house inspection system</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class Unit &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  self.table_name = &quot;units&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include HasDimensions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="8">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :inspections, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # File attachments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_one_attached :photo</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  # All fields are required for Units</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :name, :serial, :description, :manufacturer, :owner, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :serial, uniqueness: {scope: [:user_id]}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  # Override HasDimensions validations for required basic dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :width, :length, :height, presence: true, numericality: {greater_than: 0, less_than: 200}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  # Scopes - enhanced from original Equipment and new Unit functionality</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="21">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :search, -&gt;(query) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="22">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">    if query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="23">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      where(&quot;serial LIKE ? OR name LIKE ? OR description LIKE ? OR manufacturer LIKE ? OR owner LIKE ?&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        &quot;%#{query}%&quot;, &quot;%#{query}%&quot;, &quot;%#{query}%&quot;, &quot;%#{query}%&quot;, &quot;%#{query}%&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="25">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">      all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="29">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">  scope :with_slide, -&gt; { where(has_slide: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="30">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">  scope :without_slide, -&gt; { where(has_slide: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  scope :with_recent_inspections, -&gt; { joins(:inspections).where(inspections: {inspection_date: SafetyStandard::REINSPECTION_INTERVAL_DAYS.days.ago..}).distinct }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="34">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_create :generate_custom_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="35">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :update_inspection_unit_data, if: :saved_changes_to_dimensions?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  # Additional methods beyond HasDimensions concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="39">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="251" data-linenumber="40">
            
              <span class="hits">251</span>
            

            
              
            

            <code class="ruby">    inspections.order(inspection_date: :desc).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def last_inspection_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="44">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    last_inspection&amp;.passed? ? &quot;Passed&quot; : &quot;Failed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_history</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">    inspections.includes(:user).order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="51">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def requires_enclosed_assessment?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="52">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="55">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def next_inspection_due</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="164" data-linenumber="56">
            
              <span class="hits">164</span>
            

            
              
                <span class="hits" title="else branch hit 79 times">
                  else: 79
                </span>
              
                <span class="hits" title="then branch hit 85 times">
                  then: 85
                </span>
              
            

            <code class="ruby">    return nil unless last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    # Standard inspection interval using safety standard constant</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="79" data-linenumber="58">
            
              <span class="hits">79</span>
            

            
              
            

            <code class="ruby">    last_inspection.inspection_date + SafetyStandard::REINSPECTION_INTERVAL_DAYS.days</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_overdue?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="62">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return false unless next_inspection_due</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="63">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    next_inspection_due &lt; Date.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="66">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def compliance_status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="67">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return &quot;Never Inspected&quot; unless last_inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="69">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if inspection_overdue?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      &quot;Overdue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="71">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    elsif last_inspection.passed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Compliant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="74">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Non-Compliant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="78">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="80">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      total_inspections: inspections.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      passed_inspections: inspections.passed.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      failed_inspections: inspections.failed.count,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="83">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      last_inspection_date: last_inspection&amp;.inspection_date,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      next_due_date: next_inspection_due,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      compliance_status: compliance_status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="89">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def self.overdue</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    # Find units where their most recent inspection is older than the reinspection interval</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    # Using Date.current instead of Date.today for consistency with Rails timezone handling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="92">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    joins(:inspections)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      .group(&quot;units.id&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      .having(&quot;MAX(inspections.inspection_date) &lt;= ?&quot;, Date.current - SafetyStandard::REINSPECTION_INTERVAL_DAYS.days)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="99">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def saved_changes_to_dimensions?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">    # Use the dimension_changed? method from HasDimensions, but for saved changes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="211" data-linenumber="101">
            
              <span class="hits">211</span>
            

            
              
            

            <code class="ruby">    dimension_attributes.keys.any? { |attr| saved_change_to_attribute?(attr) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="104">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def update_inspection_unit_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    # Update any draft inspections with new unit dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="106">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    inspections.each do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="107">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      inspection.log_audit_action(&quot;unit_updated&quot;, user, &quot;Unit dimensions updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8714519f1352fa42b775c0da5c04703be3ecd20d">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4>
      <span class="green">
  97.5%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  90.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>40</b> relevant lines.
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>10</b> total branches, </span>
          <span class="green"><b>9</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="1">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class User &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  include CustomIdGenerator</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_secure_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :inspections, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  has_many :units, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection_company, class_name: &quot;InspectorCompany&quot;, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :email, presence: true, uniqueness: true, format: {with: URI::MailTo::EMAIL_REGEXP}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :password, presence: true, length: {minimum: 6}, if: :password_digest_changed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="11">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :inspection_limit, numericality: {only_integer: true, greater_than_or_equal_to: -1}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :time_display, inclusion: {in: %w[date time]}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="13">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :theme, inclusion: {in: %w[light dark]}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="15">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_create :set_default_inspection_limit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="16">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_create :set_default_time_display</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="17">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  before_save :downcase_email</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="19">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def can_create_inspection?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="20">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    has_inspection_company? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      inspection_company_active? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      within_inspection_limit?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="25">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_company_required_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="80" data-linenumber="26">
            
              <span class="hits">80</span>
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
                <span class="hits" title="then branch hit 74 times">
                  then: 74
                </span>
              
            

            <code class="ruby">    return I18n.t(&quot;users.messages.company_not_activated&quot;) unless has_inspection_company?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="27">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return I18n.t(&quot;users.messages.company_archived&quot;) unless inspection_company_active?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="28">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    I18n.t(&quot;users.messages.inspection_limit_reached&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="31">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3257" data-linenumber="32">
            
              <span class="hits">3257</span>
            

            
              
            

            <code class="ruby">    admin_pattern = ENV[&quot;ADMIN_EMAILS_PATTERN&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3257" data-linenumber="33">
            
              <span class="hits">3257</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 3253 times">
                  else: 3253
                </span>
              
            

            <code class="ruby">    return false if admin_pattern.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3253" data-linenumber="36">
            
              <span class="hits">3253</span>
            

            
              
            

            <code class="ruby">      regex = Regexp.new(admin_pattern)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3253" data-linenumber="37">
            
              <span class="hits">3253</span>
            

            
              
            

            <code class="ruby">      regex.match?(email)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    rescue RegexpError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="39">
            

            
              
            

            <code class="ruby">      false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="43">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def has_inspection_company?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="991" data-linenumber="44">
            
              <span class="hits">991</span>
            

            
              
            

            <code class="ruby">    inspection_company_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def inspection_company_active?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="33" data-linenumber="50">
            
              <span class="hits">33</span>
            

            
              
                <span class="hits" title="then branch hit 33 times">
                  then: 33
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    inspection_company&amp;.active?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="53">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def within_inspection_limit?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="54">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    inspection_limit == -1 || inspections.count &lt; inspection_limit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="57">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def downcase_email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2803" data-linenumber="58">
            
              <span class="hits">2803</span>
            

            
              
            

            <code class="ruby">    self.email = email.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_default_inspection_limit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1692" data-linenumber="62">
            
              <span class="hits">1692</span>
            

            
              
            

            <code class="ruby">    env_limit = ENV[&quot;LIMIT_INSPECTIONS&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1692" data-linenumber="63">
            
              <span class="hits">1692</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1690 times">
                  else: 1690
                </span>
              
            

            <code class="ruby">    self.inspection_limit = env_limit.present? ? env_limit.to_i : -1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="66">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def set_default_time_display</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1694" data-linenumber="67">
            
              <span class="hits">1694</span>
            

            
              
            

            <code class="ruby">    self.time_display ||= &quot;date&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0d029daa2e29990c0bfd180cfa08c002abf4463e">
  <div class="header">
    <h3>app/models/user_height_assessment.rb</h3>
    <h4>
      <span class="green">
  98.28%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  77.78%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>58</b> relevant lines.
      <span class="green"><b>57</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>18</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># RPII Utility - User Height and Capacity Assessment model</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">class UserHeightAssessment &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  belongs_to :inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Height measurements (2 decimal places)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="6">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :containing_wall_height, :platform_height, :tallest_user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # User capacity counts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="10">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :users_at_1000mm, :users_at_1200mm, :users_at_1500mm, :users_at_1800mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0, only_integer: true}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  # Play area dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="14">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  validates :play_area_length, :play_area_width, :negative_adjustment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    numericality: {greater_than_or_equal_to: 0}, allow_blank: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="18">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  after_update :log_assessment_update, if: :saved_changes?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="20">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="452" data-linenumber="21">
            
              <span class="hits">452</span>
            

            
              
            

            <code class="ruby">    required_fields_present? &amp;&amp; height_measurements_valid?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="24">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def meets_height_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="25">
            
              <span class="hits">42</span>
            

            
              
                <span class="hits" title="else branch hit 38 times">
                  else: 38
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    return false unless tallest_user_height.present? &amp;&amp; containing_wall_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="27">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.meets_height_requirements?(tallest_user_height, containing_wall_height)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="30">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def total_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="31">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">    [users_at_1000mm, users_at_1200mm, users_at_1500mm, users_at_1800mm].compact.sum</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="34">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def safety_check_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="35">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    5 # Number of height-related safety checks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def passed_checks_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="39">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    checks = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="40">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    checks &lt;&lt; meets_height_requirements?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="41">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    checks &lt;&lt; permanent_roof_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="42">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    checks &lt;&lt; user_capacity_appropriate?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="43">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    checks &lt;&lt; play_area_adequate?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="44">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    checks &lt;&lt; negative_adjustments_reasonable?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="46">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    checks.count(true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="49">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def completion_percentage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="50">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    total_fields = 12 # Total number of assessable fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    completed_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="52">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      containing_wall_height, platform_height, tallest_user_height,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      users_at_1000mm, users_at_1200mm, users_at_1500mm, users_at_1800mm,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      play_area_length, play_area_width, negative_adjustment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      tallest_user_height_comment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="56">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    ].count(&amp;:present?) + (permanent_roof.nil? ? 0 : 1)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="58">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    (completed_fields.to_f / total_fields * 100).round(0)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="61">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def recommended_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="62">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return {} unless play_area_length.present? &amp;&amp; play_area_width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="64">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    SafetyStandard.calculate_user_capacity(play_area_length, play_area_width, negative_adjustment)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">  # Alias for view compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="68">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  alias_method :calculated_capacities, :recommended_user_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="70">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="72">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def required_fields_present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="452" data-linenumber="73">
            
              <span class="hits">452</span>
            

            
              
            

            <code class="ruby">    containing_wall_height.present? &amp;&amp; platform_height.present? &amp;&amp; tallest_user_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="76">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def height_measurements_valid?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="83" data-linenumber="77">
            
              <span class="hits">83</span>
            

            
              
                <span class="hits" title="else branch hit 83 times">
                  else: 83
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return true unless containing_wall_height.present? &amp;&amp; platform_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="83" data-linenumber="78">
            
              <span class="hits">83</span>
            

            
              
            

            <code class="ruby">    containing_wall_height &gt;= platform_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="81">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def permanent_roof_compliant?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    # Business logic for permanent roof requirements based on height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="83">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return true unless tallest_user_height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="85">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if tallest_user_height &gt; 6.0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            

            
              
            

            <code class="ruby">      permanent_roof == true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="88">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      true # Not required for lower heights</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="92">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def user_capacity_appropriate?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="93">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    total_user_capacity &gt; 0 &amp;&amp; total_user_capacity &lt;= maximum_safe_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="96">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def maximum_safe_capacity</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="97">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return 50 unless play_area_length.present? &amp;&amp; play_area_width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    # Maximum 1 person per 1.5 square meters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="100">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    usable_area = (play_area_length * play_area_width) - (negative_adjustment || 0)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="101">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    (usable_area / 1.5).floor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="104">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def play_area_adequate?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="105">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    play_area_length.present? &amp;&amp; play_area_width.present? &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      play_area_length &gt; 0 &amp;&amp; play_area_width &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="109">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def negative_adjustments_reasonable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="110">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
            

            <code class="ruby">    return true unless negative_adjustment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="111">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return true unless play_area_length.present? &amp;&amp; play_area_width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="113">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    total_area = play_area_length * play_area_width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="114">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    negative_adjustment &lt; (total_area * 0.3) # Should not exceed 30% of total area</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="117">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  def log_assessment_update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="118">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    inspection.log_audit_action(&quot;assessment_updated&quot;, inspection.user, &quot;User Height Assessment updated&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c1210ff40c88ee2e719b4f2542f942a2def6b83d">
  <div class="header">
    <h3>app/services/image_processor_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>7</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="1">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">class ImageProcessorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="2">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">  FULL_SIZE = 1200</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="3">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">  THUMBNAIL_SIZE = 200</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="5">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">  def self.full_size(image)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="6">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return nil unless image&amp;.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="8">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    image.variant(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      format: :jpeg,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      resize_to_limit: [FULL_SIZE, FULL_SIZE],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      saver: {quality: 75}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="15">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">  def self.thumbnail(image)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="16">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return nil unless image&amp;.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="18">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    image.variant(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      format: :jpeg,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      resize_to_limit: [THUMBNAIL_SIZE, THUMBNAIL_SIZE],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      saver: {quality: 75}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3b87c4567efc2b958daeba281681433377238a42">
  <div class="header">
    <h3>app/services/json_serializer_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  73.68%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>51</b> relevant lines.
      <span class="green"><b>51</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>38</b> total branches, </span>
          <span class="green"><b>28</b> branches covered</span> and
          <span class="red"><b>10</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="1">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">class JsonSerializerService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="2">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def self.serialize_unit(unit, include_inspections: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="20" data-linenumber="3">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="else branch hit 20 times">
                  else: 20
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Use reflection to get all columns except excluded ones</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="6">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    unit_fields = Unit.column_names - PublicFieldFiltering::EXCLUDED_FIELDS - PublicFieldFiltering::UNIT_EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="8">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="9">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    unit_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1360" data-linenumber="10">
            
              <span class="hits">1360</span>
            

            
              
            

            <code class="ruby">      value = unit.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1360" data-linenumber="11">
            
              <span class="hits">1360</span>
            

            
              
                <span class="hits" title="else branch hit 1072 times">
                  else: 1072
                </span>
              
                <span class="hits" title="then branch hit 288 times">
                  then: 288
                </span>
              
            

            <code class="ruby">      data[field.to_sym] = value unless value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    # Include inspection history if requested</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="15">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if include_inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="16">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      completed_inspections = unit.inspections.complete.order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="18">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">      if completed_inspections.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="19">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        data[:inspection_history] = completed_inspections.map do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="21">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">            inspection_date: inspection.inspection_date,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">            passed: inspection.passed,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">            complete: inspection.complete?,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="24">
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">            inspector_company: inspection.inspector_company&amp;.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">            unique_report_number: inspection.unique_report_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">            inspection_location: inspection.inspection_location</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="30">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        data[:total_inspections] = completed_inspections.count</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="31">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        data[:last_inspection_date] = completed_inspections.first&amp;.inspection_date</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="32">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        data[:last_inspection_passed] = completed_inspections.first&amp;.passed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    # Add public URLs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="37">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    base_url = ENV[&quot;BASE_URL&quot;] || Rails.application.routes.default_url_options[:host] || &quot;localhost:3000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="38">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    data[:urls] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      report_pdf: &quot;#{base_url}/u/#{unit.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      report_json: &quot;#{base_url}/u/#{unit.id}.json&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      qr_code: &quot;#{base_url}/units/#{unit.id}/qr_code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="44">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="47">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def self.serialize_inspection(inspection, include_assessments: true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="22" data-linenumber="48">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="else branch hit 22 times">
                  else: 22
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless inspection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    # Use reflection to get all columns except excluded ones</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="51">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    inspection_fields = Inspection.column_names - PublicFieldFiltering::EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="53">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="54">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    inspection_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1760" data-linenumber="55">
            
              <span class="hits">1760</span>
            

            
              
            

            <code class="ruby">      value = inspection.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1760" data-linenumber="56">
            
              <span class="hits">1760</span>
            

            
              
                <span class="hits" title="else branch hit 1503 times">
                  else: 1503
                </span>
              
                <span class="hits" title="then branch hit 257 times">
                  then: 257
                </span>
              
            

            <code class="ruby">      data[field.to_sym] = value unless value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    # Add computed complete field</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="60">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    data[:complete] = inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    # Add inspector company info</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="22" data-linenumber="63">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 22 times">
                  then: 22
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if inspection.inspector_company.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="64">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">      data[:inspector_company] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">        name: inspection.inspector_company.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">        rpii_registration_number: inspection.inspector_company.rpii_registration_number</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    # Add unit info if present</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="22" data-linenumber="71">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 22 times">
                  then: 22
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if inspection.unit.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="72">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">      data[:unit] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">        id: inspection.unit.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">        name: inspection.unit.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">        serial_number: inspection.unit.serial_number || inspection.unit.serial,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        manufacturer: inspection.unit.manufacturer,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        owner: inspection.unit.owner,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        has_slide: inspection.unit.has_slide?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        is_totally_enclosed: inspection.unit.is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    # Include assessment data if requested</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="84">
            
              <span class="hits">22</span>
            

            
              
                <span class="hits" title="then branch hit 21 times">
                  then: 21
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if include_assessments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="85">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">      assessments = {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      # Assessment types to include</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      assessment_types = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="89">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">        user_height_assessment: UserHeightAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">        slide_assessment: SlideAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        structure_assessment: StructureAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">        anchorage_assessment: AnchorageAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        materials_assessment: MaterialsAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">        fan_assessment: FanAssessment,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">        enclosed_assessment: EnclosedAssessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="98">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">      assessment_types.each do |association_name, klass|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="147" data-linenumber="99">
            
              <span class="hits">147</span>
            

            
              
            

            <code class="ruby">        assessment = inspection.send(association_name)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="147" data-linenumber="100">
            
              <span class="hits">147</span>
            

            
              
                <span class="hits" title="else branch hit 34 times">
                  else: 34
                </span>
              
                <span class="hits" title="then branch hit 113 times">
                  then: 113
                </span>
              
            

            <code class="ruby">        next unless assessment</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">        # Skip slide assessment if unit doesn&#39;t have slide</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="34" data-linenumber="103">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 32 times">
                  else: 32
                </span>
              
            

            <code class="ruby">        next if association_name == :slide_assessment &amp;&amp; !inspection.unit&amp;.has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">        # Skip enclosed assessment if unit isn&#39;t totally enclosed</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="32" data-linenumber="106">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 32 times">
                  else: 32
                </span>
              
            

            <code class="ruby">        next if association_name == :enclosed_assessment &amp;&amp; !inspection.unit&amp;.is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="108">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">        assessments[association_name] = serialize_assessment(assessment, klass)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="111">
            
              <span class="hits">21</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">      data[:assessments] = assessments if assessments.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">    # Add public URLs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="115">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    base_url = ENV[&quot;BASE_URL&quot;] || Rails.application.routes.default_url_options[:host] || &quot;localhost:3000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="116">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    data[:urls] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      report_pdf: &quot;#{base_url}/r/#{inspection.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      report_json: &quot;#{base_url}/r/#{inspection.id}.json&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">      qr_code: &quot;#{base_url}/inspections/#{inspection.id}/qr_code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="122">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="125">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def self.serialize_assessment(assessment, klass)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">    # Use reflection to get fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="127">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    assessment_fields = klass.column_names - PublicFieldFiltering::EXCLUDED_FIELDS</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="129">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    data = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="130">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    assessment_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="629" data-linenumber="131">
            
              <span class="hits">629</span>
            

            
              
            

            <code class="ruby">      value = assessment.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="629" data-linenumber="132">
            
              <span class="hits">629</span>
            

            
              
                <span class="hits" title="else branch hit 180 times">
                  else: 180
                </span>
              
                <span class="hits" title="then branch hit 449 times">
                  then: 449
                </span>
              
            

            <code class="ruby">      data[field.to_sym] = value unless value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="32" data-linenumber="135">
            
              <span class="hits">32</span>
            

            
              
            

            <code class="ruby">    data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="56b8ef4f91ac464ef6832098c18c843c539454eb">
  <div class="header">
    <h3>app/services/ntfy_service.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>21</b> relevant lines.
      <span class="green"><b>21</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="1">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">require &quot;net/http&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="3">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">class NtfyService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="4">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="5">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    def notify(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="6">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      Thread.new do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="7">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">        send_notification(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="9">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        Rails.logger.error(&quot;NtfyService error: #{e.message}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">      ensure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="11">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">        ActiveRecord::Base.connection_pool.release_connection</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="15">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="17">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    def send_notification(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="18">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      channel = ENV[&quot;NTFY_CHANNEL&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="19">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="else branch hit 20 times">
                  else: 20
                </span>
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">      return unless channel.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="21">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      uri = URI.parse(&quot;https://ntfy.sh/#{channel}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="22">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      http = Net::HTTP.new(uri.host, uri.port)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="23">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      http.use_ssl = true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="25">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      request = Net::HTTP::Post.new(uri.path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="26">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      request[&quot;Title&quot;] = &quot;play-test notification&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="27">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      request[&quot;Priority&quot;] = &quot;high&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="28">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      request[&quot;Tags&quot;] = &quot;warning&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="29">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      request.body = message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="31">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      http.request(request)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e338be25c71450ce99a063b898621a3f4db2d1ac">
  <div class="header">
    <h3>app/services/pdf_generator_service.rb</h3>
    <h4>
      <span class="green">
  99.39%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  82.93%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>327</b> relevant lines.
      <span class="green"><b>325</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>123</b> total branches, </span>
          <span class="green"><b>102</b> branches covered</span> and
          <span class="red"><b>21</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="1">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">class PdfGeneratorService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="2">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_report(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="3">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    require &quot;prawn/table&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="5">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    Prawn::Document.new do |pdf|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="6">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      setup_pdf_fonts(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      # Header section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="9">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_inspection_pdf_header(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      # Unit details section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="12">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_inspection_equipment_details(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">      # Inspection results section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="15">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_inspection_test_results(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      # User Height/Count Assessment section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="18">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_user_height_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      # Slide Assessment section (if unit has slide)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="21">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 101 times">
                  else: 101
                </span>
              
            

            <code class="ruby">      generate_slide_section(pdf, inspection) if inspection.unit&amp;.has_slide?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      # Structure Assessment section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="24">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_structure_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      # Start two-column layout for remaining sections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="27">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      pdf.column_box([0, pdf.cursor], columns: 2, width: pdf.bounds.width, height: 400) do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        # Anchorage Assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="29">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">        generate_anchorage_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        # Totally Enclosed section (if applicable)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="32">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 101 times">
                  else: 101
                </span>
              
            

            <code class="ruby">        generate_enclosed_section(pdf, inspection) if inspection.unit&amp;.is_totally_enclosed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        # Materials Assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="35">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">        generate_materials_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        # Fan/Blower Assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="38">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">        generate_fan_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      # Risk Assessment section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="42">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_risk_assessment_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      # Testimony/Comments section</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="45">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_inspection_comments(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      # Final Result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="48">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_final_result(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      # QR Code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="51">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_qr_code_section(pdf, inspection, &quot;inspection&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      # Add DRAFT watermark overlay for draft inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="54">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="else branch hit 81 times">
                  else: 81
                </span>
              
                <span class="hits" title="then branch hit 45 times">
                  then: 45
                </span>
              
            

            <code class="ruby">      add_draft_watermark(pdf) unless inspection.complete?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      # Footer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="57">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      generate_footer(pdf, &quot;inspection&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="61">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_report(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="62">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    require &quot;prawn/table&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="64">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    Prawn::Document.new do |pdf|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="65">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      setup_pdf_fonts(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="66">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      generate_unit_pdf_header(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="67">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      generate_unit_details(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="68">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      generate_unit_inspection_history(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="69">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      generate_qr_code_section(pdf, unit, &quot;unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="70">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      generate_footer(pdf, &quot;unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="74">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.setup_pdf_fonts(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="75">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    font_path = Rails.root.join(&quot;app&quot;, &quot;assets&quot;, &quot;fonts&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="76">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.font_families.update(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      &quot;NotoSans&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        normal: &quot;#{font_path}/NotoSans-Regular.ttf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        bold: &quot;#{font_path}/NotoSans-Bold.ttf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        italic: &quot;#{font_path}/NotoSans-Regular.ttf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        bold_italic: &quot;#{font_path}/NotoSans-Bold.ttf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">      &quot;NotoEmoji&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        normal: &quot;#{font_path}/NotoEmoji-Regular.ttf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="87">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.font &quot;NotoSans&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="90">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_pdf_header(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    # Add unit photo to top right if available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="92">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    add_unit_photo(pdf, inspection.unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    # Inspection Report title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="95">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.inspection.title&quot;), size: 14, style: :bold, color: &quot;CC0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="96">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    # Issued by company</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="126" data-linenumber="99">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if inspection.inspector_company&amp;.name.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="100">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.issued_by&quot;)}: #{inspection.inspector_company.name}&quot;, size: 12, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="102">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">    # Issue date</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="126" data-linenumber="105">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.issued&quot;)} #{inspection.inspection_date&amp;.strftime(&quot;%d/%m/%Y&quot;) || I18n.t(&quot;pdf.inspection.fields.na&quot;)}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      size: 14, style: :bold, color: &quot;CC0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="107">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    # RPII Registration Number</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="126" data-linenumber="110">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if inspection.inspector_company&amp;.rpii_registration_number.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="111">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.rpii_reg_number&quot;)}: #{inspection.inspector_company.rpii_registration_number}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">        size: 14, style: :bold, color: &quot;CC0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="114">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    # Place of Inspection</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="126" data-linenumber="117">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if inspection.inspection_location.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="118">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.place_of_inspection&quot;)}: #{inspection.inspection_location}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        size: 8, style: :bold, color: &quot;CC0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="121">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">    # Unique Report Number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="124">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.unique_report_number&quot;)}: #{inspection.id}&quot;, size: 12, style: :bold, color: &quot;CC0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="125">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 20</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="128">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_equipment_details(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="129">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.inspection.equipment_details&quot;), size: 12, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="130">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="132">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    unit = inspection.unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="134">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    if unit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
            

            <code class="ruby">      # Description/Name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="136">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.description&quot;)}: #{truncate_text(unit.name || unit.description || I18n.t(&quot;pdf.inspection.fields.na&quot;), 66)}&quot;, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      # Manufacturer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="139">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">      manufacturer_text = unit.manufacturer.presence || I18n.t(&quot;pdf.inspection.fields.not_specified&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="140">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.manufacturer&quot;)}: #{manufacturer_text}&quot;, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">      # Size dimensions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="143">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">      dimensions = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="124" data-linenumber="144">
            
              <span class="hits">124</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      dimensions &lt;&lt; &quot;Width: #{unit.width}&quot; if unit.width.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="124" data-linenumber="145">
            
              <span class="hits">124</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      dimensions &lt;&lt; &quot;Length: #{unit.length}&quot; if unit.length.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="124" data-linenumber="146">
            
              <span class="hits">124</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      dimensions &lt;&lt; &quot;Height: #{unit.height}&quot; if unit.height.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="124" data-linenumber="148">
            
              <span class="hits">124</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if dimensions.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="149">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">        pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.size_m&quot;)}: #{dimensions.join(&quot; &quot;)}&quot;, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">      # Serial Number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="153">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.serial_number_asset_id&quot;)}: #{unit.serial || I18n.t(&quot;pdf.inspection.fields.na&quot;)}&quot;, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">      # Owner</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="124" data-linenumber="156">
            
              <span class="hits">124</span>
            

            
              
                <span class="hits" title="then branch hit 124 times">
                  then: 124
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.owner&quot;)}: #{unit.owner || I18n.t(&quot;pdf.inspection.fields.na&quot;)}&quot;, size: 8 if unit.owner.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">      # Unit Type / Has Slide</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="159">
            
              <span class="hits">124</span>
            

            
              
                <span class="hits" title="then branch hit 25 times">
                  then: 25
                </span>
              
                <span class="hits" title="else branch hit 99 times">
                  else: 99
                </span>
              
            

            <code class="ruby">      unit_type = unit.has_slide? ? I18n.t(&quot;pdf.inspection.fields.unit_with_slide&quot;) : I18n.t(&quot;pdf.inspection.fields.standard_unit&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="124" data-linenumber="160">
            
              <span class="hits">124</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.type&quot;)}: #{unit_type}&quot;, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="162">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      pdf.text I18n.t(&quot;pdf.inspection.fields.no_unit_associated&quot;), size: 8, style: :italic</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="165">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 15</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="168">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_test_results(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="169">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.inspection.inspection_results&quot;), size: 14, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="170">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="171">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">    results = [</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="126" data-linenumber="174">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.inspection.fields.inspection_date&quot;), inspection.inspection_date&amp;.strftime(&quot;%d/%m/%Y&quot;)],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.inspection.fields.inspector&quot;), inspection.inspector_company.name],</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="176">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 120 times">
                  then: 120
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.inspection.fields.overall_result&quot;), inspection.passed ? I18n.t(&quot;pdf.inspection.fields.pass&quot;) : I18n.t(&quot;pdf.inspection.fields.fail&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="179">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    create_pdf_table(pdf, results) do |table|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="180">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 120 times">
                  then: 120
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">      table.row(results.length - 1).background_color = inspection.passed ? &quot;CCFFCC&quot; : &quot;FFCCCC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="184">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_comments(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="185">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 20</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="186">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.inspection.comments&quot;), size: 14, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="187">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="188">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="189">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text inspection.comments</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="192">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.create_pdf_table(pdf, data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="193">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    table = pdf.table(data, width: pdf.bounds.width) do |t|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="194">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      t.cells.borders = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="195">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      t.cells.padding = [5, 10]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="196">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      t.columns(0).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="197">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      t.columns(0).width = 150</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="198">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      t.row(0..data.length - 1).background_color = &quot;EEEEEE&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="199">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      t.row(0..data.length - 1).borders = [:bottom]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="200">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      t.row(0..data.length - 1).border_color = &quot;DDDDDD&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="203">
            
              <span class="hits">180</span>
            

            
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 54 times">
                  else: 54
                </span>
              
            

            <code class="ruby">    yield table if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="204">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    table</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">  # Unit report methods (updated from equipment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="208">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_pdf_header(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">    # Add unit photo to top right if available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="210">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    add_unit_photo(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="212">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.unit.title&quot;), size: 20, style: :bold, align: :center</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="213">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 20</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="215">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.bounding_box([0, pdf.cursor], width: pdf.bounds.width, height: 70) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="216">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      pdf.stroke_bounds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="217">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="218">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.unit.fields.name&quot;).titleize}: #{unit.name}&quot;, align: :center, size: 14, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="219">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="220">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{I18n.t(&quot;pdf.unit.fields.serial_number&quot;)}: #{unit.serial}&quot;, align: :center, size: 14</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="221">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="222">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
                <span class="hits" title="else branch hit 41 times">
                  else: 41
                </span>
              
            

            <code class="ruby">      if unit.next_inspection_due</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="223">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">        pdf.text &quot;#{I18n.t(&quot;pdf.unit.next_due&quot;)}: #{unit.next_inspection_due.strftime(&quot;%d/%m/%Y&quot;)}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">          align: :center, size: 14,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="225">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">          color: (unit.next_inspection_due &lt; Date.today) ? &quot;CC0000&quot; : &quot;000000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="228">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 20</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="231">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_details(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="232">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.unit.details&quot;), size: 14, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="233">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="234">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">    data = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="237">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.unit.fields.name&quot;), unit.name],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.unit.fields.serial_number&quot;), unit.serial],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.unit.fields.manufacturer&quot;), unit.manufacturer.presence || I18n.t(&quot;pdf.unit.fields.not_specified&quot;)],</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="240">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 53 times">
                  else: 53
                </span>
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.unit.fields.has_slide&quot;), unit.has_slide? ? I18n.t(&quot;shared.yes&quot;) : I18n.t(&quot;shared.no&quot;)],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.unit.fields.owner&quot;), unit.owner],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">      [I18n.t(&quot;pdf.unit.fields.dimensions&quot;), unit.dimensions]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby">    # Add next inspection due if available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="246">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
                <span class="hits" title="else branch hit 41 times">
                  else: 41
                </span>
              
            

            <code class="ruby">    if unit.next_inspection_due</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="247">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      data &lt;&lt; [I18n.t(&quot;pdf.unit.fields.next_inspection_due&quot;), unit.next_inspection_due.strftime(&quot;%d/%m/%Y&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="250">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    create_pdf_table(pdf, data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="251">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 20</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="254">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_inspection_history(pdf, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="255">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.unit.inspection_history&quot;), size: 14, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="256">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="257">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">    # Check for completed inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="260">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    completed_inspections = unit.inspections.complete.order(inspection_date: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="262">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 42 times">
                  then: 42
                </span>
              
            

            <code class="ruby">    if completed_inspections.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="263">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">      pdf.text I18n.t(&quot;pdf.unit.no_completed_inspections&quot;), size: 10, style: :italic</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42" data-linenumber="264">
            
              <span class="hits">42</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">      # Create table headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">      headers = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="268">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.unit.fields.date&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.unit.fields.inspector&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.unit.fields.result&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">        I18n.t(&quot;pdf.unit.fields.comments&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">      # Create table data from inspections</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="275">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      inspections_data = completed_inspections.map do |inspection|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">        [</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="20" data-linenumber="277">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="then branch hit 20 times">
                  then: 20
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          inspection.inspection_date&amp;.strftime(&quot;%d/%m/%Y&quot;) || I18n.t(&quot;pdf.unit.fields.na&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">          inspection.inspector_company.name,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="279">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="then branch hit 15 times">
                  then: 15
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">          inspection.passed ? I18n.t(&quot;pdf.unit.fields.pass&quot;) : I18n.t(&quot;pdf.unit.fields.fail&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">          inspection.comments.to_s.truncate(30)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">      # Combine headers and data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="285">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      table_data = [headers] + inspections_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">      # Create table</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="288">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      pdf.table(table_data, width: pdf.bounds.width) do |table|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="289">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        table.cells.padding = [5, 5]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="290">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        table.row(0).font_style = :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="291">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        table.row(0).background_color = &quot;DDDDDD&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">        # Color code pass/fail cells</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="294">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        inspections_data.each_with_index do |_, index|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="295">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">          inspection = completed_inspections[index]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="296">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="then branch hit 15 times">
                  then: 15
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">          table.row(index + 1).column(2).background_color = inspection.passed ? &quot;CCFFCC&quot; : &quot;FFCCCC&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby">        # Set column widths</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="300">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        table.column(0).width = 75  # Date</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="301">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        table.column(1).width = 85  # Inspector</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="302">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        table.column(2).width = 60  # Result</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="303">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        table.column(3).width = pdf.bounds.width - 220  # Comments - remaining width</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby">  # Assessment section generators</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="309">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_user_height_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="310">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    generate_assessment_section(pdf, &quot;user_height&quot;, inspection.user_height_assessment) do |assessment, type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby">      # Standard measurement fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">      measurement_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="313">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">        [:containing_wall_height, &quot;m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby">        [:platform_height, &quot;m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">        [:tallest_user_height, &quot;m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">        [:play_area_length, &quot;m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby">        [:play_area_width, &quot;m&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="320">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      measurement_fields.each do |field, unit|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="65" data-linenumber="321">
            
              <span class="hits">65</span>
            

            
              
            

            <code class="ruby">        add_field_with_comment(pdf, assessment, field, unit, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            
              
            

            <code class="ruby">      # Permanent Roof</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="325">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">      if !assessment.permanent_roof.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="326">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        add_boolean_field_with_comment(pdf, assessment, :permanent_roof, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="329">
            

            
              
            

            <code class="ruby">      # Negative Adjustment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="330">
            
              <span class="hits">13</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      if assessment.negative_adjustment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="331">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        add_field_with_comment(pdf, assessment, :negative_adjustment, &quot;m²&quot;, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="334">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby">      # User Capacities</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="337">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      pdf.text I18n.t(&quot;inspections.assessments.user_height.sections.user_capacities&quot;), size: 8, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="339">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      user_capacity_heights = [1000, 1200, 1500, 1800]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="340">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      user_capacity_heights.each do |height|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="341">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">        field_name = &quot;users_at_#{height}mm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="342">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">        value = assessment.send(field_name) || I18n.t(&quot;pdf.inspection.fields.na&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="343">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">        pdf.text &quot;• #{I18n.t(&quot;inspections.assessments.user_height.fields.#{field_name}&quot;)}: #{value}&quot;, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="348">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_slide_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="349">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    generate_assessment_section(pdf, &quot;slide&quot;, inspection.slide_assessment) do |assessment, type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
            

            <code class="ruby">      # Height measurement fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            
              
            

            <code class="ruby">      height_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="352">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        [:slide_platform_height, &quot;m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            

            
              
            

            <code class="ruby">        [:slide_wall_height, &quot;m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            

            
              
            

            <code class="ruby">        [:slide_first_metre_height, &quot;m&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="355">
            

            
              
            

            <code class="ruby">        [:slide_beyond_first_metre_height, &quot;m&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="358">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      height_fields.each do |field, unit|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="359">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        add_field_with_comment(pdf, assessment, field, unit, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="360">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="361">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="362">
            

            
              
            

            <code class="ruby">      # Permanent Roof</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="363">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      if !assessment.slide_permanent_roof.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="364">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        add_boolean_field_with_comment(pdf, assessment, :slide_permanent_roof, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            
              
            

            <code class="ruby">      # Pass/fail fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="368">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields = [:clamber_netting_pass, :slip_sheet_pass]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="369">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="370">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        add_pass_fail_field_with_comment(pdf, assessment, field, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            
              
            

            <code class="ruby">      # Runout (special case with measurement and pass/fail)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="374">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      add_measurement_pass_fail_field(pdf, assessment, :runout_value, &quot;m&quot;, :runout_pass, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="378">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_structure_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="379">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    generate_assessment_section(pdf, &quot;structure&quot;, inspection.structure_assessment) do |assessment, type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby">      # Simple pass/fail fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="381">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="382">
            

            
              
            

            <code class="ruby">        :seam_integrity_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="383">
            

            
              
            

            <code class="ruby">        :lock_stitch_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="384">
            

            
              
            

            <code class="ruby">        :air_loss_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            
              
            

            <code class="ruby">        :straight_walls_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="386">
            

            
              
            

            <code class="ruby">        :sharp_edges_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="387">
            

            
              
            

            <code class="ruby">        :unit_stable_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            

            
              
            

            <code class="ruby">        :evacuation_time_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="390">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="391">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="392">
            
              <span class="hits">77</span>
            

            
              
            

            <code class="ruby">        add_pass_fail_field_with_comment(pdf, assessment, field, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="394">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="395">
            

            
              
            

            <code class="ruby">      # Measurement fields with pass/fail</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="396">
            

            
              
            

            <code class="ruby">      measurement_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="397">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">        [:stitch_length, &quot;mm&quot;, :stitch_length_pass],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="398">
            

            
              
            

            <code class="ruby">        [:blower_tube_length, &quot;m&quot;, :blower_tube_length_pass],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="399">
            

            
              
            

            <code class="ruby">        [:unit_pressure_value, &quot;Pa&quot;, :unit_pressure_pass]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="400">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="401">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="402">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      measurement_fields.each do |value_field, unit, pass_field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="403">
            
              <span class="hits">33</span>
            

            
              
            

            <code class="ruby">        add_measurement_pass_fail_field(pdf, assessment, value_field, unit, pass_field, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="404">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="405">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="406">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="407">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="408">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_anchorage_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="409">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    generate_assessment_section(pdf, &quot;anchorage&quot;, inspection.anchorage_assessment) do |assessment, type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="410">
            

            
              
            

            <code class="ruby">      # Number of anchors with special formatting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="411">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      label = I18n.t(&quot;inspections.assessments.anchorage.fields.num_anchors_pass&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="412">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      anchor_text = &quot;#{label}: #{I18n.t(&quot;inspections.assessments.anchorage.fields.num_low_anchors&quot;)}: #{assessment.num_low_anchors || I18n.t(&quot;pdf.inspection.fields.na&quot;)}, #{I18n.t(&quot;inspections.assessments.anchorage.fields.num_high_anchors&quot;)}: #{assessment.num_high_anchors || I18n.t(&quot;pdf.inspection.fields.na&quot;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="413">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      add_text_pass_fail_field(pdf, anchor_text, assessment, :num_anchors_pass)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="414">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="415">
            

            
              
            

            <code class="ruby">      # Pass/fail fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="416">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="417">
            

            
              
            

            <code class="ruby">        :anchor_type_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="418">
            

            
              
            

            <code class="ruby">        :pull_strength_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="419">
            

            
              
            

            <code class="ruby">        :anchor_degree_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="420">
            

            
              
            

            <code class="ruby">        :anchor_accessories_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="421">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="422">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="423">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="424">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        add_pass_fail_field_with_comment(pdf, assessment, field, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="425">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="426">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="427">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="428">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="429">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_enclosed_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="430">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    generate_assessment_section(pdf, &quot;enclosed&quot;, inspection.enclosed_assessment) do |assessment, type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="431">
            

            
              
            

            <code class="ruby">      # Exit number with pass/fail</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="432">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      label = I18n.t(&quot;inspections.assessments.enclosed.fields.exit_number&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="433">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      exit_text = &quot;#{label}: #{assessment.exit_number || I18n.t(&quot;pdf.inspection.fields.na&quot;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="434">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      add_text_pass_fail_field(pdf, exit_text, assessment, :exit_number_pass)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="435">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="436">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      add_pass_fail_field_with_comment(pdf, assessment, :exit_visible_pass, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="437">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="438">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="439">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="440">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_materials_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="441">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    generate_assessment_section(pdf, &quot;materials&quot;, inspection.materials_assessment) do |assessment, type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="442">
            

            
              
            

            <code class="ruby">      # Pass/fail fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="443">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields = [:fabric_pass, :fire_retardant_pass, :thread_pass]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="444">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="445">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">        add_pass_fail_field_with_comment(pdf, assessment, field, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="446">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="447">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="448">
            

            
              
            

            <code class="ruby">      # Rope size with measurement</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="449">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      add_measurement_pass_fail_field(pdf, assessment, :rope_size, &quot;mm&quot;, :rope_size_pass, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="450">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="451">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="452">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="453">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_fan_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="454">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    generate_assessment_section(pdf, &quot;fan&quot;, inspection.fan_assessment) do |assessment, type|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="455">
            

            
              
            

            <code class="ruby">      # Pass/fail fields</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="456">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="457">
            

            
              
            

            <code class="ruby">        :blower_flap_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="458">
            

            
              
            

            <code class="ruby">        :blower_finger_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="459">
            

            
              
            

            <code class="ruby">        :pat_pass,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="460">
            

            
              
            

            <code class="ruby">        :blower_visual_pass</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="461">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="462">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="463">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      pass_fail_fields.each do |field|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="464">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">        add_pass_fail_field_with_comment(pdf, assessment, field, type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="465">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="466">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="467">
            

            
              
            

            <code class="ruby">      # Optional text fields</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="468">
            

            
              
            

            <code class="ruby">      optional_fields = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="469">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        [:blower_serial, nil],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="470">
            

            
              
            

            <code class="ruby">        [:fan_size_comment, 60]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="471">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="472">
            

            
              
            

            <code class="ruby">      </code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="473">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      optional_fields.each do |field, truncate_length|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="474">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">        if assessment.send(field).present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="475">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">          label = I18n.t(&quot;inspections.assessments.fan.fields.#{field}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="476">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">          value = assessment.send(field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="477">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">          value = truncate_text(value, truncate_length) if truncate_length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="478">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">          pdf.text &quot;#{label}: #{value}&quot;, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="479">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="480">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="481">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="482">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="483">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="484">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_risk_assessment_section(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="485">
            

            
              
            

            <code class="ruby">    # This section doesn&#39;t exist in the current model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="486">
            

            
              
            

            <code class="ruby">    # Placeholder for future implementation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="487">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="488">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="489">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_final_result(pdf, inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="490">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.inspection.final_result&quot;), size: 14, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="491">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="492">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="493">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 120 times">
                  then: 120
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    result_text = inspection.passed? ? I18n.t(&quot;pdf.inspection.fields.passed&quot;) : I18n.t(&quot;pdf.inspection.fields.failed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="494">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 120 times">
                  then: 120
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    result_color = inspection.passed? ? &quot;008000&quot; : &quot;CC0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="495">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="496">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.text result_text, size: 16, style: :bold, color: result_color</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="497">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="498">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="499">
            
              <span class="hits">126</span>
            

            
              
                <span class="hits" title="then branch hit 81 times">
                  then: 81
                </span>
              
                <span class="hits" title="else branch hit 45 times">
                  else: 45
                </span>
              
            

            <code class="ruby">    pdf.text &quot;#{I18n.t(&quot;pdf.inspection.fields.status&quot;)}: #{inspection.complete? ? I18n.t(&quot;pdf.inspection.fields.complete&quot;) : I18n.t(&quot;pdf.inspection.fields.draft&quot;)}&quot;, size: 10</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="500">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 15</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="501">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="502">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="503">
            

            
              
            

            <code class="ruby">  # Generic helper methods for DRY code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="504">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_assessment_section(pdf, assessment_type, assessment)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="680" data-linenumber="505">
            
              <span class="hits">680</span>
            

            
              
            

            <code class="ruby">    title = I18n.t(&quot;inspections.assessments.#{assessment_type}.title&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="680" data-linenumber="506">
            
              <span class="hits">680</span>
            

            
              
            

            <code class="ruby">    pdf.text title, size: 12, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="680" data-linenumber="507">
            
              <span class="hits">680</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="508">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="680" data-linenumber="509">
            
              <span class="hits">680</span>
            

            
              
                <span class="hits" title="then branch hit 59 times">
                  then: 59
                </span>
              
            

            <code class="ruby">    if assessment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="59" data-linenumber="510">
            
              <span class="hits">59</span>
            

            
              
            

            <code class="ruby">      yield(assessment, assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="511">
            

            
              
                <span class="hits" title="else branch hit 621 times">
                  else: 621
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="621" data-linenumber="512">
            
              <span class="hits">621</span>
            

            
              
            

            <code class="ruby">      pdf.text I18n.t(&quot;pdf.inspection.no_assessment_data&quot;, assessment_type: title), size: 8, style: :italic</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="513">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="514">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="680" data-linenumber="515">
            
              <span class="hits">680</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 15</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="516">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="517">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="518">
            

            
              
            

            <code class="ruby">  # Generic field rendering method that handles all field types</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="519">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_field(pdf, assessment, field_name, assessment_type, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="520">
            

            
              
            

            <code class="ruby">    # Extract options with defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="521">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    unit = options[:unit]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="522">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    pass_field = options[:pass_field]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="523">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    custom_label = options[:label]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="524">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    custom_text = options[:text]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="525">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="526">
            

            
              
            

            <code class="ruby">    # Get the label</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="527">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    label = custom_label || I18n.t(&quot;inspections.assessments.#{assessment_type}.fields.#{field_name}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="528">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="529">
            

            
              
            

            <code class="ruby">    # Get the value</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="326" data-linenumber="530">
            
              <span class="hits">326</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 326 times">
                  then: 326
                </span>
              
            

            <code class="ruby">    value = assessment.send(field_name) unless custom_text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="531">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="532">
            

            
              
            

            <code class="ruby">    # Format the value based on field type</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="326" data-linenumber="533">
            
              <span class="hits">326</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    formatted_value = if custom_text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="534">
            

            
              
                <span class="hits" title="else branch hit 326 times">
                  else: 326
                </span>
              
            

            <code class="ruby">      custom_text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="535">
            
              <span class="hits">326</span>
            

            
              
                <span class="hits" title="then branch hit 145 times">
                  then: 145
                </span>
              
            

            <code class="ruby">    elsif unit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="145" data-linenumber="536">
            
              <span class="hits">145</span>
            

            
              
                <span class="hits" title="else branch hit 181 times">
                  else: 181
                </span>
              
            

            <code class="ruby">      format_measurement(value, unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="181" data-linenumber="537">
            
              <span class="hits">181</span>
            

            
              
                <span class="hits" title="then branch hit 175 times">
                  then: 175
                </span>
              
            

            <code class="ruby">    elsif field_name.to_s.include?(&quot;_pass&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="175" data-linenumber="538">
            
              <span class="hits">175</span>
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">      format_pass_fail(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="539">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    elsif [true, false].include?(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="540">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      value ? I18n.t(&quot;shared.yes&quot;) : I18n.t(&quot;shared.no&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="541">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="542">
            

            
              
            

            <code class="ruby">      value || I18n.t(&quot;pdf.inspection.fields.na&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="543">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="544">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="545">
            

            
              
            

            <code class="ruby">    # Build the text parts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="546">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    text_parts = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="326" data-linenumber="547">
            
              <span class="hits">326</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 326 times">
                  then: 326
                </span>
              
            

            <code class="ruby">    text_parts &lt;&lt; &quot;#{label}:&quot; unless custom_text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="548">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    text_parts &lt;&lt; formatted_value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="549">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="550">
            

            
              
            

            <code class="ruby">    # Add pass/fail if specified</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="551">
            
              <span class="hits">326</span>
            

            
              
                <span class="hits" title="then branch hit 47 times">
                  then: 47
                </span>
              
                <span class="hits" title="else branch hit 279 times">
                  else: 279
                </span>
              
            

            <code class="ruby">    if pass_field</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="552">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">      pass_fail = assessment.send(pass_field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="553">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">      text_parts &lt;&lt; &quot;-&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="554">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">      text_parts &lt;&lt; format_pass_fail(pass_fail)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="555">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="556">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="557">
            

            
              
            

            <code class="ruby">    # Add comment if it exists</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="558">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    comment_field = derive_comment_field_name(field_name, pass_field)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="326" data-linenumber="559">
            
              <span class="hits">326</span>
            

            
              
                <span class="hits" title="then branch hit 326 times">
                  then: 326
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if assessment.respond_to?(comment_field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="560">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">      comment = assessment.send(comment_field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="561">
            
              <span class="hits">326</span>
            

            
              
                <span class="hits" title="then branch hit 171 times">
                  then: 171
                </span>
              
                <span class="hits" title="else branch hit 155 times">
                  else: 155
                </span>
              
            

            <code class="ruby">      text_parts &lt;&lt; truncate_text(comment, 60) if comment.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="562">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="563">
            

            
              
            

            <code class="ruby">    </code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="564">
            

            
              
            

            <code class="ruby">    # Render the complete text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="565">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    pdf.text text_parts.join(&quot; &quot;), size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="566">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="567">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="568">
            

            
              
            

            <code class="ruby">  # Derive the comment field name based on the main field or pass field</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="569">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.derive_comment_field_name(field_name, pass_field = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="570">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    if pass_field</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="571">
            

            
              
                <span class="hits" title="then branch hit 47 times">
                  then: 47
                </span>
              
            

            <code class="ruby">      # Use pass field as base, removing _pass suffix</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="572">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">      base_name = pass_field.to_s.gsub(/_pass$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="573">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="574">
            

            
              
                <span class="hits" title="else branch hit 279 times">
                  else: 279
                </span>
              
            

            <code class="ruby">      # Use field name as base, removing _pass suffix if present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="279" data-linenumber="575">
            
              <span class="hits">279</span>
            

            
              
            

            <code class="ruby">      base_name = field_name.to_s.gsub(/_pass$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="576">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="326" data-linenumber="577">
            
              <span class="hits">326</span>
            

            
              
            

            <code class="ruby">    &quot;#{base_name}_comment&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="578">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="579">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="580">
            

            
              
            

            <code class="ruby">  # Wrapper methods for backward compatibility and clarity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="581">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_field_with_comment(pdf, assessment, field_name, unit, assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="98" data-linenumber="582">
            
              <span class="hits">98</span>
            

            
              
            

            <code class="ruby">    add_field(pdf, assessment, field_name, assessment_type, unit: unit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="583">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="584">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="585">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_boolean_field_with_comment(pdf, assessment, field_name, assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="586">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    add_field(pdf, assessment, field_name, assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="587">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="588">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="589">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_pass_fail_field_with_comment(pdf, assessment, field_name, assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="175" data-linenumber="590">
            
              <span class="hits">175</span>
            

            
              
            

            <code class="ruby">    add_field(pdf, assessment, field_name, assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="591">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="592">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="593">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_measurement_pass_fail_field(pdf, assessment, value_field, unit, pass_field, assessment_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="594">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    add_field(pdf, assessment, value_field, assessment_type, unit: unit, pass_field: pass_field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="595">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="596">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="597">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_text_pass_fail_field(pdf, text, assessment, pass_field)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="598">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    pass_fail = assessment.send(pass_field)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="599">
            

            
              
            

            <code class="ruby">    # Remove _pass suffix to get the base field name for comment</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="600">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    base_field_name = pass_field.to_s.gsub(/_pass$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="14" data-linenumber="601">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    comment = assessment.send(&quot;#{base_field_name}_comment&quot;) if assessment.respond_to?(&quot;#{base_field_name}_comment&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="602">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    full_text = &quot;#{text} - #{format_pass_fail(pass_fail)} #{truncate_text(comment, 60)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="603">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    pdf.text full_text, size: 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="604">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="605">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="606">
            

            
              
            

            <code class="ruby">  # Generic QR code generation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="607">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_qr_code_section(pdf, record, type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="608">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 20</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="609">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.#{type}.verification&quot;), size: 14, style: :bold</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="610">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.stroke_horizontal_rule</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="611">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="612">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="613">
            

            
              
            

            <code class="ruby">    # Generate QR code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="614">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    qr_code_png = QrCodeService.generate_qr_code(record)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="615">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    qr_code_temp_file = Tempfile.new([&quot;qr_code_#{type}_#{record.id}_#{Process.pid}&quot;, &quot;.png&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="616">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="617">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="618">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      qr_code_temp_file.binmode</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="619">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      qr_code_temp_file.write(qr_code_png)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="620">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      qr_code_temp_file.close</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="621">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="622">
            

            
              
            

            <code class="ruby">      # Add QR code image and URL text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="623">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      pdf.image qr_code_temp_file.path, position: :center, width: 180</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="624">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      pdf.move_down 5</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="625">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      pdf.text I18n.t(&quot;pdf.#{type}.scan_text&quot;), align: :center, size: 10</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="626">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="627">
            

            
              
            

            <code class="ruby">      # Determine URL prefix based on type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="628">
            
              <span class="hits">180</span>
            

            
              
                <span class="hits" title="then branch hit 126 times">
                  then: 126
                </span>
              
                <span class="hits" title="else branch hit 54 times">
                  else: 54
                </span>
              
            

            <code class="ruby">      url_prefix = (type == &quot;inspection&quot;) ? &quot;r&quot; : &quot;u&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="629">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">      pdf.text &quot;#{ENV[&quot;BASE_URL&quot;]}/#{url_prefix}/#{record.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="630">
            

            
              
            

            <code class="ruby">        align: :center, size: 10, style: :italic</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="631">
            

            
              
            

            <code class="ruby">    ensure</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="180" data-linenumber="632">
            
              <span class="hits">180</span>
            

            
              
                <span class="hits" title="else branch hit 180 times">
                  else: 180
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      qr_code_temp_file.close unless qr_code_temp_file.closed?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="180" data-linenumber="633">
            
              <span class="hits">180</span>
            

            
              
                <span class="hits" title="then branch hit 180 times">
                  then: 180
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      qr_code_temp_file.unlink if File.exist?(qr_code_temp_file.path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="634">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="635">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="636">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="637">
            

            
              
            

            <code class="ruby">  # Generic footer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="638">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_footer(pdf, type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="639">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.move_down 30</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="640">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.text &quot;#{I18n.t(&quot;pdf.#{type}.generated_text&quot;)} #{Time.now.strftime(&quot;%d/%m/%Y at %H:%M&quot;)}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="641">
            

            
              
            

            <code class="ruby">      size: 10, align: :center, style: :italic</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="180" data-linenumber="642">
            
              <span class="hits">180</span>
            

            
              
            

            <code class="ruby">    pdf.text I18n.t(&quot;pdf.#{type}.footer_text&quot;), size: 10, align: :center, style: :italic</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="643">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="644">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="645">
            

            
              
            

            <code class="ruby">  # Helper methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="646">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.truncate_text(text, max_length)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="320" data-linenumber="647">
            
              <span class="hits">320</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 314 times">
                  else: 314
                </span>
              
            

            <code class="ruby">    return &quot;&quot; if text.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="314" data-linenumber="648">
            
              <span class="hits">314</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 309 times">
                  else: 309
                </span>
              
            

            <code class="ruby">    (text.length &gt; max_length) ? &quot;#{text[0...max_length]}...&quot; : text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="649">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="650">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="651">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.format_pass_fail(value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="242" data-linenumber="652">
            
              <span class="hits">242</span>
            

            
              
                <span class="hits" title="when branch hit 142 times">
                  when: 142
                </span>
              
            

            <code class="ruby">    case value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="142" data-linenumber="653">
            
              <span class="hits">142</span>
            

            
              
                <span class="hits" title="when branch hit 8 times">
                  when: 8
                </span>
              
            

            <code class="ruby">    when true then I18n.t(&quot;pdf.inspection.fields.pass&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="654">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="else branch hit 92 times">
                  else: 92
                </span>
              
            

            <code class="ruby">    when false then I18n.t(&quot;pdf.inspection.fields.fail&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="92" data-linenumber="655">
            
              <span class="hits">92</span>
            

            
              
            

            <code class="ruby">    else I18n.t(&quot;pdf.inspection.fields.na&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="656">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="657">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="658">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="659">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.format_measurement(value, unit = &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="660">
            
              <span class="hits">151</span>
            

            
              
                <span class="hits" title="then branch hit 63 times">
                  then: 63
                </span>
              
                <span class="hits" title="else branch hit 88 times">
                  else: 88
                </span>
              
            

            <code class="ruby">    return I18n.t(&quot;pdf.inspection.fields.na&quot;) if value.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="661">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">    &quot;#{value}#{unit}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="662">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="663">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="664">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_draft_watermark(pdf)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="665">
            

            
              
            

            <code class="ruby">    # Add 3x3 grid of DRAFT watermarks to each page</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="666">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">    (1..pdf.page_count).each do |page_num|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="667">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">      pdf.go_to_page(page_num)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="668">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="669">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">      pdf.transparent(0.3) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="670">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        pdf.fill_color &quot;FF0000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="671">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="672">
            

            
              
            

            <code class="ruby">        # 3x3 grid positions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="540" data-linenumber="673">
            
              <span class="hits">540</span>
            

            
              
            

            <code class="ruby">        y_positions = [0.10, 0.30, 0.50, 0.70, 0.9].map { |pct| pdf.bounds.height * pct }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="360" data-linenumber="674">
            
              <span class="hits">360</span>
            

            
              
            

            <code class="ruby">        x_positions = [0.15, 0.50, 0.85].map { |pct| pdf.bounds.width * pct - 50 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="675">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="676">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">        y_positions.each do |y|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="450" data-linenumber="677">
            
              <span class="hits">450</span>
            

            
              
            

            <code class="ruby">          x_positions.each do |x|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1350" data-linenumber="678">
            
              <span class="hits">1350</span>
            

            
              
            

            <code class="ruby">            pdf.text_box I18n.t(&quot;pdf.inspection.watermark.draft&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="679">
            

            
              
            

            <code class="ruby">              at: [x, y],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="680">
            

            
              
            

            <code class="ruby">              width: 100,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="681">
            

            
              
            

            <code class="ruby">              height: 60,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="682">
            

            
              
            

            <code class="ruby">              size: 24,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="683">
            

            
              
            

            <code class="ruby">              style: :bold,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="684">
            

            
              
            

            <code class="ruby">              align: :center,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="685">
            

            
              
            

            <code class="ruby">              valign: :top</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="686">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="687">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="688">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="689">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="90" data-linenumber="690">
            
              <span class="hits">90</span>
            

            
              
            

            <code class="ruby">      pdf.fill_color &quot;000000&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="691">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="692">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="693">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="694">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.add_unit_photo(pdf, unit, x_position = nil, y_position = nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="178" data-linenumber="695">
            
              <span class="hits">178</span>
            

            
              
                <span class="hits" title="then branch hit 176 times">
                  then: 176
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 176 times">
                  then: 176
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 174 times">
                  then: 174
                </span>
              
            

            <code class="ruby">    return unless unit&amp;.photo&amp;.attached?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="696">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="697">
            

            
              
            

            <code class="ruby">    # Default position: top right corner</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="698">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    x_pos = x_position || (pdf.bounds.width - 130)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="699">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    y_pos = y_position || pdf.cursor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="700">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="701">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="702">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      pdf.image unit.photo, at: [x_pos, y_pos], width: 120, height: 90</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="703">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="704">
            

            
              
            

            <code class="ruby">      # If image fails to load, just continue without it</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="705">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      Rails.logger.warn &quot;Failed to add unit photo to PDF: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="706">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="707">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="708">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="99d09a1db65b6c0de036bf1de77a4d861dc56882">
  <div class="header">
    <h3>app/services/qr_code_service.rb</h3>
    <h4>
      <span class="green">
  95.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>20</b> relevant lines.
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>3</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="1">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">class QrCodeService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="2">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_qr_code(record)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="190" data-linenumber="3">
            
              <span class="hits">190</span>
            

            
              
            

            <code class="ruby">    require &quot;rqrcode&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">    # Create QR code for the report URL using the shorter format</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="190" data-linenumber="6">
            
              <span class="hits">190</span>
            

            
              
                <span class="hits" title="then branch hit 132 times">
                  then: 132
                </span>
              
            

            <code class="ruby">    if record.is_a?(Inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="132" data-linenumber="7">
            
              <span class="hits">132</span>
            

            
              
                <span class="hits" title="else branch hit 58 times">
                  else: 58
                </span>
              
            

            <code class="ruby">      generate_inspection_qr_code(record)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="8">
            
              <span class="hits">58</span>
            

            
              
                <span class="hits" title="then branch hit 58 times">
                  then: 58
                </span>
              
            

            <code class="ruby">    elsif record.is_a?(Unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="9">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">      generate_unit_qr_code(record)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="10">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">      raise ArgumentError, &quot;Unsupported record type: #{record.class}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="15">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_inspection_qr_code(inspection)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="132" data-linenumber="16">
            
              <span class="hits">132</span>
            

            
              
            

            <code class="ruby">    require &quot;rqrcode&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="132" data-linenumber="18">
            
              <span class="hits">132</span>
            

            
              
            

            <code class="ruby">    url = &quot;#{ENV[&quot;BASE_URL&quot;]}/r/#{inspection.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="132" data-linenumber="19">
            
              <span class="hits">132</span>
            

            
              
            

            <code class="ruby">    generate_qr_code_from_url(url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="22">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_unit_qr_code(unit)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="23">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">    require &quot;rqrcode&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="25">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">    url = &quot;#{ENV[&quot;BASE_URL&quot;]}/u/#{unit.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="58" data-linenumber="26">
            
              <span class="hits">58</span>
            

            
              
            

            <code class="ruby">    generate_qr_code_from_url(url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="29">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">  def self.generate_qr_code_from_url(url)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    # Upper case characters take less QR code space (!?!)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="190" data-linenumber="31">
            
              <span class="hits">190</span>
            

            
              
            

            <code class="ruby">    url.upcase!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    # Create QR code with optimized options for chunkier appearance</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="190" data-linenumber="34">
            
              <span class="hits">190</span>
            

            
              
            

            <code class="ruby">    qrcode = RQRCode::QRCode.new(url, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      # Use lower error correction level for fewer modules (chunkier code)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      # :l - 7% error correction (lowest, largest modules)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      # :m - 15% error correction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      # :q - 25% error correction</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      # :h - 30% error correction (highest, smallest modules)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      level: :m</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="190" data-linenumber="43">
            
              <span class="hits">190</span>
            

            
              
            

            <code class="ruby">    qrcode.as_png(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      bit_depth: 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      border_modules: 2,           # Less border space</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      color_mode: ChunkyPNG::COLOR_GRAYSCALE,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      color: &quot;black&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      file: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      fill: &quot;white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      module_px_size: 8,           # Larger modules</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      resize_exactly_to: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      resize_gte_to: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      size: 300</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    ).to_blob</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6af6e7148eda8cbcb7f0db60c80b24c30fd73de0">
  <div class="header">
    <h3>lib/i18n_usage_tracker.rb</h3>
    <h4>
      <span class="green">
  95.95%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  70.83%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>74</b> relevant lines.
      <span class="green"><b>71</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>24</b> total branches, </span>
          <span class="green"><b>17</b> branches covered</span> and
          <span class="red"><b>7</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Module to track I18n key usage during test runs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="2">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module I18nUsageTracker</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="3">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="4">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    attr_accessor :tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="5">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    attr_reader :used_keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="7">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def reset!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="8">
            
              <span class="hits">66</span>
            

            
              
            

            <code class="ruby">      @used_keys = Set.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="9">
            
              <span class="hits">66</span>
            

            
              
            

            <code class="ruby">      @tracking_enabled = false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="12">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def track_key(key, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="13">
            
              <span class="hits">26</span>
            

            
              
                <span class="hits" title="else branch hit 24 times">
                  else: 24
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">      return unless tracking_enabled &amp;&amp; key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      # Handle both string and symbol keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="16">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      key_string = key.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      # Skip Rails internal keys and error keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="19">
            
              <span class="hits">24</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">      return if key_string.start_with?(&quot;errors.&quot;, &quot;activerecord.&quot;, &quot;activemodel.&quot;, &quot;helpers.&quot;, &quot;number.&quot;, &quot;date.&quot;, &quot;time.&quot;, &quot;support.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      # Track the full key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="22">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      @used_keys &lt;&lt; key_string</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      # Also track parent keys for nested translations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      # e.g., for &quot;users.messages.created&quot;, also track &quot;users.messages&quot; and &quot;users&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="26">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      parts = key_string.split(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="27">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      (1...parts.length).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="28">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">        parent_key = parts[0...i].join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="15" data-linenumber="29">
            
              <span class="hits">15</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 15 times">
                  then: 15
                </span>
              
            

            <code class="ruby">        @used_keys &lt;&lt; parent_key unless parent_key.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      # Track keys used with scope option</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="33">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">      if options[:scope]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="34">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        scope = Array(options[:scope]).join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="35">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        full_key = &quot;#{scope}.#{key_string}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="36">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        @used_keys &lt;&lt; full_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        # Track parent keys for scoped translations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="39">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        full_parts = full_key.split(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="40">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        (1...full_parts.length).each do |i|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="41">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">          parent_key = full_parts[0...i].join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="42">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
            

            <code class="ruby">          @used_keys &lt;&lt; parent_key unless parent_key.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="47">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def all_locale_keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="48">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      @all_locale_keys ||= begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        keys = Set.new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">        # Load all locale files</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        locale_files = Dir[Rails.root.join(&quot;config&quot;, &quot;locales&quot;, &quot;**&quot;, &quot;*.yml&quot;)]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        locale_files.each do |file|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="55">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">          yaml_content = YAML.load_file(file)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">          # Process each locale (en, es, etc.)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="58">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">          yaml_content.each do |locale, content|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="59">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">            extract_keys_from_hash(content, [], keys)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="67">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def unused_keys</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="68">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      all_locale_keys - used_keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="71">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def usage_report</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="72">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      total_keys = all_locale_keys.size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="73">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      used_count = used_keys.size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="74">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      unused_count = unused_keys.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="77">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        total_keys: total_keys,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        used_keys: used_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        unused_keys: unused_count,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="80">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        usage_percentage: (used_count.to_f / total_keys * 100).round(2),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        unused_key_list: unused_keys.sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="87">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def extract_keys_from_hash(hash, current_path, keys)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="196" data-linenumber="88">
            
              <span class="hits">196</span>
            

            
              
            

            <code class="ruby">      hash.each do |key, value|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1084" data-linenumber="89">
            
              <span class="hits">1084</span>
            

            
              
            

            <code class="ruby">        new_path = current_path + [key.to_s]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1084" data-linenumber="90">
            
              <span class="hits">1084</span>
            

            
              
            

            <code class="ruby">        full_key = new_path.join(&quot;.&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1084" data-linenumber="92">
            
              <span class="hits">1084</span>
            

            
              
                <span class="hits" title="then branch hit 176 times">
                  then: 176
                </span>
              
            

            <code class="ruby">        if value.is_a?(Hash)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="176" data-linenumber="93">
            
              <span class="hits">176</span>
            

            
              
            

            <code class="ruby">          keys &lt;&lt; full_key</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="176" data-linenumber="94">
            
              <span class="hits">176</span>
            

            
              
            

            <code class="ruby">          extract_keys_from_hash(value, new_path, keys)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
                <span class="hits" title="else branch hit 908 times">
                  else: 908
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="908" data-linenumber="96">
            
              <span class="hits">908</span>
            

            
              
            

            <code class="ruby">          keys &lt;&lt; full_key</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  # Reset on initialization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="103">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  reset!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">  # Add at_exit hook to save tracking results if enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="106">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  at_exit do</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="17" data-linenumber="107">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    if tracking_enabled &amp;&amp; used_keys.any?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            

            
              
            

            <code class="ruby">      File.write(Rails.root.join(&quot;tmp&quot;, &quot;i18n_tracking_results.json&quot;), used_keys.to_a.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"># Monkey patch I18n.t to track usage</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="114">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">module I18n</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="115">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  class &lt;&lt; self</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="116">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_t, :t</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="117">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_translate, :translate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="119">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11350" data-linenumber="120">
            
              <span class="hits">11350</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 11348 times">
                  else: 11348
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11350" data-linenumber="121">
            
              <span class="hits">11350</span>
            

            
              
            

            <code class="ruby">      original_t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="124">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42776" data-linenumber="125">
            
              <span class="hits">42776</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 42775 times">
                  else: 42775
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="42776" data-linenumber="126">
            
              <span class="hits">42776</span>
            

            
              
            

            <code class="ruby">      original_translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"># Also track Rails view helpers</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="17" data-linenumber="132">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">if defined?(ActionView::Helpers::TranslationHelper)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="133">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">  module ActionView::Helpers::TranslationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="134">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_t, :t</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="135">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    alias_method :original_translate, :translate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="137">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="37012" data-linenumber="138">
            
              <span class="hits">37012</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 37012 times">
                  else: 37012
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37012" data-linenumber="139">
            
              <span class="hits">37012</span>
            

            
              
            

            <code class="ruby">      original_t(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="142">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    def translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="143">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      I18nUsageTracker.track_key(key, options) if I18nUsageTracker.tracking_enabled</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            

            
              
            

            <code class="ruby">      original_translate(key, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="944fbd53bd59c95c47086a4e762f306615f653b5">
  <div class="header">
    <h3>lib/tasks/storage_cleanup.rake</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>5</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">namespace :storage do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  desc &quot;Cleanup unattached ActiveStorage blobs older than 2 days&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  task cleanup: :environment do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    ActiveStorage::Blob.unattached.where(&quot;active_storage_blobs.created_at &lt;= ?&quot;, 2.days.ago).find_each(&amp;:purge_later)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    puts &quot;Scheduled cleanup of unattached blobs older than 2 days&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
